---
title: "MT_SORTED_13.10"
author: "Kira Dahinden"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

models sorted by family:

- Poisson:
                  mgcv gam
                  mgcv gamm
                  gamlss
                  brms
                  INLA
                  glmmTMB
                  rstanarm              (only poisson possible)  
                  gamm4                 (only poisson possible)   
                  R2BayesX              (only poisson possible)  
                  
            
- Poisson only with V2 possiblw, no random effects, just smooth & fixed:
                  qgam                  (only poisson possible)  
                  spikeSlabGam          (only poisson possible)  
          
- Poisson, only V2 & scaled:
                  gammslice             (only poisson possible)  
    
          
- NB:
                  mgcv gam              (NB)
                  INLA                  (NBI & NBII)
                  gamlss                (NBI & NBII)
                  glmmTMB               (NBI & NBII)
                  rstanarm              (NBII)


- Quasi poisson: 
                  mgcv gam


- Zeroinflated:
                 gamlss (ZIP & ZINBI)
  
- with PC:        mgcv gam



```{r install packages}
#install.packages("brms")
#install.packages("rstanarm")
#install.packages("spikeSlabGAM")
#install.packages("R2BayesX")
#install.packages("gammSlice")
#install.packages("INLA") ########## does not work via CRAN, has to be downloaded onthe website of INLA
#install.packages("mgcv")
#install.packages("gamm4")
#install.packages("gamlss")
#install.packages("glmmTMB")
#install.packages("qgam")
```

```{r install dependencies}
#install.packages("KernSmooth")
#install.packages("lattice")
#install.packages("nlme") # for random effects in gamm

```

```{r import dependencies}
library(KernSmooth)
library(lattice)
library(nlme)
library(mgcv)
library(MASS)  # `gammPQL` requires some functions from the MASS package, gammPQL is needed for mgcv gamm, for non gaussian
```

```{r import packages}
# Always before using the respective package
```

## Data
```{r import data}
rawdata <- readRDS("/Users/kira/Desktop/vectomax_ready.RDS")
#str(rawdata)
#head (rawdata) 
```

## Model_Data
To avoid issues with NAs in specific packages (such as gamlss)

```{r Create model_data}
model_data <- rawdata[c("Aa.adults", "weeks.since.treatment", "yday_end", "region", "site", "manhole")]
model_data <- na.omit(model_data)
str(model_data)
#summary(model_data)
```

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#Poisson Modells

## mgcv gam

```{r import mgcv}
library(mgcv)
```

### mgcv gam Ausgangsmodell, no PC=0, poisson

Fit model
```{r }
mod.mgcv.gam.no_pc.poisson <- gam(Aa.adults ~ s(weeks.since.treatment) +
                        s(yday_end) +
                        s(region, bs = "re") +
                        s(site, bs = "re") +
                        s(manhole, bs = "re"),
                      method = "REML",
                      family = "poisson",
                      data = model_data)
```

```{r }
summary(mod.mgcv.gam.no_pc.poisson)
```

smooth effects:
way more wiggly, than mgcv with nb 
CI seem narrower
```{r }
#Let’s visualise the estimated smooth effects. We start from the weeks.since.treatment effect
plot(mod.mgcv.gam.no_pc.poisson, select = 1,
     trans = exp,
     ylim = c(0,1))
```

Variance components of random effects:
for std. dev. & CI
```{r }
gam.vcomp(mod.mgcv.gam.no_pc.poisson)
```

smoothers plotten:
```{r}
#Create a prediction dataset for weeks.since.treatment ranging from 0 to 21 and fix yday_end
d.predict.gam.no_pc.poisson.weeks_since_treatment <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               # fixed yday_end
  region = "A",                 # fixed region
  site = "A1",                  # fixed site
  manhole = 1                   # fixed manhole
)

# Calculate predictions for weeks.since.treatment using the gam model
d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson <- predict(
  mod.mgcv.gam.no_pc.poisson,
  newdata = d.predict.gam.no_pc.poisson.weeks_since_treatment, # Korrigierter Name hier
  type = "response"
)

# Plot for smooth Effect:weeks.since.treatment
plot(
  x = d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
  y = d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
  type = "l",
  main = "Predicted Values Over Weeks Since Treatment (gam)",
  xlab = "Weeks Since Treatment",
  ylab = "Predicted Values (gam Poisson)"
)

```

```{r}
# Create a prediction dataset for yday_end ranging from 146 to 286 and fix weeks.since.treatment
d.predict.gam.no_pc.poisson.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  # fixed value for weeks.since.treatment
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                 # fixed value for  region
  site = "A1",                  # fixed value for  site
  manhole = 1                   # fixed value for  manhole
)

# Calculate predictions for yday_end  with gam
d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson <- predict(
  mod.mgcv.gam.no_pc.poisson,
  newdata = d.predict.gam.no_pc.poisson.yday_end,
  type = "response"
)

# Plot smooth Effect of yday_end
plot(pred.values.gam.poisson ~ yday_end, data = d.predict.gam.no_pc.poisson.yday_end,
     main = "Predicted Values Over yday_end (gam)",
     xlab = "Day of Year",
     ylab = "Predicted Values (gam Poisson)")

```

############# CRITERIA'S ################

```{r}
# calculate AIC & BIC manually
logLik_gam <- logLik(mod.mgcv.gam.no_pc.poisson)  # Log-Likelihood 
n_params_gam <- length(mod.mgcv.gam.no_pc.poisson$coefficients)  # amount of Parameters

aic_gam <- -2 * as.numeric(logLik_gam) + 2 * n_params_gam
bic_gam <- -2 * as.numeric(logLik_gam) + log(nrow(model_data)) * n_params_gam

# print values
aic_gam
bic_gam


```

```{r}
# extract R² 
r_squared_gam <- summary(mod.mgcv.gam.no_pc.poisson)$r.sq

# create table
criteria_table <- data.frame(
  Model = "mgcv GAM Poisson",
  AIC = 1340,
  BIC = 1730,
  R_squared = 0.496,
  DIC = NA  # DIC nicht verfügbar
)

print(criteria_table)

```


## mgcv gamm

```{r import gamm}
library(nlme)
library(mgcv)
library(MASS) 
```

### mgcv gamm poisson

fit model
```{r }
mod.mgcv.gamm.poisson <- gamm(Aa.adults ~ s(weeks.since.treatment) + s(yday_end),
                    random = list(region = ~1, site = ~1, manhole = ~1),
                    family = poisson(link = "log"),
                    data = model_data,
                    method = "REML")
```

summary lme (random effects) 
```{r }
summary(mod.mgcv.gamm.poisson$lme)
```

Variance of random effects:
```{r}

# Accessing the lme component of the GAMM model
lme_model <- mod.mgcv.gamm.poisson$lme

# Extract the variances of the random effects
random_effects_variance <- VarCorr(lme_model)
print(random_effects_variance)

```


summary gam (fixed effects/ smooth terms)
```{r }
summary(mod.mgcv.gamm.poisson$gam)
```

```{r }
# Extract variance components from the GAM part of the GAMM model
gam.vcomp(mod.mgcv.gamm.poisson$gam)
```

```{r }
# Extract the coefficients from the GAM part of the GAMM model
coef(mod.mgcv.gamm.poisson$gam)
```

confidence intervall of intercept and smooth terms
```{r }
confint(mod.mgcv.gamm.poisson$gam)
```

Fixed effects:
```{r }
fixef(mod.mgcv.gamm.poisson$lme)
```

```{r }
# Visualise smoth term of weeks since treament
plot(mod.mgcv.gamm.poisson$gam, select = 1, trans = exp, ylim = c(0, 1))

```

smoothers plotten

```{r}
# Create a prediction dataset for weeks.since.treatment
d.predict.gamm.poisson.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# calculate preditions for weeks.since.treatment 
d.predict.gamm.poisson.weeks$pred.values.gamm.poisson <- predict(
  mod.mgcv.gamm.poisson$gam,
  newdata = d.predict.gamm.poisson.weeks,
  type = "response"
)

# Plot smooth Effect of weeks.since.treatment
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "Predicted Values Over Weeks Since Treatment (gamm)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (gamm Poisson)")

```
without predict:
```{r}
# Plot smooth Effect of weeks.since.treatment
#plot(mod.mgcv.gamm.poisson$gam, select = 1, trans = exp, 
#     main = "Smooth Effect for Weeks Since Treatment (gamm Poisson)",
 #    xlab = "Weeks Since Treatment", 
  #   ylab = "Predicted Effect")
```


```{r}
# Create a prediction dataset for yday_end ranging from 146 to 286 and fix weeks.since.treatment
d.predict.gamm.poisson.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  # fixed weeks.since.treatment
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                 # region
  site = "A1",                  # site
  manhole = 1                   # manhole
)

# calculate prediction for yday_end 
d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson <- predict(
  mod.mgcv.gamm.poisson$gam,
  newdata = d.predict.gamm.poisson.yday_end,
  type = "response"
)

# Plot smooth Effect of yday_end
plot(pred.values.gamm.poisson ~ yday_end, data = d.predict.gamm.poisson.yday_end,
     main = "Predicted Values Over yday_end (gamm)",
     xlab = "Day of Year",
     ylab = "Predicted Values (gamm Poisson)")

```

############# CRITERIA'S ################

GAMM provides a nested model that combines a mixed-effects model (lme from the nlme package) with a GAM. Criteria such as AIC, BIC, DIC, and R² need to be extracted differently for this model.

```{r}
# AIC und BIC für das gamm-Modell
aic_gamm <- AIC(mod.mgcv.gamm.poisson$lme)
bic_gamm <- BIC(mod.mgcv.gamm.poisson$lme)

```

R² (pseudo R² for GAMM)

```{r}
# install.packages("MuMIn")
library(MuMIn)

# R²
r_squared_gamm <- r.squaredGLMM(mod.mgcv.gamm.poisson$lme)
r_squared_gamm

```

r_squared_gamm[1, "R2m"]: Marginales R².
r_squared_gamm[1, "R2c"]: Konditionales R².


```{r}
# Create Tablr
criteria_table_gamm <- data.frame(
  Model = "mgcv GAMM Poisson",
  AIC = 5118,
  BIC = 5155,
  R2 = 0.053,
  # R2_Conditional = r_squared_gamm[1, "R2c"],
  DIC = NA  # DIC not implemented
)

print(criteria_table_gamm)

```

## gamlss

```{r import gamlss}
library(gamlss)
library(splines) 
library(nlme) 
```

### gamlss, poisson

fit model
```{r }
mod.gamlss.poisson <- gamlss(
  formula = Aa.adults ~ pb(weeks.since.treatment) +
    pb(yday_end) +
    re(random=~1|region) + 
    re(random=~1|site) + 
    re(random=~1|manhole),
  family = PO(),
  data = model_data,
  control = gamlss.control(n.cyc = 100)  #for more iterations
)
```


```{r }
summary(mod.gamlss.poisson)
```
! Problem: es gibt mir keine infos über random effects


```{r}
# Search for information about the random effects.
random_effects_info <- mod.gamlss.poisson$mu.xtra

# Output of the estimated variances
print(random_effects_info)
# Is = NULL
```


```{r }
# Displaying model coefficients could provide information about the random effects.
coef(mod.gamlss.poisson)


```

smoothers plotten:

```{r }
# Create a prediction dataset for weeks.since.treatment ranging from 0 to 21 and fix yday_end.
d.predict.gamlss.poisson.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# calculate predictions for  weeks.since.treatment
d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson <- predict(
  mod.gamlss.poisson,
  newdata = d.predict.gamlss.poisson.weeks,
  type = "response"
)

# Plot smooth Effect of weeks.since.treatment
plot(pred.values.gamlss.poisson ~ weeks.since.treatment, data = d.predict.gamlss.poisson.weeks,
     main = "Predicted Values Over Weeks Since Treatment (gamlss poisson)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (gamlss Poisson)")
```

```{r}
# Create a prediction dataset for yday_end ranging from 146 to 286 and fix weeks.since.treatment.
d.predict.gamlss.poisson.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                 
  site = "A1",                 
  manhole = 1                 
)

# calculate predictions for yday_end 
d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson <- predict(
  mod.gamlss.poisson,
  newdata = d.predict.gamlss.poisson.yday_end,
  type = "response"
)

# Plot smooth Effect of yday_end
plot(pred.values.gamlss.poisson ~ yday_end, data = d.predict.gamlss.poisson.yday_end,
     main = "Predicted Values Over yday_end (gamlss poisson)",
     xlab = "Day of Year",
     ylab = "Predicted Values (gamlss Poisson)")

```
############# CRITERIA'S ################

```{r}
# Extract AIC and BIC 
aic_gamlss <- mod.gamlss.poisson$aic  
bic_gamlss <- mod.gamlss.poisson$sbc  

print(aic_gamlss)
print(bic_gamlss)

```

```{r}
# calculate Pseudo-R² 
library(gamlss.data)
r_squared_gamlss <- Rsq(mod.gamlss.poisson)

# calculate DIC 
dic_gamlss <- GAIC(mod.gamlss.poisson, k = 3)

```

```{r}
# create table
criteria_table_gamlss <- data.frame(
  Model = "gamlss Poisson",
  AIC = 1228,
  BIC = 1489,
  R_squared = 0.893,
  DIC = 1284
)

print(criteria_table_gamlss)

```

## brms


```{r import brms}
library(Rcpp) 
library(brms)
library(bayesplot)
```

### brms, poisson


fit model
```{r }
# Adjusted delta from 0.95 to 0.99 because of the error: "There were 2 divergent transitions after warmup."
mod.brms.poisson <- brm(
  formula = Aa.adults ~ s(weeks.since.treatment ) + 
    s(yday_end) + 
    (1 | region) + 
    (1 | site) + 
    (1 | manhole),
  family = poisson(),
  data = model_data,
  cores = 4,
  control = list(adapt_delta = 0.99, max_treedepth = 15) # Increase max_treedepth above 10. because: ERROR: There were 935 transitions after warmup that exceeded the maximum treedepth. 
                                                          
)
```


```{r }
summary(mod.brms.poisson)
```
Good convergence:
Rhat = 1.00 = good, indicating that the MCMC chains have converged, the chains are well-distributed over the parameters, and the estimates are stable.

ESS values should be high, which is the case here.

Varianves of random effects
```{r}
random_effects <- VarCorr(mod.brms.poisson)
print(random_effects)

```

### Criteria:

```{r }
# calculate WAIC 
waic_value <- waic(mod.brms.poisson)
print(waic_value)

```

smoother plotten:
```{r}
# Create a prediction dataset for weeks.since.treatment ranging from 0 to 21 and fix yday_end.
d.predict.brms.poisson.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# calculate predictions for weeks.since.treatment 
d.predict.brms.poisson.weeks$pred.values.brms.poisson <- predict(
  mod.brms.poisson, 
  newdata = d.predict.brms.poisson.weeks, 
  type = "response",
  allow_new_levels = TRUE
)[, "Estimate"]

# Plot smooth Effect of weeks.since.treatment
plot(pred.values.brms.poisson ~ weeks.since.treatment, data = d.predict.brms.poisson.weeks,
     main = "Predicted Values Over Weeks Since Treatment",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (brms Poisson)")

```
```{r}
# Create a prediction dataset for yday_end ranging from 146 to 286 and fix weeks.since.treatment.
d.predict.brms.poisson.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# calculate predictions for yday_end 
d.predict.brms.poisson.yday_end$pred.values.brms.poisson <- predict(
  mod.brms.poisson, 
  newdata = d.predict.brms.poisson.yday_end, 
  type = "response",
  allow_new_levels = TRUE
)[, "Estimate"]

# Plot smooth Effect of yday_end
plot(pred.values.brms.poisson ~ yday_end, data = d.predict.brms.poisson.yday_end,
     main = "Predicted Values Over yday_end",
     xlab = "Day of Year",
     ylab = "Predicted Values (brms Poisson)")

```

############# CRITERIA'S ################

```{r}
library(brms)
library(loo)
library(rstan)

```

```{r}
mod.brms.poisson <- add_criterion(mod.brms.poisson, criterion = c("loo", "waic"))
print(mod.brms.poisson$criteria$loo)   # LOO = Leave-One-Out Cross-Validation
print(mod.brms.poisson$criteria$waic) # WAIC
```
Interpret:
Smaller is better.

LOO is more robust to problematic data points (Pareto), while WAIC is faster to compute and often sufficient for well-fitting models.

In this case: Since the Pareto k-values for LOO pose an issue, WAIC is the more reliable choice.


```{r}
#R2
bayes_R2(mod.brms.poisson)
```
How to interpret:

Estimate (0.503): The model explains approximately 50.3% of the variance in the data.
Est.Error (0.03): The uncertainty in the estimate is ±3%.
Q2.5 (0.443) and Q97.5 (0.558): With 95% probability, the true r-squared value lies between 44.3% and 55.8%.

BIC and DIC are not available and are not recommended for calculation.

```{r}
# save values in dictionnary
model_results <- list()


model_results$poisson_brms <- list(
  Package = "brms",
  Family = "poisson",
  Model = "mod.brms.poisson",
  Type = "Bayesian",  
  AIC = NA,               
 WAIC = 1401.5,     
  BIC = NA,               
  DIC = NA,               
  R2 = 0.503225           
)

```



## INLA

```{r }
#import
library(Matrix)
library(sp)
library(fields)
library(nlme)
library(INLA)
```

### INLA, Poisson


### RW 1

= Random Walk 1, often used when it is expected that values change slowly and in small steps, meaning there are no sudden jumps.

#### RW 1, INLA, POISSON, RW 1

fit model in general:
```{r }
mod.inla_rw1 <- Aa.adults ~ f(weeks.since.treatment, model = "rw1") + 
  f(yday_end, model = "rw1") + 
  f(region, model = "iid") + 
  f(site, model = "iid") + 
  f(manhole, model = "iid")
```


fit for poisson:
```{r}

result.inla.poisson_rw1 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw1") + 
               f(yday_end, model = "rw1") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "poisson",
  data = model_data,
  control.predictor = list(compute = TRUE)
)

# Extract values for weeks.since.treatment
weeks_effect <- result.inla.poisson_rw1$summary.random$`weeks.since.treatment`

# Create a data frame for the smoothing results of weeks.since.treatment.
weeks.smooth <- data.frame(
  weeks.since.treatment = weeks_effect$ID,
  mean = weeks_effect$mean,
  lower = weeks_effect$`0.025quant`,
  upper = weeks_effect$`0.975quant`
)

# Extract values for yday_end
yday_effect <- result.inla.poisson_rw1$summary.random$yday_end

# Create a data frame for the smoothing results of yday_end
yday.smooth <- data.frame(
  yday_end = yday_effect$ID,
  mean = yday_effect$mean,
  lower = yday_effect$`0.025quant`,  # 95% CI 
  upper = yday_effect$`0.975quant`
)

```

```{r }
summary(result.inla.poisson_rw1)
```


Random variances
```{r}
# Extract variances of the random effects
variance_rw1 <- list(
  manhole = result.inla.poisson_rw1$summary.hyperpar["Precision for manhole", "mean"]
)

# Conversion of precision to variance.
variance_rw1 <- lapply(variance_rw1, function(prec) 1 / prec)

# Calculate confidence intervals for variances.
ci_rw1 <- list(
  manhole = 1 / rev(result.inla.poisson_rw1$summary.hyperpar["Precision for manhole", c("0.025quant", "0.975quant")])
)

# results
print(variance_rw1)
print(ci_rw1)
```


```{r}
library(ggplot2)

# Plot for weeks.since.treatment
ggplot(weeks.smooth, aes(x = weeks.since.treatment, y = mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2) +
  labs(title = "Effekt von weeks.since.treatment", x = "Weeks since treatment", y = "Effekt")

# Plot for yday_end
ggplot(yday.smooth, aes(x = yday_end, y = mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2) +
  labs(title = "Saisonaler Effekt von yday_end", x = "Yday_end", y = "Effekt")

```

```{r}
# Plot for weeks.since.treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "blue", 
     ylim = range(weeks.smooth$lower, weeks.smooth$upper),
     main = "R-INLA poisson RW1: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "red", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "red", lty = 2)

```

```{r}
# Plot for yday_end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "blue", 
     ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = "R-INLA poisson RW1: Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "red", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "red", lty = 2)
```


more smoothed:
```{r}
# smoother more smoothed for weeks.since.treatment
smooth_line_weeks <- smooth.spline(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, spar = 0.4)
plot(smooth_line_weeks, type = "l", col = "blue",
     ylim = range(weeks.smooth$lower, weeks.smooth$upper),
     main = "R-INLA poisson RW1: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(smooth.spline(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, spar = 0.4), col = "red", lty = 2)
lines(smooth.spline(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, spar = 0.4), col = "red", lty = 2)


```

```{r}
# smoother more smoothed for yday_end
smooth_line_yday <- smooth.spline(yday.smooth$yday_end, yday.smooth$mean, spar = 0.4)
plot(smooth_line_yday, type = "l", col = "blue",
     ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = " R-INLA poisson RW1:Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(smooth.spline(yday.smooth$yday_end, yday.smooth$lower, spar = 0.4), col = "red", lty = 2)
lines(smooth.spline(yday.smooth$yday_end, yday.smooth$upper, spar = 0.4), col = "red", lty = 2)

```

### RW 2

= Random Walk 2, the RW2 process models smoother trajectories than RW1. RW2 is often used when the effect exhibits a "smooth" progression over time, for example, when no sharp, sudden changes are expected, but rather long-term trends.

#### INLA, POISSON, RW 2 

fit model

smoothers plotten
```{r}
# fit rw2-Modell 
result.inla.poisson_rw2 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw2") + 
               f(yday_end, model = "rw2") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "poisson",
  data = model_data,
  control.predictor = list(compute = TRUE)
)

# exract results for weeks.since.treatment
weeks_effect_rw2 <- result.inla.poisson_rw2$summary.random$`weeks.since.treatment`
weeks.smooth_rw2 <- data.frame(
  weeks.since.treatment = weeks_effect_rw2$ID,
  mean = weeks_effect_rw2$mean,
  lower = weeks_effect_rw2$`0.025quant`,
  upper = weeks_effect_rw2$`0.975quant`
)

# exract results for yday_end
yday_effect_rw2 <- result.inla.poisson_rw2$summary.random$yday_end
yday.smooth_rw2 <- data.frame(
  yday_end = yday_effect_rw2$ID,
  mean = yday_effect_rw2$mean,
  lower = yday_effect_rw2$`0.025quant`,
  upper = yday_effect_rw2$`0.975quant`
)

# Moderate smoothing and visualization of the effects.

# Smooth plot for  weeks.since.treatment
smooth_line_weeks_rw2 <- smooth.spline(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, spar = 0.4)
plot(smooth_line_weeks_rw2, type = "l", col = "blue",
     ylim = range(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper),
     main = "R-INLA Poisson RW2: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(smooth.spline(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, spar = 0.4), col = "red", lty = 2)
lines(smooth.spline(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, spar = 0.4), col = "red", lty = 2)


```


```{r}
# Smooth plot for yday_end
smooth_line_yday_rw2 <- smooth.spline(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, spar = 0.4)
plot(smooth_line_yday_rw2, type = "l", col = "blue",
     ylim = range(yday.smooth_rw2$lower, yday.smooth_rw2$upper),
     main = "R-INLA Poisson RW2: Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(smooth.spline(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, spar = 0.4), col = "red", lty = 2)
lines(smooth.spline(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, spar = 0.4), col = "red", lty = 2)
```

```{r }
summary(result.inla.poisson_rw2)
```


############# CRITERIA'S ################

DIC: Lower values indicate a better model fit. It penalizes for model complexity.
WAIC: Similar to DIC but includes more robust measures for uncertainty. Lower values are better.

Important! Criteria must already be defined in the model formulation; otherwise, they cannot be extracted later!

```{r}
result.inla.poisson_rw1 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw1") + 
               f(yday_end, model = "rw1") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "poisson",
  data = model_data,
  control.compute = list(dic = TRUE, waic = TRUE), # Sicherstellen, dass alle Kriterien berechnet werden
  control.predictor = list(compute = TRUE)
)

result.inla.poisson_rw2 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw2") + 
               f(yday_end, model = "rw2") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "poisson",
  data = model_data,
  control.compute = list(dic = TRUE, waic = TRUE), # Sicherstellen, dass alle Kriterien berechnet werden
  control.predictor = list(compute = TRUE)
)

```


```{r}
result.inla.poisson_rw1$dic$dic
result.inla.poisson_rw2$dic$dic
```

```{r}
result.inla.poisson_rw1$waic$waic
result.inla.poisson_rw2$waic$waic
```

Bayesian R-squared (manuell berrechnet):

```{r}
# extract predicted values for RW1-Modell
pred_rw1 <- result.inla.poisson_rw1$summary.fitted.values$mean

# Calculate observed values
obs_rw1 <- model_data$Aa.adults

# Calculate variances
var_pred_rw1 <- var(pred_rw1)
var_residual_rw1 <- var(obs_rw1 - pred_rw1)

# Bayesian R² for RW1
R2_rw1 <- var_pred_rw1 / (var_pred_rw1 + var_residual_rw1)
R2_rw1
```

```{r}
# extract predicted values for  RW2-Modell
pred_rw2 <- result.inla.poisson_rw2$summary.fitted.values$mean

# Calculate observed values
obs_rw2 <- model_data$Aa.adults

# Calculate variances
var_pred_rw2 <- var(pred_rw2)
var_residual_rw2 <- var(obs_rw2 - pred_rw2)

# Bayesian R² for RW2
R2_rw2 <- var_pred_rw2 / (var_pred_rw2 + var_residual_rw2)
R2_rw2

```

Variance of Random effect:
```{r}
# Extract variances of the random effects for RW2
variance_rw2 <- list(
  manhole = result.inla.poisson_rw2$summary.hyperpar["Precision for manhole", "mean"]
)

# Conversion of precision to variance
variance_rw2 <- lapply(variance_rw2, function(prec) 1 / prec)

# Calculate 95% confidence intervals for variances
ci_rw2 <- list(
  manhole = 1 / rev(result.inla.poisson_rw2$summary.hyperpar["Precision for manhole", c("0.025quant", "0.975quant")])
)

print(variance_rw2)
print(ci_rw2)

```

## glmmTMB

Import
```{r }
library(glmmTMB)
library(splines)
```

```{r }
# Creating B-splines for the independent variables.
model_data$weeks_since_treatment_spline <- bs(model_data$weeks.since.treatment, degree = 3, df = 3)
model_data$yday_end_spline <- bs(model_data$yday_end, degree = 3, df = 3)
```

### Modelle

### GLMMTMB, POISSON

```{r }
# Fitting the model with the B-splines
mod.glmmTMB.poisson <- glmmTMB(
  Aa.adults ~ weeks_since_treatment_spline + yday_end_spline +
    (1 | region) + (1 | site) + (1 | manhole),
  family = poisson(link = "log"),
  data = model_data
)
```

```{r }
summary(mod.glmmTMB.poisson)
```

(there are more than 1 spline, cause it's non linear, so it's more flexible)

Variance of random effects in summary integrated


smoothers plotten:
```{r}
# Prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215
mod.glmmTMB.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",               
  site = "A1",                
  manhole = 1                  
)

# Convert weeks.since.treatment and yday_end into B-splines to match the model.
mod.glmmTMB.weeks$weeks_since_treatment_spline <- predict(
  bs(model_data$weeks.since.treatment, degree = 3, df = 3),
  newx = mod.glmmTMB.weeks$weeks.since.treatment
)

mod.glmmTMB.weeks$yday_end_spline <- predict(
  bs(model_data$yday_end, degree = 3, df = 3),
  newx = mod.glmmTMB.weeks$yday_end
)

# Calculate predictions for weeks.since.treatment
mod.glmmTMB.weeks$predicted <- predict(
  mod.glmmTMB.poisson,
  newdata = mod.glmmTMB.weeks,
  type = "response",
  allow.new.levels = TRUE
)

```

```{r}
# Plot for weeks.since.treatment
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "Predicted Effect of Weeks Since Treatment",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Poisson)")
```


```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5.
mod.glmmTMB.ydays <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                
  manhole = 1                  
)

# convert weeks.since.treatment und yday_end into B-Splines 
mod.glmmTMB.ydays$weeks_since_treatment_spline <- predict(
  bs(model_data$weeks.since.treatment, degree = 3, df = 3),
  newx = mod.glmmTMB.ydays$weeks.since.treatment
)

mod.glmmTMB.ydays$yday_end_spline <- predict(
  bs(model_data$yday_end, degree = 3, df = 3),
  newx = mod.glmmTMB.ydays$yday_end
)

# calculate predictions for yday_end 
mod.glmmTMB.ydays$predicted <- predict(
  mod.glmmTMB.poisson,
  newdata = mod.glmmTMB.ydays,
  type = "response",
  allow.new.levels = TRUE
)

# Plot for yday_end
plot(predicted ~ yday_end, data = mod.glmmTMB.ydays,
     main = "Predicted Effect of yday_end",
     xlab = "Day of Year",
     ylab = "Predicted Response (Poisson)")

```

############# CRITERIA'S ################

AIC & BIC
```{r}
# calculate AIC
aic_glmmTMB <- AIC(mod.glmmTMB.poisson)

# claculate BIC
bic_glmmTMB <- BIC(mod.glmmTMB.poisson)

aic_glmmTMB
bic_glmmTMB
```


R2 berrechnen
```{r}
library(performance)

# calculate predictions for glmmTMB-Modell
pred_glmmTMB <- predict(mod.glmmTMB.poisson, type = "response")

# observed
obs_glmmTMB <- model_data$Aa.adults

# calculate variance
var_pred_glmmTMB <- var(pred_glmmTMB)
var_residual_glmmTMB <- var(obs_glmmTMB - pred_glmmTMB)

# Bayesian R² for glmmTMB
R2_glmmTMB <- var_pred_glmmTMB / (var_pred_glmmTMB + var_residual_glmmTMB)
R2_glmmTMB

```



## rstanarm 

Import
```{r }
library(Rcpp)
library(rstanarm)
library(splines)
```

Fit the model using stan_gamm4 from rstanarm
```{r }
mod.rstan.poisson <- stan_gamm4(
  formula = Aa.adults ~ s(weeks.since.treatment) + s(yday_end),
  random = ~ (1 | region) + (1 | site) + (1 | manhole),
  data = model_data,
  family = poisson(link = "log"),
  control = list(adapt_delta = 0.99)  # Higher acceptance rate
)
```

```{r }
summary(mod.rstan.poisson)
```

Variance of random effects:
```{r}
# Access to the variances of the random effects
random_effects <- VarCorr(mod.rstan.poisson)

# Extract variance for 'manhole'
manhole_variance <- attr(random_effects$manhole, "stddev")^2

# Extract the 95% confidence interval for the standard deviation.
manhole_sd_ci <- attr(random_effects$manhole, "quantiles")[, c("2.5%", "97.5%")]

# Conversion of the standard deviation (CI) to variance (CI)
manhole_variance_ci <- manhole_sd_ci^2

# print resulrts
print(paste("Varianz für 'manhole':", manhole_variance))
print(paste("95%-CI der Varianz für 'manhole': [", manhole_variance_ci[1], ", ", manhole_variance_ci[2], "]"))
```



plot smoothers:

für weeks:

```{r}
# Prediction dataset for weeks.since.treatment with yday_end fixed at 215.
mod.rstan.poisson.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",               
  site = "A1",                
  manhole = 1                 
)

# Calculate the posterior samples for weeks.since.treatment
predicted_matrix_weeks <- posterior_predict(
  mod.rstan.poisson, 
  newdata = mod.rstan.poisson.weeks,
  re.form = NA 
)

# Calculate the mean of the posterior samples
mod.rstan.poisson.weeks$predicted <- apply(predicted_matrix_weeks, 2, mean)

```


```{r}
# Plot weeks.since.treatment predictions
plot(predicted ~ weeks.since.treatment, data = mod.rstan.poisson.weeks,
     main = "Predicted Effect of Weeks Since Treatment",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Poisson)")
```


für ydays:
```{r}
# Prediction dataset for yday_end with weeks.since.treatment fixed at 3.5.
mod.rstan.poisson.ydays <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                
  manhole = 1                  
)

# Calculate the posterior samples for yday_end.
predicted_matrix_ydays <- posterior_predict(
  mod.rstan.poisson, 
  newdata = mod.rstan.poisson.ydays,
  re.form = NA 
)

# Calculate the mean of the posterior samples
mod.rstan.poisson.ydays$predicted <- apply(predicted_matrix_ydays, 2, mean)

# Plot yday_end precitions
plot(predicted ~ yday_end, data = mod.rstan.poisson.ydays,
     main = "Predicted Effect of yday_end",
     xlab = "Day of Year",
     ylab = "Predicted Response (Poisson)")
```

############# CRITERIA'S ################

BIC & DIC not available

```{r}
# Anzahl der Parameter
#k <- length(fixef(mod.rstan.poisson)) + length(VarCorr(mod.rstan.poisson))
# Anzahl der Beobachtungen
#n <- nrow(model_data)
# Log-Likelihood
#loglik <- logLik(mod.rstan.poisson)
# BIC berechnen
#bic <- -2 * loglik + k * log(n)
#bic

#output: numeric(0)
```


Bayesian R squared

```{r}
# Error in bayes_R2.stanreg(mod.rstan.poisson): bayes_R2 is only available for Gaussian and binomial models.
predicted <- posterior_predict(mod.rstan.poisson)

# observed values
observed <- model_data$Aa.adults

# Calculate the mean of the posterior prediction
mean_predicted <- colMeans(predicted)

# cariance of predictions
var_pred <- var(mean_predicted)

# Residual variance: Mean squared sum of the difference between observed values and predictions.
var_residual <- mean((observed - mean_predicted)^2)

# Bayesian R²
r2_manual <- var_pred / (var_pred + var_residual)

print(paste("Bayesian R²:", r2_manual))

```


```{r}

#r2_rstanarm <- bayes_R2(mod.rstan.poisson)
#print(r2_rstanarm)
#Error in bayes_R2.stanreg(mod.rstan.poisson) : bayes_R2 is only available for Gaussian and binomial models.
```


calculate WAIC & LOO, because bayesian

```{r}
# calculate LOO 
loo_result <- loo(mod.rstan.poisson)
print(loo_result)
```

```{r}
# extract log-Likelihood-values
log_lik <- log_lik(mod.rstan.poisson)

# Manually calculate WAIC 
waic_values <- loo::waic(log_lik)

print(waic_values)

```

-------------------------------------------------------------------------------------------------------------------------


## gamm4

Import
```{r }
library(lme4)
# dependent on mgcv
library(mgcv)
library(gamm4)

```

```{r }
mod.gamm4.poisson <- gamm4(Aa.adults ~ s(weeks.since.treatment) +
                             s(yday_end),
                           random = ~ (1 | region) + (1 | site) + (1 | manhole),
                           family = poisson(link = "log"),
                           data = model_data)
```

Summary
```{r }
summary(mod.gamm4.poisson$gam)
```

Variance of random effects (auch untern in summary von mer drin)
```{r}
# extract mixed effects
random_effects_gamm4 <- VarCorr(mod.gamm4.poisson$mer)

# Extract the variance and standard deviation for manhole
manhole_variance_gamm4 <- attr(random_effects_gamm4$manhole, "stddev")^2
manhole_stddev_gamm4 <- attr(random_effects_gamm4$manhole, "stddev")

print(paste("Varianz für 'manhole':", manhole_variance_gamm4))
print(paste("Standardabweichung für 'manhole':", manhole_stddev_gamm4))

```



```{r }
# summary of mixed Effects
summary(mod.gamm4.poisson$mer) 

```
###Criteria

CI -> Gibt Error!
```{r }
# Confidence intervals for the fixed effects. (GLMM-Komponente)
#confint(mod.gamm4.poisson$mer)

# Confidence intervals for the smoothing effects (GAM-Komponente)
#summary(mod.gamm4.poisson$gam) # Glättungsterme


```
Because of warning from above:(suggeste by gpt)

```{r }
# Wald confidence intervals for the fixed effects.
confint(mod.gamm4.poisson$mer, method = "Wald")
```
The Wald method cannot provide confidence intervals for random effects but can for fixed effects

Bayesian Information Criterion (BIC)
```{r }
BIC(mod.gamm4.poisson$mer)
```

Variance of the random effects.
```{r }
VarCorr(mod.gamm4.poisson$mer)
```

Visualize smoothers
```{r }
# Plot smoothing effects (for the GAM component) with residuals
plot(mod.gamm4.poisson$gam, pages = 1, residuals = TRUE)

```
plot (left, weeks.since.treatment):
This plot shows the smoothing effect of weeks.since.treatment on the response variable. The effect fluctuates in the first few weeks after treatment, then stabilizes with minimal influence. Dashed lines indicate confidence intervals.


plot (right, yday_end):
This plot displays the smoothing effect of yday_end (day of the year). The effect shows a wave-like pattern, with a stronger influence around days 200–250. Shaded areas represent confidence intervals.

```{r}
summary(mod.gamm4.poisson$mer)
```

```{r}
#methods(class(mod.gamm4.poisson$mer))
```


plot smooth terms:

```{r}
# Prediction dataset for weeks.since.treatment with yday_end fixed at 215
mod.gamm4.poisson.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              # Fester Wert für yday_end
  region = "A",                # Fester Wert für region
  site = "A1",                 # Fester Wert für site
  manhole = 1                  # Fester Wert für manhole
)

# Calculate predictions for weeks.since.treatment
mod.gamm4.poisson.weeks$predicted <- predict(
  mod.gamm4.poisson$gam, 
  newdata = mod.gamm4.poisson.weeks, 
  type = "response"
)

# Plot for weeks.since.treatment
plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "Predicted Effect of Weeks Since Treatment",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Poisson)")

```


```{r}
#Prediction dataset for yday_end  with weeks.since.treatment fixed at 3.5.
mod.gamm4.poisson.ydays <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                 
  manhole = 1                 
)

# calculate pred. for yday_end
mod.gamm4.poisson.ydays$predicted <- predict(
  mod.gamm4.poisson$gam, 
  newdata = mod.gamm4.poisson.ydays, 
  type = "response"
)

# Plot for yday_end
plot(predicted ~ yday_end, data = mod.gamm4.poisson.ydays,
     main = "Predicted Effect of yday_end",
     xlab = "Day of Year",
     ylab = "Predicted Response (Poisson)")
```

############# CRITERIA'S ################

```{r}
# Extract glmer-Model
mod_glmer <- mod.gamm4.poisson$mer

# calculate AIC und BIC
aic_gamm4 <- AIC(mod_glmer)
bic_gamm4 <- BIC(mod_glmer)

print(paste("AIC:", aic_gamm4))
print(paste("BIC:", bic_gamm4))
```

R squared
```{r}
# pred. values
predicted_values <- predict(mod_glmer)

# obs. values
observed_values <- model_data$Aa.adults

# calculate variances
var_pred <- var(predicted_values)
var_residual <- var(observed_values - predicted_values)

# calculate R²
r2_gamm4 <- var_pred / (var_pred + var_residual)

r2_gamm4_rounded <- round(r2_gamm4, 6) #round to 6
print(paste("R² (approx):", r2_gamm4_rounded))

```


## R2BayesX (poisson)

Imports
```{r }
library(BayesXsrc) 
library(R2BayesX)
library(colorspace)
library(mgcv)
library(nlme)
```

Fit model
```{r }

mod.r2bayesx <- Aa.adults ~ sx(weeks.since.treatment) +
  sx(yday_end) +
  sx(region, bs = "re") +
  sx(site, bs = "re") +
  sx(manhole, bs = "re")
```

Poisson
```{r }
# fir model
mod.r2bayesx.poisson <- bayesx(mod.r2bayesx, data = model_data, family = "poisson")
```

```{r }
summary(mod.r2bayesx.poisson)
```

Variance of Random effects
```{r}
#variance of RE not possible to extract, but is intergrated in summary above
```


```{r }
# Traceplot for the smoothing of weeks.since.treatment
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)")
```

```{r }
# Traceplot for the smoothing of yday_end
plot(mod.r2bayesx.poisson, term = "sx(yday_end)")
```


```{r }
# Histogramm der Residuen
# hist(residuals_values, main = "Histogram of Residuals", xlab = "Residuals", col = "lightblue", breaks = 30)
# gibt error beim knitten

```

```{r } 
# Residuen gegen angepasste Werte plotten
# QQ-Plot der Residuen
#qqnorm(residuals_values, main = "QQ Plot of Residuals")
#qqline(residuals_values, col = "red")

# macht error beim knitten
```

Visualization: R2BayesX does not have a predict function, but it automatically fixes non-selected variables. When plotting weeks.since.treatment or yday_end, R2BayesX automatically holds the other variables constant.

Interpretation: The plots display the effect of the selected variable while non-selected variables are set to their mean values or zeros.

It is not possible to fix values manually in R2BayesX.


############# CRITERIA'S ################


```{r}
#dic <- mod.r2bayesx.poisson$deviance$DIC  # oder ein ähnlicher Pfad
#print(paste("DIC:", round(dic, 6)))
# Error: Error in h(simpleError(msg, call)) : 
 # error in evaluating the argument 'x' in selecting a method for function 'print': non-numeric argument to mathematical function

```


R squared
```{r}
# Extract the fitted values and reduce to one dimension if necessary
predicted_values <- rowMeans(as.matrix(mod.r2bayesx.poisson$fitted.values))

# obs. values
observed_values <- model_data$Aa.adults

# calculate variances
var_pred <- var(predicted_values)
var_residual <- var(observed_values - predicted_values)

# calculate R²
r2_bayesx <- var_pred / (var_pred + var_residual)

# print
r2_bayesx_rounded <- round(r2_bayesx, 6)
print(paste("R² (approx):", r2_bayesx_rounded))

```



-------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#Poisson V2

## qgam

Import
```{r }
#install.packages("qgam")
library(qgam)
library(dplyr)
```

```{r }
qu <- 0.5
```

Cannot work with factors, so convert everything to numeric
```{r }
# Convert factors into dummy variables
model_data_dummies <- model_data %>%
  mutate(across(where(is.factor), ~ as.numeric(as.factor(.))))
```

Check the new data structure:
```{r }
str(model_data_dummies) # All variables must be numeric because qgam cannot handle factors.
```

Problem with unique, all have different counts
```{r }
unique(model_data$weeks.since.treatment) #21
unique(model_data$yday_end) # 286
unique(model_data$region) # abcde (5) as letter
unique(model_data$site) # 10 ( letter)
unique(model_data$manhole) # 50
unique(model_data$Aa.adults) # 26
```

model fit
```{r eval=TRUE}

mod.qgam.poisson <- qgam(Aa.adults ~ s(weeks.since.treatment, k = 15) +  
              s(yday_end, k = 15) +
              #(region, k = 4) +  # max k as available Levels
              #s(site, k = 9) +
              manhole,
            qu = 0.5,  # Quantile to be examined
            data = model_data)



# we store the model
#saveRDS(mod.qgam.poisson, "Models/mod.qgam.poisson.RDS")

# Extract effects (manhole is treated as a fixed component). If manhole was modeled as a factor:
coefficients <- coef(mod.qgam.poisson)
manhole_effects <- coefficients[grep("manhole", names(coefficients))]

# Calculate variance
manhole_variance <- var(manhole_effects)

# calculate std.
manhole_sd <- sqrt(manhole_variance)

# Confidence intervals are not directly available in qgam
print(paste("Standardabweichung für 'manhole':", manhole_sd))
```



```{r}
formula(mod.qgam.poisson)
d.predict.qgam.poisson.weeks.since.treatment <- expand.grid(weeks.since.treatment= seq(from=0, to=21, length= 100),
                         yday_end= 215,
                         manhole=1)
d.predict.qgam.poisson.weeks.since.treatment
#unique(model_data$manhole)
```

```{r}
plot(mod.qgam.poisson)
```

```{r}
# for info
#class(mod.qgam.poisson)
#methods(predict)
#?predict.gam
```

```{r}
d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson <- predict(
  mod.qgam.poisson,
  newdata = d.predict.qgam.poisson.weeks.since.treatment,
  type = "response"
)

```

```{r}
plot(pred.values.qgam.poisson ~ weeks.since.treatment, data = d.predict.qgam.poisson.weeks.since.treatment,
     main = "Predicted Values Over Weeks Since Treatment (qgam poisson)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (qgam Poisson)")

```

```{r}
#plot(pred.values.qgam.poisson~weeks.since.treatment, data= d.predict)
```

Now with fixed weeks.since.treamtent:

```{r}
formula(mod.qgam.poisson)
d.predict.qgam.poisson.yday_end <- expand.grid(yday_end= seq(from=146, to=286, length= 100),
                         weeks.since.treatment= 3.5,
                         manhole=1)
d.predict.qgam.poisson.yday_end
#unique(model_data$manhole)
```

```{r}
#mean(model_data$weeks.since.treatment)
```


```{r}
d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson <- predict(mod.qgam.poisson,newdata = d.predict.qgam.poisson.yday_end,type = "response")
```


```{r}
# for info
#class(mod.qgam.poisson)
#methods(predict)
#?predict.gam
```

```{r}
plot(pred.values.qgam.poisson ~ yday_end, data = d.predict.qgam.poisson.yday_end,
     main = "Predicted Values Over yday_end (qgam Poisson)",
     xlab = "yday_end",
     ylab = "Predicted Values")
```


############# CRITERIA'S ################

```{r}
# Caclualte AIC
aic_qgam <- AIC(mod.qgam.poisson)
print(paste("AIC:", round(aic_qgam, 6)))

# Calculate BIC
bic_qgam <- BIC(mod.qgam.poisson)
print(paste("BIC:", round(bic_qgam, 6)))
```

```{r}
# pred. values
predicted_values_qgam <- predict(mod.qgam.poisson, newdata = model_data, type = "response")

# obs. values
observed_values_qgam <- model_data$Aa.adults

# calculate variances
var_pred_qgam <- var(predicted_values_qgam)
var_residual_qgam <- var(observed_values_qgam - predicted_values_qgam)

# calculate R²
r2_qgam <- var_pred_qgam / (var_pred_qgam + var_residual_qgam)
r2_qgam_rounded <- round(r2_qgam, 6)
print(paste("Pseudo-R²:", r2_qgam_rounded))
```

Pseudo R2



## SpikeSlabGam > only possible with V1

Import
```{r }
library(spikeSlabGAM)
library(splines)
```

Setting up spline terms for weeks.since.treatment and yday_end
```{r }
#model_data$weeks_since_treatment_spline <- bs(model_data$weeks.since.treatment, df = 3)
#model_data$yday_end_spline <- bs(model_data$yday_end, df = 3 )

```

```{r }
sapply(model_data, length) # Vectors of different lengths!
```


```{r}
#parallel::detectCores()
# 8
```


```{r}
# MCMC settings
mcmc <- list(chainLength = 10000, burnin = 500, thin = 5, sampleY = TRUE)

# Hyperparameters
hyper <- list(tau = c(5, 25), gamma = 0.00025)

# Fit model (first model attempt)
#mod.spikeslabgam.poisson <- spikeSlabGAM(
#  formula = formula,
#  data = model_data,
#  mcmc = mcmc,
#  hyperparameters = hyper,
#  family = "poisson"  # Poisson-Verteilung für Zähldaten
#)
```


Since the model above indicates that region & site have no significant influence, and they are nested within manhole, here is a model below with only random manhole (v1).

```{r}
# V1: Define the new model formula without region and site
formula_reduced_v1 <- Aa.adults ~ sm(weeks.since.treatment) +  # smooth effectweeks.since.treatment
    sm(yday_end) +  # smooth effect foryday_end
    rnd(manhole)    # random effect for manhole (v1)

# Fit new model
mod.spikeslabgam.poisson <- spikeSlabGAM(
  formula = formula_reduced_v1,
  data = model_data,
  mcmc = mcmc,  # MCMC settings stay the same
  hyperparameters = hyper,
  family = "poisson"
)
```
```{r }
summary(mod.spikeslabgam.poisson)

# 1. Image = Model Info: The model is based on 775 observations and includes a total of 82 coefficients distributed across 6 model terms.

# 2. Bild:weeks.since.treatment, yday_end, and manhole are the most important terms in the model. The table shows a posterior inclusion probability of 1.000, which means these terms are very likely to be important for explaining the data.
# region and site have very low inclusion probabilities (0.037 and 0.021), meaning they are not important for the model.

# The model has a high cumulative posterior probability (0.984), indicating that it’s a good fit and captures most of the data variability.
```

```{r }
plot(mod.spikeslabgam.poisson)
```

```{r }
summary(mod.spikeslabgam.poisson)
```

```{r}
# Plot the spikeslabgam model with Poisson distribution
# Plot the spikeslabgam model with Poisson distribution and customized y-axis scale
plot(mod.spikeslabgam.poisson, main = "SpikeslabGAM Poisson Model", ylim = c(-2, 2))
# not scalable


```

Plot smoothers individually
```{r}
#Error in X %*% coef : non-conformable arguments
```


############# CRITERIA'S ################


```{r}
# evtl läschen?
# Beispiel: Wenn Koeffizienten unter einem anderen Namen gespeichert sind
#coefficients <- mod.spikeslabgam.poisson$beta  # oder ein ähnlicher Slot
```

DIC:
```{r}
# Extract DIC values
dic_values <- mod.spikeslabgam.poisson$DIC
dic <- dic_values["DIC"]
pD <- dic_values["pD"]
print(paste("DIC:", round(dic, 6)))
print(paste("Effektive Parameteranzahl (pD):", round(pD, 6)))

```

intermediate step
```{r}
# Extract log-likelihood samples and calculate the mean
log_lik_samples <- unlist(mod.spikeslabgam.poisson$samples$logLik)
log_lik_mean <- mean(log_lik_samples)
print(paste("Durchschnittliche Log-Likelihood:", round(log_lik_mean, 6)))
```

LOO:
```{r}
library(loo)
# Prepare log-likelihood samples for the loo package
log_lik_matrix <- matrix(log_lik_samples, nrow = length(log_lik_samples) / mod.spikeslabgam.poisson$model$n, byrow = TRUE)
loo_result <- loo(log_lik_matrix)
print(loo_result)

```

```{r}
str(log_lik_samples)
```
Problem: Vector, and WAIC cannot be calculated like this, so convert?

WAIC
```{r}
# calcualte lppd und p_waic
lppd <- sum(log(rowMeans(exp(log_lik_matrix), na.rm = TRUE)))
p_waic <- sum(apply(log_lik_matrix, 2, var, na.rm = TRUE))

# WAIC
waic <- -2 * (lppd - p_waic)

# print
print(paste("lppd:", round(lppd, 6)))
print(paste("p_waic:", round(p_waic, 6)))
print(paste("WAIC:", round(waic, 6)))


```

Bayesian R2:
```{r}
# calculate Bayesian R² 
r2_spikeslabgam <- var_pred / (var_pred + var_residual)

# Calculate a single R² value( mean)
r2_single_value <- mean(r2_spikeslabgam)  # Alternative median(r2_spikeslabgam)

# Ausgabe mit Rundung auf 6 Nachkommastellen
print(paste("Bayesian R² (single value):", round(r2_single_value, 6)))

```

Dic:
```{r}
# spikeSlabGAM Poisson-Modell
model_results$poisson_spikeSlabGAM <- list(
  Package = "spikeSlabGAM",
  Family = "poisson",
  Type = "Bayesian",
  Model = "mod.spikeslabgam.poisson",
  AIC = NA,                # AIC nicht verfügbar
  BIC = NA,                # BIC nicht verfügbar
  DIC = 1199,       # DIC-Wert
  WAIC = 53645,     # WAIC-Wert
  R2 = 0.276            # Bayesian R² (single value)
)

```




---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Poisson V2 scaled

## gammSlice --> v2 & scaled

Import
```{r }
library(KernSmooth)
library(lattice)
library(nlme)
library(mgcv)
library(gammSlice)
# needs al those packages
```

Preparation for gammSlice: make data into df!
```{r}
# gammslice does not support tibbles! Therefore, save it as a dataframe! -> Note that other models may not require it as a dataframe!
model_data.df <- as.data.frame(model_data)
```


```{r}
# V2 mit fixed = geht, und lädt nicht lange! -> aber summary gib singularität error aus
#mod.gammslice.poisson.v2 <- gSlc(
 # formula = Aa.adults ~ s(weeks.since.treatment) + s(yday_end) + manhole,  # Glatte Effekte und manhole als fester Effekt
#  family = "poisson",  # Poisson-Verteilung für Zähldaten
 # data = model_data.df  # Der Datensatz wird hier korrekt übergeben
#)
```

```{r}
#summary(mod.gammslice.poisson.v2)
#gibt error
```

```{r}
#Check correlation. But is actually not too high? -> GPT suggests scaling
cor(model_data.df$weeks.since.treatment, model_data.df$yday_end)
```
scale df
```{r}
#The scale() function in R standardizes numeric variables by transforming them to a scale with a mean of 0 and a standard deviation of 1 (standardization). Standardize weeks.since.treatment and yday_end. 
#Create a copy of the original DataFrame
model_data_scaled <- model_data.df

# Standardize the desired variables and save them in the new copy
model_data_scaled$weeks.since.treatment <- scale(model_data.df$weeks.since.treatment)
model_data_scaled$yday_end <- scale(model_data.df$yday_end)
```

Scaled model
```{r}
# Fit the model with the scaled DataFrame
mod.gammslice.poisson.v2_scaled <- gSlc(
  formula = Aa.adults ~ s(weeks.since.treatment) + s(yday_end) + manhole,  # Smooth effects and manhole as a fixed effect
  family = "poisson", 
  data = model_data_scaled  
)
```

```{r}
summary(mod.gammslice.poisson.v2_scaled) 
#If the coefficient of weeks.since.treatment after standardization is 2.5, it means that an increase of one standard deviation in weeks.since.treatment leads to an increase of 2.5 units in the target variable

#The numeric variables were standardized, and the coefficients now refer to a change of one standard deviation, no longer to the original unit (e.g., weeks, etc.)
```

```{r}
# Modell mit glatten Effekten und manhole als zufälliger Effekt -> lädt zu lange, stuck at 2% un R terminates itself, auch bei opriginal mit allen 3 randomeffects!!! darum V2!

#mod_gammslice_poisson_random <- gSlc(
 # formula = Aa.adults ~ s(weeks.since.treatment) + s(yday_end),  # Glatte Effekte
  #random = list(manhole = ~1),  # Zufälliger Effekt für manhole
  #family = "poisson",  # Poisson-Verteilung für Zähldaten
  #data = model_data.df  # Der Datensatz wird hier korrekt übergeben
#)
```

Gammslice has no predict:

Error in UseMethod("predict") : 
  no applicable method for 'predict' applied to an object of class "gSlc"

```{r}
# gibt error aus!!
# Daten-Grid für weeks.since.treatment erstellen (0 bis 21) und festen yday_end = 215 verwenden
#d.predict.gammslice.poisson.weeks <- expand.grid(
#  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
#  yday_end = 215,  # Fixierter Wert für yday_end
#  manhole = 1
#)

# Vorhersagen für weeks.since.treatment berechnen
#d.predict.gammslice.poisson.weeks$pred.values <- predict(
#  mod.gammslice.poisson.v2_scaled, 
#  newdata = d.predict.gammslice.poisson.weeks, 
#  type = "response"
#)

```

```{r}
#class(mod.gammslice.poisson.v2_scaled)
#?plot.gSlc 
```

use mgcv
```{r}
library(mgcv)

plot(mod.gammslice.poisson.v2_scaled, 
     select = 1, 
     title = "Smoothed Effect of Weeks Since Treatment (gammSlice Model)",
     colour = FALSE,
     xlab = "gammslice poisson", 
     ylab = "Effect", 
     scheme = 1)  # black&white,


title(main="gammslice")

```

```{r}
# Plot smoothed effect of yday_end
plot(mod.gammslice.poisson.v2_scaled, select = 2, 
     main = "Smoothed Effect of yday_end (gammSlice Model)",
     colour = FALSE,
     xlab = "gammSlice poisson", 
     ylab = "Effect")

title(main="gammslice")


```


############# CRITERIA'S ################

not possbible 
```{r}
# Extrahiere die fitted values direkt aus dem Modellobjekt
#predicted_values <- mod.gammslice.poisson.v2_scaled$fitted.values

# Beobachtete Werte
#observed_values <- model_data_scaled$Aa.adults

# Berechnung der Varianzen
#var_pred <- var(predicted_values)
#var_residual <- var(observed_values - predicted_values)

# Berechnung des R²
#r2_gammslice <- var_pred / (var_pred + var_residual)

# Ausgabe
#print(paste("R² (approx):", round(r2_gammslice, 6)))

# ERROR: Error in var(predicted_values) : 'x' is NULL
```

DIC
```{r}
# Extrahiere DIC aus dem Modell
#dic_values <- mod.gammslice.poisson.v2_scaled$DIC

# Zugriff auf DIC-Werte
#dic <- dic_values["DIC"]
#pD <- dic_values["pD"]  # Effektive Parameteranzahl

# Ausgabe der DIC-Werte
#print(paste("DIC:", round(dic, 6)))
#print(paste("Effektive Parameteranzahl (pD):", round(pD, 6)))

#Error in h(simpleError(msg, call)) : 
#  error in evaluating the argument 'x' in selecting a method for function 'print': non-numeric argument to mathematical function
```



---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Attempt to plot the last three terms individually in a 2x2 layout. However, this doesn't work because spikeslab produces unconventional visualizations, and gammslice always plots both smooth terms together by default
```{r}

library(spikeSlabGAM)
library(gammSlice)
library(mgcv)

# 2x2 Grid-Layout
par(mfrow = c(2, 2))

# Plot smooth effect forweeks.since.treatment for spikeSlabGAM-Modell
plot(mod.spikeslabgam.poisson, term = "sm(weeks.since.treatment)", 
     main = "SpikeSlabGAM: Effect of Weeks Since Treatment",
     xlab = "Weeks Since Treatment",
     ylab = "Effect")

# Plot smooth effect forweeks.since.treatment for  spikeSlabGAM-Modell
plot(mod.spikeslabgam.poisson, term = "sm(yday_end)", 
     main = "SpikeSlabGAM: Effect of yday_end",
     xlab = "Day of Year",
     ylab = "Effect")

# Plot smooth effect forweeks.since.treatment for gammSlice-Modell
plot(mod.gammslice.poisson.v2_scaled, select = 1, 
     main = "gammSlice: Effect of Weeks Since Treatment",
     xlab = "Weeks Since Treatment",
     ylab = "Effect on Response")

# Plot smooth effect forweeks.since.treatment for gammSlice-Modell
plot(mod.gammslice.poisson.v2_scaled, select = 2, 
     main = "gammSlice: Effect of yday_end",
     xlab = "Day of Year",
     ylab = "Effect on Response")

# Reset the layout to the default layout (optional
#par(mfrow = c(1, 1))

```


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Poisson all plots gathered

it didnt take gam for some reason , so here the plot for the gam poisson again:
```{r}
# pred for weeks.since.treatment 
d.predict.gam.no_pc.poisson.weeks_since_treatment <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",               
  site = "A1",                  
  manhole = 1                   
)

# calculate pred.for weeks.since.treatment for gam-Model
d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson <- predict(
  mod.mgcv.gam.no_pc.poisson,
  newdata = d.predict.gam.no_pc.poisson.weeks_since_treatment,
  type = "response"
)

# check structure
str(d.predict.gam.no_pc.poisson.weeks_since_treatment)

# Plot smooth effects for weeks.since.treatment
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "Predicted Values Over Weeks Since Treatment (gam)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (gam Poisson)")


```


Weeks Since Treatment:
```{r}
# Layout
par(mfrow = c(4, 4), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # Adjust margins

# mgcv gam plot for weeks since treatment
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# gamm plot for weeks since treatment
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (gamm Poisson)")

# gamlss plot for weeks since treatment
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# brms plot for weeks since treatment
plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# rstanarm-Plot for weeks.since.treatment
plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values"
)

# gamm4 plot for weeks since treatment
mod.gamm4.poisson.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              # Fester Wert für yday_end
  region = "A",                # Fester Wert für region
  site = "A1",                 # Fester Wert für site
  manhole = 1                  # Fester Wert für manhole
)

# preds for weeks.since.treatment
mod.gamm4.poisson.weeks$predicted <- predict(
  mod.gamm4.poisson$gam, 
  newdata = mod.gamm4.poisson.weeks, 
  type = "response"
)


plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "gamm4",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Poisson)")


plot(
  d.predict.qgam.poisson.weeks.since.treatment$weeks.since.treatment, 
  d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
  type = "l", 
  main = "qgam", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values"
)


# spikeSlabGAM plot für weeks since treatment (ähnlich wie INLA)
# Error in h(simpleError(msg, call)) : 
  #error in evaluating the argument 'x' in selecting a method for function 'plot': object 'weeks_smooth.spikeSlabGAM' not found
#plot(weeks_smooth.spikeSlabGAM$weeks.since.treatment, weeks_smooth.spikeSlabGAM$mean, type = "l", col = "blue",
#     ylim = range(weeks_smooth.spikeSlabGAM$lower, weeks_smooth.spikeSlabGAM$upper),
#     main = "spikeSlabGAM: Smooth Effect for weeks since treatment", 
#     xlab = "Weeks Since Treatment", ylab = "Effect")
#lines(weeks_smooth.spikeSlabGAM$weeks.since.treatment, weeks_smooth.spikeSlabGAM$lower, col = "red", lty = 2)
#lines(weeks_smooth.spikeSlabGAM$weeks.since.treatment, weeks_smooth.spikeSlabGAM$upper, col = "red", lty = 2)

plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Poisson)")

# INLA RW1 plot for weeks.since.treatment
plot(
  weeks.smooth$weeks.since.treatment, 
  weeks.smooth$mean, 
  type = "l", 
  col = "black",
  ylim = range(weeks.smooth$lower, weeks.smooth$upper),
  main = "INLA poisson RW1", 
  xlab = "Weeks Since Treatment", 
  ylab = "Effect"
)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "red", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "red", lty = 2)


# INLA RW2 plot for weeks.since.treatment
plot(
  weeks.smooth_rw2$weeks.since.treatment, 
  weeks.smooth_rw2$mean, 
  type = "l", 
  col = "black",
  ylim = range(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper),
  main = "INLA poisson RW2", 
  xlab = "Weeks Since Treatment", 
  ylab = "Effect"
)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "red", lty = 2)

# Plot für den geglätteten Effekt von weeks.since.treatment im gammSlice-Modell --> es tut immer beide rein, kann nicht einzeln machen
#plot(mod.gammslice.poisson.v2_scaled, select = 1, 
#     main = "gammSlice: Effect of Weeks Since Treatment",
 #    xlab = "Weeks Since Treatment",
  #   ylab = "Effect on Response")

# R2BayesX has to be last!
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", main = "r2bayesx")

# tile
mtext("Smooth terms for weeks since treatment, Poisson", outer = TRUE, cex = 1.5, font = 2)

# reset the layout to the default layout
par(mfrow = c(1, 1))

```


Yday end smotthers:
```{r}
# Layout
par(mfrow = c(4, 4), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # Adjust margins

# mgcv gam plot for yday end
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam", xlab = "Day of Year", ylab = "Predicted Values")


# mgcv gamm plot for yday end
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss plot for yday end
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss", xlab = "Day of Year", ylab = "Predicted Values")

# brms plot for yday end
plot(d.predict.brms.poisson.yday_end$yday_end, 
     d.predict.brms.poisson.yday_end$pred.values.brms.poisson,
     type = "l", main = "brms", xlab = "Day of Year", ylab = "Predicted Values")

# rstanarm plot for yday end
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm", xlab = "Day of Year", ylab = "Predicted Values")

# gamm4 plot for yday end
plot(mod.gamm4.poisson.ydays$yday_end, 
     mod.gamm4.poisson.ydays$predicted,
     type = "l", main = "gamm4", xlab = "Day of Year", ylab = "Predicted Values")

# qgam plot for yday end
plot(d.predict.qgam.poisson.yday_end$yday_end, 
     d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson,
     type = "l", main = "qgam", xlab = "Day of Year", ylab = "Predicted Values")

# spikeSlabGAM plot für yday end (ähnlich wie INLA)
#plot(yday.smooth.spikeSlabGAM$yday_end, yday.smooth.spikeSlabGAM$mean, type = "l", col = "blue",
 #    ylim = range(yday.smooth.spikeSlabGAM$lower, yday.smooth.spikeSlabGAM$upper),
#     main = "spikeSlabGAM: Smooth Effect for yday_end", 
#     xlab = "Day of Year", ylab = "Effect")
#lines(yday.smooth.spikeSlabGAM$yday_end, yday.smooth.spikeSlabGAM$lower, col = "red", lty = 2)
#lines(yday.smooth.spikeSlabGAM$yday_end, yday.smooth.spikeSlabGAM$upper, col = "red", lty = 2)

plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB", xlab = "Day of Year", ylab = "Predicted Values")

# INLA RW1 plot for yday end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "blue",
     ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = "INLA poisson RW1", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "red", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "red", lty = 2)

# INLA RW2 plot for yday end
plot(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_rw2$lower, yday.smooth_rw2$upper),
     main = "INLA poisson RW2", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "red", lty = 2)

#R2Bayesx has to be last again! else it won't work
plot(mod.r2bayesx.poisson, term = "sx(yday_end)", main = "r2bayesx")

# title
mtext("Smooth Effect poisson distribution for yday_end", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```



---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#NB Models

### mgcv with no PC=0 

```{r }
mod.mgcv.gam.nb.no_pc <- gam(Aa.adults ~ s(weeks.since.treatment) +
                     s(yday_end) +
                     s(region, bs = "re") +
                     s(site, bs = "re") +
                     s(manhole, bs = "re"),
                   method = "REML",
                   family = "nb",
                   data = model_data)
```

Summary, mgcv, gam, no pc=0:

Significant difference in random effects (region, site, manhole).
Smooth effects and R-squared remain unchanged.
Minor differences in other parameters (intercept, Std. Error, Z-value).
Same significance indicators (., *, ***).


```{r }
summary(mod.mgcv.gam.nb.no_pc)
```

Variance of random effects: in summary
```{r}
# Extract variances and standard deviations of the random effects
random_effects_variance <- gam.vcomp(mod.mgcv.gam.nb.no_pc)

# calculate std,
manhole_std_dev <- sqrt(manhole_variance)

# print
print(paste("Varianz für 'manhole':", manhole_variance))
print(paste("Standardabweichung für 'manhole':", manhole_std_dev))

```


visualization smooth effects:

No longer fixed at one point at the top, as there is no PC. At the beginning, the confidence interval is wider but becomes narrower afterward
```{r }
plot(mod.mgcv.gam.nb.no_pc, select = 1,
     trans = exp,
     ylim = c(0,1))
```


random effects:
Region's standard deviation increased from 0.012 to 0.017.
The others do not show a significant difference compared to mgcv with pc=0.
```{r }
gam.vcomp(mod.mgcv.gam.nb.no_pc,)
```

```{r}
# Create a prediction dataset for weeks.since.treatment ranging from 0 to 21 and fix yday_end
d.predict.gam.nb.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",                 
  site = "A1",                  
  manhole = 1                  
)

# calculate pred, for weeks.since.treatment negativen Binomial-GAM-Model
d.predict.gam.nb.weeks$pred.values.gam.nb <- predict(
  mod.mgcv.gam.nb.no_pc,
  newdata = d.predict.gam.nb.weeks,
  type = "response"
)

# Plot smooth effects weeks.since.treatment
plot(pred.values.gam.nb ~ weeks.since.treatment, data = d.predict.gam.nb.weeks,
     main = "Predicted Values Over Weeks Since Treatment (NB GAM)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (NB GAM)")

```

```{r}
# Create a prediction dataset for yday_end 
d.predict.gam.nb.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  # fixed
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                 
  site = "A1",                 
  manhole = 1                   
)

# calculate pred, for yday_end,  negative Binomial-GAM-Model
d.predict.gam.nb.yday_end$pred.values.gam.nb <- predict(
  mod.mgcv.gam.nb.no_pc,
  newdata = d.predict.gam.nb.yday_end,
  type = "response"
)

# Plot smooth effect for yday_end
plot(pred.values.gam.nb ~ yday_end, data = d.predict.gam.nb.yday_end,
     main = "Predicted Values Over yday_end (NB GAM)",
     xlab = "Day of Year",
     ylab = "Predicted Values (NB GAM)")

```

#################### CRITERIA'S #####################

AIC & BIC
```{r}
# AIC & BIC
aic_value <- AIC(mod.mgcv.gam.nb.no_pc)
bic_value <- BIC(mod.mgcv.gam.nb.no_pc)

print(paste("AIC:", round(aic_value, 6)))
print(paste("BIC:", round(bic_value, 6)))

```

R squared
```{r}
# R² approximate
predicted_values <- predict(mod.mgcv.gam.nb.no_pc, type = "response")
observed_values <- model_data$Aa.adults

# calculate variances
var_pred <- var(predicted_values)
var_residual <- var(observed_values - predicted_values)

# calculate R² 
r_squared <- var_pred / (var_pred + var_residual)

print(paste("R² (approx):", round(r_squared, 6)))

```



### gamlss model, NBI

fit model
```{r }
library(gamlss)

mod.gamlss.nb1 <- gamlss(
  formula = Aa.adults ~ pb(weeks.since.treatment) +
    pb(yday_end) +
    re(random=~1|region) + 
    re(random=~1|site) + 
    re(random=~1|manhole),
  family = NBI(),
  data = model_data,
  control = gamlss.control(n.cyc = 100)  # for more Iterations
)
```

summary, gamlss, nb1
```{r }
summary(mod.gamlss.nb1)
```

Variance of random effects
```{r}
#! Problem: no infos infos about random effects
```


```{r}
# Create a prediction dataset forweeks.since.treatment
d.predict.gamlss.nb1.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# calculate pred. for weeks.since.treatment, gamlss NB1-Modell
d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1 <- predict(
  mod.gamlss.nb1,
  newdata = d.predict.gamlss.nb1.weeks,
  type = "response"
)

# Plot for smooth effect of weeks.since.treatment
plot(pred.values.gamlss.nb1 ~ weeks.since.treatment, data = d.predict.gamlss.nb1.weeks,
     main = "Predicted Values Over Weeks Since Treatment (gamlss NBI)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (gamlss NBI)")

```


```{r}
# Create a prediction dataset for yday_end 
d.predict.gamlss.nb1.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                  
  manhole = 1                  
)

# calculate pred. for yday_end, gamlss NB1-Modell
d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1 <- predict(
  mod.gamlss.nb1,
  newdata = d.predict.gamlss.nb1.yday_end,
  type = "response"
)

# Plot smooth effect, yday_end
plot(pred.values.gamlss.nb1 ~ yday_end, data = d.predict.gamlss.nb1.yday_end,
     main = "Predicted Values Over yday_end (gamlss NBI)",
     xlab = "Day of Year",
     ylab = "Predicted Values (gamlss NBI)")
```


### gamlss model, mit NBII verteilung

fit model
```{r }
mod.gamlss.nb2 <- gamlss(
  formula = Aa.adults ~ pb(weeks.since.treatment) +
    pb(yday_end) +
    re(random=~1|region) + 
    re(random=~1|site) + 
    re(random=~1|manhole),
  family = NBII(),
  data = model_data,
  control = gamlss.control(n.cyc = 100)  # for more iterations
)
```

summary, gamlss, NBII
```{r }
summary(mod.gamlss.nb2)
```

```{r}
# Create a prediction dataset for yday_end
d.predict.gamlss.nb2.yday_end <- expand.grid(
  weeks.since.treatment = 3.5,  
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                  
  manhole = 1                   
)

# calculate pred. for yday_end, gamlss NBII-Modell
d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2 <- predict(
  mod.gamlss.nb2,
  newdata = d.predict.gamlss.nb2.yday_end,
  type = "response"
)

# Plot for smooth effect, yday_end
plot(pred.values.gamlss.nb2 ~ yday_end, data = d.predict.gamlss.nb2.yday_end,
     main = "Predicted Values Over yday_end (gamlss NBII)",
     xlab = "Day of Year",
     ylab = "Predicted Values (gamlss NBII)")

```

```{r}
# Create a prediction dataset for weeks.since.treatment
d.predict.gamlss.nb2.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# calculate pred. for weeks.since.treatment, gamlss NBII-Modell
d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2 <- predict(
  mod.gamlss.nb2,
  newdata = d.predict.gamlss.nb2.weeks,
  type = "response"
)

# Plot smooth effect, weeks.since.treatment
plot(pred.values.gamlss.nb2 ~ weeks.since.treatment, data = d.predict.gamlss.nb2.weeks,
     main = "Predicted Values Over Weeks Since Treatment (gamlss NBII)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Values (gamlss NBII)")

```
#################### CRITERIA'S #####################

AIC & BIC:

```{r}
# For NB1
aic_nb1 <- AIC(mod.gamlss.nb1)
bic_nb1 <- BIC(mod.gamlss.nb1)

print(paste("AIC (NB1):", round(aic_nb1, 6)))
print(paste("BIC (NB1):", round(bic_nb1, 6)))

```

```{r}
# For NB2
aic_nb2 <- AIC(mod.gamlss.nb2)
bic_nb2 <- BIC(mod.gamlss.nb2)

print(paste("AIC (NB2):", round(aic_nb2, 6)))
print(paste("BIC (NB2):", round(bic_nb2, 6)))
```

R squared
```{r}
# R² for NB1
predicted_nb1 <- fitted(mod.gamlss.nb1, "mu") 
observed <- model_data$Aa.adults

var_pred_nb1 <- var(predicted_nb1)
var_residual_nb1 <- var(observed - predicted_nb1)

r2_nb1 <- var_pred_nb1 / (var_pred_nb1 + var_residual_nb1)
print(paste("R² (NB1):", round(r2_nb1, 6)))
```

```{r}
# For NB2
predicted_nb2 <- fitted(mod.gamlss.nb2, "mu")  # Verwende "mu" für die Antwortwerte

var_pred_nb2 <- var(predicted_nb2)
var_residual_nb2 <- var(observed - predicted_nb2)

r2_nb2 <- var_pred_nb2 / (var_pred_nb2 + var_residual_nb2)
print(paste("R² (NB2):", round(r2_nb2, 6)))
```



#### INLA, NBI, RW 1 


Fit model with NB1
```{r }
#result.inla.nb1_rw1 <- inla(mod.inla_rw1, family = "nbinomial", data = model_data, control.predictor = list(compute = TRUE))
# new with crietia in formel:

result.inla.nb1_rw1 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw2") + 
               f(yday_end, model = "rw2") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "nbinomial",
  data = model_data,
  control.predictor = list(compute = TRUE),
  control.compute = list(waic = TRUE, dic = TRUE, cpo = TRUE)
)
```

```{r }
summary(result.inla.nb1_rw1)
```

Variance of Random effects
```{r}
# precision for 'manhole'
precision_manhole <- result.inla.nb1_rw1$summary.hyperpar["Precision for manhole", "mean"]

# calculate variance (Varianz = 1 / Präzision)
manhole_variance <- 1 / precision_manhole

# calculate std. (Standardabweichung = sqrt(Varianz))
manhole_stddev <- sqrt(manhole_variance)

# caclulate CI
ci_precision_manhole <- result.inla.nb1_rw1$summary.hyperpar["Precision for manhole", c("0.025quant", "0.975quant")]
ci_variance_manhole <- 1 / rev(ci_precision_manhole)  

print(paste("Varianz für 'manhole':", manhole_variance))
print(paste("Standardabweichung für 'manhole':", manhole_stddev))
print(paste("95%-CI für Varianz für 'manhole': [", ci_variance_manhole[1], ", ", ci_variance_manhole[2], "]"))

```


```{r}
# extract smooth effects for NB1 RW1 Modell
weeks_effect_nb1_rw1 <- result.inla.nb1_rw1$summary.random$`weeks.since.treatment`
yday_effect_nb1_rw1 <- result.inla.nb1_rw1$summary.random$yday_end

# create dataframe fir weeks.since.treatment and yday_end
weeks.smooth_nb1_rw1 <- data.frame(
  weeks.since.treatment = weeks_effect_nb1_rw1$ID,
  mean = weeks_effect_nb1_rw1$mean,
  lower = weeks_effect_nb1_rw1$`0.025quant`,
  upper = weeks_effect_nb1_rw1$`0.975quant`
)

yday.smooth_nb1_rw1 <- data.frame(
  yday_end = yday_effect_nb1_rw1$ID,
  mean = yday_effect_nb1_rw1$mean,
  lower = yday_effect_nb1_rw1$`0.025quant`,
  upper = yday_effect_nb1_rw1$`0.975quant`
)

# Plot for weeks.since.treatment NB1 RW1
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "blue",
     main = "INLA NB1 RW1: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, col = "black", lty = 1)
```
```{r}
# Plot for yday_end NB1 RW1
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "blue",
     main = "INLA NB1 RW1: Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "red", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, col = "black", lty = 1)
```


The lower line is not visible, so use a ribbon at the bottom: 

```{r}
library(ggplot2)

ggplot(weeks.smooth_nb1_rw1, aes(x = weeks.since.treatment)) +
  geom_line(aes(y = mean), color = "blue") +
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "red", alpha = 0.2) +
  labs(title = "INLA NB1 RW1: Smooth Effect for Weeks Since Treatment", 
       x = "Weeks Since Treatment", y = "Effect")

```


#### INLA, NBII, RW 1 

Fir motdel with NB2
```{r }
#result.inla.nb2_rw1 <- inla(mod.inla_rw1, family = "nbinomial2", data = model_data, control.predictor = list(compute = TRUE))
# new with crieria in formula:

result.inla.nb2_rw1 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw2") + 
               f(yday_end, model = "rw2") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "nbinomial",
  data = model_data,
  control.predictor = list(compute = TRUE),
  control.compute = list(waic = TRUE, dic = TRUE, cpo = TRUE)
)

```

```{r }
summary(result.inla.nb2_rw1)
```

Variance of random effects:
```{r}
# precision for 'manhole'
precision_manhole <- result.inla.nb2_rw1$summary.hyperpar["Precision for manhole", "mean"]

# calculate variance (Varianz = 1 / Präzision)
manhole_variance <- 1 / precision_manhole

# calculate std. (Standardabweichung = sqrt(Varianz))
manhole_stddev <- sqrt(manhole_variance)

# Extract CI
ci_precision_manhole <- result.inla.nb2_rw1$summary.hyperpar["Precision for manhole", c("0.025quant", "0.975quant")]
ci_variance_manhole <- 1 / rev(ci_precision_manhole)

print(paste("Varianz für 'manhole':", round(manhole_variance, 6)))
print(paste("Standardabweichung für 'manhole':", round(manhole_stddev, 6)))
print(paste("95%-CI für Varianz für 'manhole': [", round(ci_variance_manhole[1], 6), ", ", round(ci_variance_manhole[2], 6), "]"))

```



```{r}
# Extract results for weeks.since.treatment forNB2 RW1
weeks_effect_nb2_rw1 <- result.inla.nb2_rw1$summary.random$weeks.since.treatment

# create data frame for smooth terms for weeks.since.treatment
weeks.smooth_nb2_rw1 <- data.frame(
  weeks.since.treatment = weeks_effect_nb2_rw1$ID,
  mean = weeks_effect_nb2_rw1$mean,
  lower = weeks_effect_nb2_rw1$`0.025quant`,
  upper = weeks_effect_nb2_rw1$`0.975quant`
)

# Plot for weeks.since.treatment NB2 RW1
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "blue",
     main = "INLA NB2 RW1: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, col = "black", lty = 1)

# Extract results for yday_end für NB2 RW1
yday_effect_nb2_rw1 <- result.inla.nb2_rw1$summary.random$yday_end

# create data frame for smooth terms for yday_end
yday.smooth_nb2_rw1 <- data.frame(
  yday_end = yday_effect_nb2_rw1$ID,
  mean = yday_effect_nb2_rw1$mean,
  lower = yday_effect_nb2_rw1$`0.025quant`,
  upper = yday_effect_nb2_rw1$`0.975quant`
)
```


```{r}
# Plot for yday_end NB2 RW1
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "blue",
     main = "INLA NB2 RW1: Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "red", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, col = "black", lty = 1)

```


#### INLA, NBI, RW 2 


Passe das Modell an mit NB1
```{r }
#result.inla.nb1_rw2 <- inla(mod.inla_rw2, family = "nbinomial", data = model_data, control.predictor = list(compute = TRUE))
# new with criteria in formula:

result.inla.nb1_rw2 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw2") + 
               f(yday_end, model = "rw2") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "nbinomial",
  data = model_data,
  control.predictor = list(compute = TRUE),
  control.compute = list(waic = TRUE, dic = TRUE, cpo = TRUE)
)

```

Variance of random effects:
```{r}
# precision'manhole'
precision_manhole <- result.inla.nb1_rw2$summary.hyperpar["Precision for manhole", "mean"]

# calculate variance (Varianz = 1 / Präzision)
manhole_variance <- 1 / precision_manhole

# calculate std. (Standardabweichung = sqrt(Varianz))
manhole_stddev <- sqrt(manhole_variance)

# Extract CI
ci_precision_manhole <- result.inla.nb1_rw2$summary.hyperpar["Precision for manhole", c("0.025quant", "0.975quant")]

# calculate CI of variance (invertiert)
ci_variance_manhole <- 1 / rev(ci_precision_manhole)

print(paste("Varianz für 'manhole':", round(manhole_variance, 6)))
print(paste("Standardabweichung für 'manhole':", round(manhole_stddev, 6)))
print(paste("95%-CI für Varianz für 'manhole': [", round(ci_variance_manhole[1], 6), ", ", round(ci_variance_manhole[2], 6), "]"))

```


Zeige die Zusammenfassung der Ergebnisse an
```{r }
summary(result.inla.nb1_rw2)
```

```{r}
# extract results for weeks.since.treatment for NB1 RW2
weeks_effect_nb1_rw2 <- result.inla.nb1_rw2$summary.random$weeks.since.treatment

# create dataframe for smooth effects for weeks.since.treatment
weeks.smooth_nb1_rw2 <- data.frame(
  weeks.since.treatment = weeks_effect_nb1_rw2$ID,
  mean = weeks_effect_nb1_rw2$mean,
  lower = weeks_effect_nb1_rw2$`0.025quant`,
  upper = weeks_effect_nb1_rw2$`0.975quant`
)

# Plot for weeks.since.treatment NB1 RW2
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "blue",
     main = "INLA NB1 RW2: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, col = "black", lty = 1)

```


```{r}
# Extract results for yday_end for NB1 RW2
yday_effect_nb1_rw2 <- result.inla.nb1_rw2$summary.random$yday_end

# create dataframe for smooth effects for yday_end
yday.smooth_nb1_rw2 <- data.frame(
  yday_end = yday_effect_nb1_rw2$ID,
  mean = yday_effect_nb1_rw2$mean,
  lower = yday_effect_nb1_rw2$`0.025quant`,
  upper = yday_effect_nb1_rw2$`0.975quant`
)

# Plot for yday_end NB1 RW2
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "blue",
     main = "INLA NB1 RW2: Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "red", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, col = "black", lty = 1)

```



####  INLA, NBII, RW 2 


Fit model with NB2
```{r }
#result.inla.nb2_rw2 <- inla(mod.inla_rw2, family = "nbinomial2", data = model_data, control.predictor = list(compute = TRUE))
# new with criteria in formula:

result.inla.nb2_rw2 <- inla(
  Aa.adults ~ f(weeks.since.treatment, model = "rw2") + 
               f(yday_end, model = "rw2") + 
               f(region, model = "iid") + 
               f(site, model = "iid") + 
               f(manhole, model = "iid"),
  family = "nbinomial",
  data = model_data,
  control.predictor = list(compute = TRUE),
  control.compute = list(waic = TRUE, dic = TRUE, cpo = TRUE)
)
```

```{r }
summary(result.inla.nb2_rw2)
```

Variance of random effects:
```{r}
# precision manhole
precision_manhole <- result.inla.nb2_rw2$summary.hyperpar["Precision for manhole", "mean"]

#calculate variance (Varianz = 1 / Präzision)
manhole_variance <- 1 / precision_manhole

# calculate std. (Standardabweichung = sqrt(Varianz))
manhole_stddev <- sqrt(manhole_variance)

# Ectract CI from precision
ci_precision_manhole <- result.inla.nb2_rw2$summary.hyperpar["Precision for manhole", c("0.025quant", "0.975quant")]

# caclulate CI of variance (invertiert)
ci_variance_manhole <- 1 / rev(ci_precision_manhole)

print(paste("Varianz für 'manhole':", round(manhole_variance, 6)))
print(paste("Standardabweichung für 'manhole':", round(manhole_stddev, 6)))
print(paste("95%-CI für Varianz für 'manhole': [", round(ci_variance_manhole[1], 6), ", ", round(ci_variance_manhole[2], 6), "]"))

```


```{r}
# Extract results for weeks.since.treatment, NB2 RW2
weeks_effect_nb2_rw2 <- result.inla.nb2_rw2$summary.random$weeks.since.treatment

# Create data frame for smooth terms for weeks.since.treatment
weeks.smooth_nb2_rw2 <- data.frame(
  weeks.since.treatment = weeks_effect_nb2_rw2$ID,
  mean = weeks_effect_nb2_rw2$mean,
  lower = weeks_effect_nb2_rw2$`0.025quant`,
  upper = weeks_effect_nb2_rw2$`0.975quant`
)

# Plot for weeks.since.treatment NB2 RW2
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "blue",
     main = "INLA NB2 RW2: Smooth Effect for Weeks Since Treatment", 
     xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, col = "black", lty = 1)

# Extract results for yday_end für NB2 RW2
yday_effect_nb2_rw2 <- result.inla.nb2_rw2$summary.random$yday_end

# Create data frame for smooth terms for yday_end
yday.smooth_nb2_rw2 <- data.frame(
  yday_end = yday_effect_nb2_rw2$ID,
  mean = yday_effect_nb2_rw2$mean,
  lower = yday_effect_nb2_rw2$`0.025quant`,
  upper = yday_effect_nb2_rw2$`0.975quant`
)

```

```{r}
# Plot yday_end NB2 RW2
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "blue",
     main = "INLA NB2 RW2: Smooth Effect for yday_end", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "red", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, col = "black", lty = 1)

```

#################### CRITERIA'S #####################


NB1 RW1

WAIC & DIC 
```{r}
# NB1 RW1
waic_nb1_rw1 <- result.inla.nb1_rw1$waic$waic
dic_nb1_rw1 <- result.inla.nb1_rw1$dic$dic
cat("NB1 RW1 - WAIC:", round(waic_nb1_rw1, 6), "DIC:", round(dic_nb1_rw1, 6), "\n")
```

R squared

```{r}
# Predicted and observed values for NB1 RW1
predicted_nb1_rw1 <- result.inla.nb1_rw1$summary.fitted.values$mean
observed_nb1_rw1 <- model_data$Aa.adults

# Calculate variances
var_pred_nb1_rw1 <- var(predicted_nb1_rw1, na.rm = TRUE)
var_resid_nb1_rw1 <- var(observed_nb1_rw1 - predicted_nb1_rw1, na.rm = TRUE)

# Compute Bayesian R²
r2_nb1_rw1 <- var_pred_nb1_rw1 / (var_pred_nb1_rw1 + var_resid_nb1_rw1)

# Output R² for NB1 RW1
cat("NB1 RW1 - R²:", round(r2_nb1_rw1, 6), "\n")
```


NB1 RW2

WAIC & DIC 
```{r}
# NB1 RW1
waic_nb1_rw2 <- result.inla.nb1_rw2$waic$waic
dic_nb1_rw2 <- result.inla.nb1_rw2$dic$dic
cat("NB1 RW2 - WAIC:", round(waic_nb1_rw2, 6), "DIC:", round(dic_nb1_rw2, 6), "\n")
```

R squared
```{r}
# Predicted and observed values for NB1 RW2
predicted_nb1_rw2 <- result.inla.nb1_rw2$summary.fitted.values$mean
observed_nb1_rw2 <- model_data$Aa.adults

# Variance calculations
var_pred_nb1_rw2 <- var(predicted_nb1_rw2, na.rm = TRUE)
var_resid_nb1_rw2 <- var(observed_nb1_rw2 - predicted_nb1_rw2, na.rm = TRUE)

# Bayesian R²
r2_nb1_rw2 <- var_pred_nb1_rw2 / (var_pred_nb1_rw2 + var_resid_nb1_rw2)

# Print R²
cat("NB1 RW2 - R²:", round(r2_nb1_rw2, 6), "\n")

```


NB2 RW1

WAIC & DIC 
```{r}
# NB1 RW1
waic_nb2_rw1 <- result.inla.nb2_rw1$waic$waic
dic_nb2_rw1 <- result.inla.nb2_rw1$dic$dic
cat("NB2 RW1 - WAIC:", round(waic_nb2_rw1, 6), "DIC:", round(dic_nb2_rw1, 6), "\n")
```

R squared
```{r}
# Predicted and observed values for NB2 RW1
predicted_nb2_rw1 <- result.inla.nb2_rw1$summary.fitted.values$mean
observed_nb2_rw1 <- model_data$Aa.adults

# Variance calculations
var_pred_nb2_rw1 <- var(predicted_nb2_rw1, na.rm = TRUE)
var_resid_nb2_rw1 <- var(observed_nb2_rw1 - predicted_nb2_rw1, na.rm = TRUE)

# Bayesian R²
r2_nb2_rw1 <- var_pred_nb2_rw1 / (var_pred_nb2_rw1 + var_resid_nb2_rw1)

# Print R²
cat("NB2 RW1 - R²:", round(r2_nb2_rw1, 6), "\n")

```


NB2 RW2

WAIC & DIC 
```{r}
# NB1 RW1
waic_nb2_rw2 <- result.inla.nb2_rw2$waic$waic
dic_nb2_rw2 <- result.inla.nb2_rw2$dic$dic
cat("NB2 RW2 - WAIC:", round(waic_nb2_rw2, 6), "DIC:", round(dic_nb2_rw2, 6), "\n")
```

R squared
```{r}
# Predicted and observed values for NB2 RW2
predicted_nb2_rw2 <- result.inla.nb2_rw2$summary.fitted.values$mean
observed_nb2_rw2 <- model_data$Aa.adults

# Variance calculations
var_pred_nb2_rw2 <- var(predicted_nb2_rw2, na.rm = TRUE)
var_resid_nb2_rw2 <- var(observed_nb2_rw2 - predicted_nb2_rw2, na.rm = TRUE)

# Bayesian R²
r2_nb2_rw2 <- var_pred_nb2_rw2 / (var_pred_nb2_rw2 + var_resid_nb2_rw2)

# Print R²
cat("NB2 RW2 - R²:", round(r2_nb2_rw2, 6), "\n")

```




### GLMMTMB, NB1 
```{r }
library(glmmTMB)
# For model with B-Splines
mod.glmmTMB.nb1 <- glmmTMB(
  Aa.adults ~ weeks_since_treatment_spline + yday_end_spline +
    (1 | region) + (1 | site) + (1 | manhole),
  family = nbinom1(link = "log"),
  data = model_data
)
```

```{r }
summary(mod.glmmTMB.nb1)
```

Variance of random effects:
```{r}
# Extrct variance for 'manhole', glmmTMB
random_effects_variance_glmmTMB <- VarCorr(mod.glmmTMB.nb1)
manhole_variance_glmmTMB <- as.numeric(random_effects_variance_glmmTMB$cond$manhole[1, 1])

# calcualte std. dev.
manhole_stddev_glmmTMB <- sqrt(manhole_variance_glmmTMB)

# Calculate confidence intervals for random effects with confint()
confint_random_effects <- confint(mod.glmmTMB.nb1, parm = "theta_", level = 0.95)

# Extract CI for 'manhole'
manhole_ci_glmmTMB <- confint_random_effects[grepl("manhole", rownames(confint_random_effects)), ]

# results
print(paste("Varianz für 'manhole':", round(manhole_variance_glmmTMB, 6)))
print(paste("Standardabweichung für 'manhole':", round(manhole_stddev_glmmTMB, 6)))
print(paste("95%-CI für Varianz für 'manhole': [", round(manhole_ci_glmmTMB[1]^2, 6), ", ", round(manhole_ci_glmmTMB[2]^2, 6), "]"))
```


```{r}
# Create a prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215
mod.glmmTMB.nb1.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                
  site = "A1",                 
  manhole = 1                
)

# Convert weeks.since.treatment and yday_end into B-splines to match the model
mod.glmmTMB.nb1.weeks$weeks_since_treatment_spline <- predict(
  bs(model_data$weeks.since.treatment, degree = 3, df = 3),
  newx = mod.glmmTMB.nb1.weeks$weeks.since.treatment
)

mod.glmmTMB.nb1.weeks$yday_end_spline <- predict(
  bs(model_data$yday_end, degree = 3, df = 3),
  newx = mod.glmmTMB.nb1.weeks$yday_end
)

# calculate pred. for weeks.since.treatment 
mod.glmmTMB.nb1.weeks$predicted <- predict(
  mod.glmmTMB.nb1,
  newdata = mod.glmmTMB.nb1.weeks,
  type = "response",
  allow.new.levels = TRUE
)

# Plot pred for weeks.since.treatment
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.nb1.weeks,
     main = "Predicted Effect of Weeks Since Treatment (NB1)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial 1)")

```

```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5
mod.glmmTMB.nb1.ydays <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                 
  manhole = 1                  
)

# Convert weeks.since.treatment and yday_end into B-splines for mod.glmmTMB.nb1.ydays
mod.glmmTMB.nb1.ydays$weeks_since_treatment_spline <- predict(
  bs(model_data$weeks.since.treatment, degree = 3, df = 3),
  newx = mod.glmmTMB.nb1.ydays$weeks.since.treatment
)

mod.glmmTMB.nb1.ydays$yday_end_spline <- predict(
  bs(model_data$yday_end, degree = 3, df = 3),
  newx = mod.glmmTMB.nb1.ydays$yday_end
)

# calculate pred. for yday_end
mod.glmmTMB.nb1.ydays$predicted <- predict(
  mod.glmmTMB.nb1,
  newdata = mod.glmmTMB.nb1.ydays,
  type = "response",
  allow.new.levels = TRUE
)

# Plot for yday_end pred.
plot(predicted ~ yday_end, data = mod.glmmTMB.nb1.ydays,
     main = "Predicted Effect of Day of Year (NB1)",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial 1)")

```



### GLMMTMB, NB2 
```{r }
# fit model with B-Splines
mod.glmmTMB.nb2 <- glmmTMB(
  Aa.adults ~ weeks_since_treatment_spline + yday_end_spline +
    (1 | region) + (1 | site) + (1 | manhole),
  family = nbinom2(link = "log"),
  data = model_data
)
```

```{r }
summary(mod.glmmTMB.nb2)
```

Variance of random effects:
```{r}
# Extract variance for 'manhole' from glmmTMB
random_effects_variance_glmmTMB <- VarCorr(mod.glmmTMB.nb2)
manhole_variance_glmmTMB <- as.numeric(random_effects_variance_glmmTMB$cond$manhole[1, 1])

# calcualte st dev.
manhole_stddev_glmmTMB <- sqrt(manhole_variance_glmmTMB)

# Calculate confidence intervals for random effects with confint()
confint_random_effects <- confint(mod.glmmTMB.nb2, parm = "theta_", level = 0.95)

# Extract CI for 'manhole'
manhole_ci_glmmTMB <- confint_random_effects[grepl("manhole", rownames(confint_random_effects)), ]

# results
print(paste("Varianz für 'manhole':", round(manhole_variance_glmmTMB, 6)))
print(paste("Standardabweichung für 'manhole':", round(manhole_stddev_glmmTMB, 6)))
print(paste("95%-CI für Varianz für 'manhole': [", round(manhole_ci_glmmTMB[1]^2, 6), ", ", round(manhole_ci_glmmTMB[2]^2, 6), "]"))

```

```{r }
# CI for fixed effects
ci_fixed <- confint(mod.glmmTMB.nb1, parm = "beta_", level = 0.95)
cat("Confidence Intervals (Fixed Effects):\n")
print(ci_fixed)

```


```{r }
# Variance of RE's
random_effects_var <- VarCorr(mod.glmmTMB.nb1)
cat("Variance of Random Effects:\n")
print(random_effects_var)

```


```{r }
# plot: pred. vs obs. vaules
fitted_values <- predict(mod.glmmTMB.nb1, type = "response")
observed_values <- model_data$Aa.adults

plot(observed_values, fitted_values, 
     main = "Predictions vs Observed Values", 
     xlab = "Observed Values", ylab = "Fitted Values", col = "blue", pch = 20)
abline(0, 1, col = "red")

```


Visualize smooth terms:
```{r}
# Create a prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215.
mod.glmmTMB.nb2.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                
  site = "A1",                 
  manhole = 1                 
)

# Convert weeks.since.treatment and yday_end into B-splines to match the model.
mod.glmmTMB.nb2.weeks$weeks_since_treatment_spline <- predict(
  bs(model_data$weeks.since.treatment, degree = 3, df = 3),
  newx = mod.glmmTMB.nb2.weeks$weeks.since.treatment
)

mod.glmmTMB.nb2.weeks$yday_end_spline <- predict(
  bs(model_data$yday_end, degree = 3, df = 3),
  newx = mod.glmmTMB.nb2.weeks$yday_end
)

# calcuate predictions forweeks.since.treatment 
mod.glmmTMB.nb2.weeks$predicted <- predict(
  mod.glmmTMB.nb2,
  newdata = mod.glmmTMB.nb2.weeks,
  type = "response",
  allow.new.levels = TRUE
)

# Plot pred. for weeks.since.treatment
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.nb2.weeks,
     main = "Predicted Effect of Weeks Since Treatment (NB2)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial 2)")

```

```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5
mod.glmmTMB.nb2.ydays <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                 
  manhole = 1                  
)

# Convert weeks.since.treatment and yday_end into B-splines for mod.glmmTMB.nb2.ydays.
mod.glmmTMB.nb2.ydays$weeks_since_treatment_spline <- predict(
  bs(model_data$weeks.since.treatment, degree = 3, df = 3),
  newx = mod.glmmTMB.nb2.ydays$weeks.since.treatment
)

mod.glmmTMB.nb2.ydays$yday_end_spline <- predict(
  bs(model_data$yday_end, degree = 3, df = 3),
  newx = mod.glmmTMB.nb2.ydays$yday_end
)

# calcualte pred for yday_end
mod.glmmTMB.nb2.ydays$predicted <- predict(
  mod.glmmTMB.nb2,
  newdata = mod.glmmTMB.nb2.ydays,
  type = "response",
  allow.new.levels = TRUE
)

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.glmmTMB.nb2.ydays,
     main = "Predicted Effect of Day of Year (NB2)",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial 2)")

```

********************* CRITERIA'S


glmmTMB NB1

AIC + BIC ( aslo in summary available)
```{r }
AIC_value <- AIC(mod.glmmTMB.nb1)
BIC_value <- BIC(mod.glmmTMB.nb1)
cat("AIC:", AIC_value, "\n")
cat("BIC:", BIC_value, "\n")

```

R- squared

```{r}
library(performance)

# Calculate predicted values for the glmmTMB model (NB1)
pred_glmmTMB_nb1 <- predict(mod.glmmTMB.nb1, type = "response")

# observed values
obs_glmmTMB_nb1 <- model_data$Aa.adults

# calculate variances
var_pred_glmmTMB_nb1 <- var(pred_glmmTMB_nb1)
var_residual_glmmTMB_nb1 <- var(obs_glmmTMB_nb1 - pred_glmmTMB_nb1)

# Bayesian R² for glmmTMB (NB1)
R2_glmmTMB_nb1 <- var_pred_glmmTMB_nb1 / (var_pred_glmmTMB_nb1 + var_residual_glmmTMB_nb1)
R2_glmmTMB_nb1

```

CI
```{r}
# Confidence Intervals for Fixed Effects (NB1)
ci_fixed_nb1 <- confint(mod.glmmTMB.nb1, parm = "beta_", level = 0.95)
cat("Confidence Intervals for Fixed Effects (NB1):\n")
print(ci_fixed_nb1)

```

Variances of Random effects:
```{r}
# Variance of Random Effects (NB1)
random_effects_var_nb1 <- VarCorr(mod.glmmTMB.nb1)
cat("Variance of Random Effects (NB1):\n")
print(random_effects_var_nb1)
```


glmmTMB NB2

AIC & BIC
```{r }
AIC_value <- AIC(mod.glmmTMB.nb2)
BIC_value <- BIC(mod.glmmTMB.nb2)
cat("AIC:", AIC_value, "\n")
cat("BIC:", BIC_value, "\n")

```

R squared
```{r}
library(performance)

# Calculate predicted values for the glmmTMB model (NB2)
pred_glmmTMB_nb2 <- predict(mod.glmmTMB.nb2, type = "response")

# obs. values
obs_glmmTMB_nb2 <- model_data$Aa.adults

# calculate variances
var_pred_glmmTMB_nb2 <- var(pred_glmmTMB_nb2)
var_residual_glmmTMB_nb2 <- var(obs_glmmTMB_nb2 - pred_glmmTMB_nb2)

# Bayesian R² for glmmTMB (NB2)
R2_glmmTMB_nb2 <- var_pred_glmmTMB_nb2 / (var_pred_glmmTMB_nb2 + var_residual_glmmTMB_nb2)
R2_glmmTMB_nb2

```

CI NB2
```{r}
# Confidence Intervals for Fixed Effects (NB2)
ci_fixed_nb2 <- confint(mod.glmmTMB.nb2, parm = "beta_", level = 0.95)
cat("Confidence Intervals for Fixed Effects (NB2):\n")
print(ci_fixed_nb2)

```


Variance of Random Effects NB2
```{r}
# Variance of Random Effects (NB2)
random_effects_var_nb2 <- VarCorr(mod.glmmTMB.nb2)
cat("Variance of Random Effects (NB2):\n")
print(random_effects_var_nb2)
```

## rstanrm NB 2

```{r}

mod.rstan.nb <- stan_gamm4(
  formula = Aa.adults ~ s(weeks.since.treatment) + s(yday_end),
  random = ~ (1 | region) + (1 | site) + (1 | manhole),
  data = model_data,
  family = neg_binomial_2(link = "log"),
  control = list(adapt_delta = 0.99)  # Higher acceptance rate
)

```

rstan NB smoothterm weeks
```{r}
# Create a prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215.
mod.rstan.nb.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                
  site = "A1",                 
  manhole = 1                 
)

# Calculate the posterior samples for weeks.since.treatment
predicted_matrix_weeks_nb <- posterior_predict(
  mod.rstan.nb,  # use model mod.rstan.nb 
  newdata = mod.rstan.nb.weeks,
  re.form = NA  
)

# Calculate the mean of the posterior samples 
mod.rstan.nb.weeks$predicted <- apply(predicted_matrix_weeks_nb, 2, mean)

# Plot for weeks.since.treatment predicitons
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Predicted Effect of Weeks Since Treatment (Negative Binomial)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial)")

```

smooth term ydays:
```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5.
mod.rstan.nb.ydays <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                 
  manhole = 1                  
)

# calcualte posterior samples for yday_end
predicted_matrix_ydays_nb <- posterior_predict(
  mod.rstan.nb,  
  newdata = mod.rstan.nb.ydays,
  re.form = NA 
)

# Calculate the mean of the posterior samples for each row.
mod.rstan.nb.ydays$predicted <- apply(predicted_matrix_ydays_nb, 2, mean)

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Predicted Effect of Day of Year (Negative Binomial)",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial)")

```

############# CRITERIA'S ################

Bayesian R2
```{r}
# Posterior predicted values
predicted <- posterior_predict(mod.rstan.nb)

# obs. values
observed <- model_data$Aa.adults

# calcukate variance
var_pred <- apply(predicted, 1, var)
var_residual <- apply((observed - predicted), 1, var)

# calcualate Bayesian R² manually
r2_manual <- mean(var_pred / (var_pred + var_residual))
print(r2_manual)

# Note: `bayes_R2()` is not available for Negative Binomial

```

WAIC & LOO
```{r}
# LOO 
loo_result <- loo(mod.rstan.nb)
print(loo_result)

# WAIC 
log_lik <- log_lik(mod.rstan.nb)
waic_values <- loo::waic(log_lik)

# WAIC
print(waic_values)

```

Variance of random effects:
```{r}
# Access to the variances of the random effects
random_effects_nb <- VarCorr(mod.rstan.nb)

# Extract variance for 'manhole'
manhole_variance_nb <- attr(random_effects_nb$manhole, "stddev")^2

# Extract CI for std. dev.
manhole_sd_ci_nb <- attr(random_effects_nb$manhole, "quantiles")[, c("2.5%", "97.5%")]

# Conversion of the standard deviation (CI) to variance (CI)
manhole_variance_ci_nb <- manhole_sd_ci_nb^2

# results
cat("Varianz für 'manhole':", manhole_variance_nb, "\n")
cat("95%-CI der Varianz für 'manhole': [", manhole_variance_ci_nb[1], ", ", manhole_variance_ci_nb[2], "]\n")


```


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SAMMELN: Plot smooth terms


LÖSCHEN? BRAUCHT ES NOCH??
```{r}
# Erstellen der Vorhersagedaten mit festen Werten
# Vorhersagedaten für weeks.since.treatment
d.predict.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,               
  region = "A",                 
  site = "A1",                  
  manhole = 1                   
)

# Vorhersagedaten für yday_end
d.predict.yday <- expand.grid(
  weeks.since.treatment = 3.5,  # Fester Wert für weeks.since.treatment
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                 # Fester Wert für region
  site = "A1",                  # Fester Wert für site
  manhole = 1                   # Fester Wert für manhole
)
```


Smooth terms Grid plott all NB's: weeks
```{r}
# Layout for NB-Models
par(mfrow = c(4, 3), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # Adjust margins

# mgcv gam.nb.no_pc Modell für weeks.since.treatment
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB (no PC)", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# gamlss nb1 Modell for weeks.since.treatment
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# gamlss nb2 Modell for weeks.since.treatment
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NBII", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# INLA NB1 RW1 Modell for weeks.since.treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "red", lty = 2)

# INLA NB2 RW1 Modell for weeks.since.treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "red", lty = 2)

# INLA NB1 RW2 Modell for weeks.since.treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "red", lty = 2)

# INLA NB2 RW2 Modell for weeks.since.treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "red", lty = 2)

# glmmTMB NB1 Modell for weeks.since.treatment
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# glmmTMB NB2 Modell for weeks.since.treatment
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# Plot for weeks.since.treatment-Vorhersagen
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Predicted Effect of Weeks Since Treatment (Negative Binomial)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial)")

# title
mtext("rstanarm nb2", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

Smooth terms Grid plott nur NB1 modelle 

```{r}
# Layout for NB1-Modelle
par(mfrow = c(2, 2), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # 2x2 Layout

# mgcv gam.nb.no_pc Modell for weeks.since.treatment
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB (no PC)", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# gamlss nb1 Modell for weeks.since.treatment
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# INLA NB1 RW1 Modell for weeks.since.treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "red", lty = 2)

# INLA NB1 RW2 Modell for weeks.since.treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "red", lty = 2)

# title
mtext("Smooth Effect NB1 Models for Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

Smooth terms Grid plott for NB2 modelle: Weeks

```{r}
# Layout
par(mfrow = c(2, 3), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # 2x2 Layout

# gamlss nb2 Modell for weeks.since.treatment
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# INLA NB2 RW1 Modell for weeks.since.treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "red", lty = 2)

# INLA NB2 RW2 Modell for weeks.since.treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "red", lty = 2)

# glmmTMB NB2 Modell for weeks.since.treatment
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# title
mtext("Smooth Effect NB2 Models for Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

# Plot für weeks.since.treatment predictions
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "rstanarm nb2",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial)")

par(mfrow = c(1, 1))
```


Smooth terms Grid plott for all NB's: yday_end
```{r}
# Layout
par(mfrow = c(3, 4), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0))

# mgcv gam.nb.no_pc Modell for yday_end
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB (no PC)", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss nb1 Modell for yday_end
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss nb2 Modell for yday_end
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NBII", xlab = "Day of Year", ylab = "Predicted Values")

# INLA NB1 RW1 Modell for yday_end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb1_rw1$lower, yday.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "red", lty = 2)

# INLA NB2 RW1 Modell for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb2_rw1$lower, yday.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "red", lty = 2)

# INLA NB1 RW2 Modell for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb1_rw2$lower, yday.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "red", lty = 2)

# INLA NB2 RW2 Modell for yday_end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb2_rw2$lower, yday.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "red", lty = 2)

# glmmTMB NB1 Modell for yday_end
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Predicted Response")

# glmmTMB NB2 Modell for yday_end
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Predicted Response")

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "rstanarm nb2",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial)")

mtext("smooth terms for all NB ydays", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

Smooth terms Grid plot NB1 models for Ydays

```{r}
# Layout
par(mfrow = c(2, 2), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # 2x2 Layout

# mgcv gam.nb.no_pc Modell for yday_end
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB (no PC)", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss nb1 Modell for yday_end
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Predicted Values")

# INLA NB1 RW1 Modell for yday_end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb1_rw1$lower, yday.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "red", lty = 2)

# INLA NB1 RW2 Modell for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb1_rw2$lower, yday.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "red", lty = 2)

mtext("Smooth Effect NB1 Models for Day of Year", outer = TRUE, cex = 1.5, font = 2)
par(mfrow = c(1, 1))

```

Smooth terms Grid plot NB2 models: Weeks since treament

```{r}
# Layout
par(mfrow = c(2, 3), mar = c(2, 2, 2, 1), oma = c(0, 0, 4, 0)) # 2x2 Layout

# gamlss nb2 Modell for yday_end
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NBII", xlab = "Day of Year", ylab = "Predicted Values")

# INLA NB2 RW1 Modell for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb2_rw1$lower, yday.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "red", lty = 2)

# INLA NB2 RW2 Modell for yday_end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb2_rw2$lower, yday.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "red", lty = 2)

# glmmTMB NB2 Modell for yday_end
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Predicted Response")

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "rstanarm nb2",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial)")


mtext("Smooth Effect NB2 Models for Day of Year", outer = TRUE, cex = 1.5, font = 2)
par(mfrow = c(1, 1))
```



---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#Quasi Poisson Models

### mgcv, no PC=0, quasipoisson 

```{r }
mod.mgcv.gam.no_pc.quasi <- gam(Aa.adults ~ s(weeks.since.treatment) +
                     s(yday_end) +
                     s(region, bs = "re") +
                     s(site, bs = "re") +
                     s(manhole, bs = "re"),
                   method = "REML",
                   family = "quasipoisson()",
                   data = model_data)

```

```{r }
summary(mod.mgcv.gam.no_pc.quasi)
```

Variance of random effects:
```{r}
gam.vcomp(mod.mgcv.gam.no_pc.quasi)
```


visualize smooth terms:
ein bisschen weniger wiggly, als poisson, dafür breitere CI

```{r }
#Let’s visualise the estimated smooth effects. We start from the weeks.since.treatment effect
plot(mod.mgcv.gam.no_pc.quasi, select = 1,
     trans = exp,
     ylim = c(0,1))
```


Plot für weeks.since.treatment (yday_end fixiert auf 215)
```{r}
# Prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215.
d.predict.gam.quasi.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                
  site = "A1",                
  manhole = 1                  
)

# Calculate predictions for weeks.since.treatment with the GAM quasi-Poisson model
d.predict.gam.quasi.weeks$pred.values.quasi <- predict(
  mod.mgcv.gam.no_pc.quasi,
  newdata = d.predict.gam.quasi.weeks,
  type = "response"
)

# Plot for weeks.since.treatment predictions
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     main = "Predicted Effect of Weeks Since Treatment (Quasi-Poisson)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Quasi-Poisson)")

```

Plot for yday_end (weeks.since.treatment fixed on 3.5)
```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5.
d.predict.gam.quasi.yday <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                 
  manhole = 1                
)

# Calculate predictions for  yday_end, gam-Quasi-Poisson-Modell
d.predict.gam.quasi.yday$pred.values.quasi <- predict(
  mod.mgcv.gam.no_pc.quasi,
  newdata = d.predict.gam.quasi.yday,
  type = "response"
)

# Plot for yday_end predictions
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     main = "Predicted Effect of Day of Year (Quasi-Poisson)",
     xlab = "Day of Year",
     ylab = "Predicted Response (Quasi-Poisson)")

```


####################### CRITERIA'S 

AIC & BIC
```{r}
# AIC and BIC for quasipoisson model
deviance_quasi <- deviance(mod.mgcv.gam.no_pc.quasi)
df_resid_quasi <- mod.mgcv.gam.no_pc.quasi$df.residual
n <- nrow(model_data)

# Quasipoisson dispersion parameter (phi)
phi <- deviance_quasi / df_resid_quasi

# AIC (using dispersion-corrected deviance)
aic_quasi <- n * log(phi) + deviance_quasi + 2 * length(mod.mgcv.gam.no_pc.quasi$coefficients)

# BIC (using dispersion-corrected deviance)
bic_quasi <- n * log(phi) + deviance_quasi + log(n) * length(mod.mgcv.gam.no_pc.quasi$coefficients)

cat("Quasipoisson GAM - AIC:", round(aic_quasi, 6), "\n")
cat("Quasipoisson GAM - BIC:", round(bic_quasi, 6), "\n")

```

R squared
```{r}
# Predicted values for the quasipoisson model
predicted_quasi <- predict(mod.mgcv.gam.no_pc.quasi, type = "response")

# Observed values
observed_quasi <- model_data$Aa.adults

# Variance calculations
var_pred_quasi <- var(predicted_quasi, na.rm = TRUE)
var_resid_quasi <- var(observed_quasi - predicted_quasi, na.rm = TRUE)

# Bayesian R²
r2_quasi <- var_pred_quasi / (var_pred_quasi + var_resid_quasi)

# Print R²
cat("Quasipoisson GAM - R²:", round(r2_quasi, 6), "\n")

```


Variance components of random effects:
```{r }
#?
gam.vcomp(mod.mgcv.gam.no_pc.quasi)
```



---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


#Zero Inflated Models

- gamlss ZIP, mit V2
- gamlss ZINBI

### gamlss model, ZIP distribution

fit model
```{r }
# KONVERGIERT NICHT! auch nicht mit mit V1 (nur manhole als re)
#mod.gamlss.zip <- gamlss(
 # formula = Aa.adults ~ pb(weeks.since.treatment) +
  #  pb(yday_end) +
    #re(random=~1|region) + 
    #re(random=~1|site) + 
   # re(random=~1|manhole),
  #family = ZIP(),
  #data = model_data,
  #control = gamlss.control(n.cyc = 500)  # 500 waren noch nicht genug zum konvergieren, darum v2 probiert
#)
```

```{r}
# V2, norandom effects
mod.gamlss.zip <- gamlss(
  formula = Aa.adults ~ pb(weeks.since.treatment) +
    pb(yday_end) +
    manhole,  # Manhole as fixed effect
  family = ZIP(),
  data = model_data,
  control = gamlss.control(n.cyc = 20)  # Iterations
)

```

```{r }
summary(mod.gamlss.zip)
```

Plot for weeks.since.treatment (yday_end fixed on 215)
```{r}
# Prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215.
d.predict.gamlss.zip.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              # fixed
  manhole = 1                  # fixed
)

# Calculate predictions for weeks.since.treatment, GAMLSS ZIP-Model
d.predict.gamlss.zip.weeks$pred.values.zip <- predict(
  mod.gamlss.zip,
  newdata = d.predict.gamlss.zip.weeks,
  type = "response"
)

# Plot for weeks.since.treatment predictions
plot(pred.values.zip ~ weeks.since.treatment, data = d.predict.gamlss.zip.weeks,
     main = "Predicted Effect of Weeks Since Treatment (ZIP)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (ZIP)")

```

Plot for yday_end (weeks.since.treatment fixed on 3.5)
```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5.
d.predict.gamlss.zip.yday <- expand.grid(
  weeks.since.treatment = 3.5, # fixed
  yday_end = seq(from = 146, to = 286, length = 100),
  manhole = 1                  # fixed
)

# calculate predictions for yday_end, GAMLSS ZIP-Modell
d.predict.gamlss.zip.yday$pred.values.zip <- predict(
  mod.gamlss.zip,
  newdata = d.predict.gamlss.zip.yday,
  type = "response"
)

# Plot for yday_end predictions
plot(pred.values.zip ~ yday_end, data = d.predict.gamlss.zip.yday,
     main = "Predicted Effect of Day of Year (ZIP)",
     xlab = "Day of Year",
     ylab = "Predicted Response (ZIP)")

```

takes around 15- 20 min!
```{r }
mod.gamlss.zinbi <- gamlss(
  formula = Aa.adults ~ pb(weeks.since.treatment) +
    pb(yday_end) +
    re(random=~1|region) + 
    re(random=~1|site) + 
    re(random=~1|manhole),
  family = ZINBI(),
  data = model_data,
  control = gamlss.control(n.cyc = 100)  # Iterations
)
```

```{r}
summary(mod.gamlss.zinbi)
```

Plot for weeks.since.treatment (yday_end fixed on 215)
```{r}
# Prediction dataset for weeks.since.treatment ranging from 0 to 21, with yday_end fixed at 215.
d.predict.gamlss.zinbi.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                
  site = "A1",                 
  manhole = 1                  
)

# calculate predictions for weeks.since.treatment, GAMLSS ZINBI-Model
d.predict.gamlss.zinbi.weeks$pred.values.zinbi <- predict(
  mod.gamlss.zinbi,
  newdata = d.predict.gamlss.zinbi.weeks,
  type = "response"
)

# Plot for weeks.since.treatment predictions
plot(pred.values.zinbi ~ weeks.since.treatment, data = d.predict.gamlss.zinbi.weeks,
     main = "Predicted Effect of Weeks Since Treatment (ZINBI)",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (ZINBI)")

```

Plot for yday_end (weeks.since.treatment fixed on 3.5)
```{r}
# Prediction dataset for yday_end ranging from 146 to 286, with weeks.since.treatment fixed at 3.5.
d.predict.gamlss.zinbi.yday <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                
  manhole = 1                  
)

# Calculate predictions for yday_end, GAMLSS ZINBI-Model
d.predict.gamlss.zinbi.yday$pred.values.zinbi <- predict(
  mod.gamlss.zinbi,
  newdata = d.predict.gamlss.zinbi.yday,
  type = "response"
)

# Plot for yday_end predictions
plot(pred.values.zinbi ~ yday_end, data = d.predict.gamlss.zinbi.yday,
     main = "Predicted Effect of Day of Year (ZINBI)",
     xlab = "Day of Year",
     ylab = "Predicted Response (ZINBI)")

```

Plots
```{r}
#install.packages("ggplot2")
#install.packages("gridExtra")
library(ggplot2)
library(gridExtra)

```

```{r}
# Plot for weeks.since.treatment, ZIP
p1 <- ggplot(d.predict.gamlss.zip.weeks, aes(x = weeks.since.treatment, y = pred.values.zip)) +
  geom_line(color = "blue") +
  labs(
    title = "Weeks Since Treatment (ZIP)",
    x = "Weeks Since Treatment",
    y = "Predicted Response (ZIP)"
  ) +
  theme_minimal()

# Plot for weeks.since.treatment, ZINBI
p3 <- ggplot(d.predict.gamlss.zinbi.weeks, aes(x = weeks.since.treatment, y = pred.values.zinbi)) +
  geom_line(color = "red") +
  labs(
    title = "Weeks Since Treatment (ZINBI)",
    x = "Weeks Since Treatment",
    y = "Predicted Response (ZINBI)"
  ) +
  theme_minimal()


# Plot for yday_end, ZIP
p2 <- ggplot(d.predict.gamlss.zip.yday, aes(x = yday_end, y = pred.values.zip)) +
  geom_line(color = "blue") +
  labs(
    title = "Yday (ZIP)",
    x = "Day of Year",
    y = "Predicted Response (ZIP)"
  ) +
  theme_minimal()


# Plot for yday_end, ZINBI
p4 <- ggplot(d.predict.gamlss.zinbi.yday, aes(x = yday_end, y = pred.values.zinbi)) +
  geom_line(color = "red") +
  labs(
    title = "Yday (ZINBI)",
    x = "Day of Year",
    y = "Predicted Response (ZINBI)"
  ) +
  theme_minimal()

```

```{r}
# layout for grid
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)

```


################ CRITERIA'S 

AIC & BIC

```{r}
# AIC and BIC for ZIP model
aic_zip <- AIC(mod.gamlss.zip)
bic_zip <- BIC(mod.gamlss.zip)

cat("AIC (ZIP):", aic_zip, "\n")
cat("BIC (ZIP):", bic_zip, "\n")

```

```{r}
# AIC and BIC for ZINBI model
aic_zinbi <- AIC(mod.gamlss.zinbi)
bic_zinbi <- BIC(mod.gamlss.zinbi)

cat("AIC (ZINBI):", aic_zinbi, "\n")
cat("BIC (ZINBI):", bic_zinbi, "\n")

```


DIC
```{r}
# DIC for ZIP model
dic_zip <- GAIC(mod.gamlss.zip, k = 2)
cat("DIC (ZIP):", dic_zip, "\n")

# DIC for ZINBI model
dic_zinbi <- GAIC(mod.gamlss.zinbi, k = 2)
cat("DIC (ZINBI):", dic_zinbi, "\n")

```

R squared
```{r}
# R² for ZIP model
pred_zip <- fitted(mod.gamlss.zip, "mu")  # Predicted values for the mu parameter
obs_zip <- model_data$Aa.adults           # Observed values

var_pred_zip <- var(pred_zip)
var_residual_zip <- var(obs_zip - pred_zip)

r2_zip <- var_pred_zip / (var_pred_zip + var_residual_zip)
cat("R² (ZIP):", r2_zip, "\n")

# R² for ZINBI model
pred_zinbi <- fitted(mod.gamlss.zinbi, "mu")  # Predicted values for the mu parameter
obs_zinbi <- model_data$Aa.adults            # Observed values

var_pred_zinbi <- var(pred_zinbi)
var_residual_zinbi <- var(obs_zinbi - pred_zinbi)

r2_zinbi <- var_pred_zinbi / (var_pred_zinbi + var_residual_zinbi)
cat("R² (ZINBI):", r2_zinbi, "\n")

```


### INLA zero inflation
didn't work..

Atempt: Definition of auxiliary variables for zero inflation.
```{r }
#model_data$is_zero <- model_data$Aa.adults == 0
```


Model formula for zero inflation with negative binomial distribution
```{r }
#mod.inla_zinb <- y ~ 1 +
```


```{r }
 # f(is_zero, model = "logit", fixed = TRUE) +
  #weeks.since.treatment + f(weeks_since_treatment_smooth, model = "rw1") + 
  #yday_end + f(yday_end_smooth, model = "rw1") + 
  #f(region, model = "iid") + 
  #f(site, model = "iid") + 
  #f(manhole, model = "iid")
```

Model fitting with INLA, where zero inflation is implemented with the "zinb" family.
```{r }
#result.inla_zinb <- inla(mod.inla_zinb, family = "zeroinflatedbinomial1", data = model_data)
#summary(result.inla_zinb)
```

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Visualize zero-inflated models in a grid plot
```{r}
# Layout 
par(mfrow = c(1, 2), oma = c(0, 0, 2, 0)) # 1x2 Layout

# Plot for weeks.since.treatment for the ZIP model
plot(pred.values.zip ~ weeks.since.treatment, data = d.predict.gamlss.zip.weeks,
     main = "ZIP: Weeks Since Treatment", xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (ZIP)", pch = 1)

# Plot for weeks.since.treatment for the ZINBI model
plot(pred.values.zinbi ~ weeks.since.treatment, data = d.predict.gamlss.zinbi.weeks,
     main = "ZINBI: Weeks Since Treatment", xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (ZINBI)", pch = 1)

# title for Weeks Since Treatment plots
mtext("Predicted Effects of Weeks Since Treatment", outer = TRUE, cex = 1.5)

par(mfrow = c(1, 1)) 

```


```{r}
# Layout für die Day of Year Plots (ZIP und ZINBI)
par(mfrow = c(1, 2), oma = c(0, 0, 2, 0)) # 1x2 Layout

# Plot for yday_end for the ZIP model
plot(pred.values.zip ~ yday_end, data = d.predict.gamlss.zip.yday,
     main = "ZIP: Day of Year", xlab = "Day of Year",
     ylab = "Predicted Response (ZIP)", pch = 1)

# Plot for yday_end for the ZINBI model
plot(pred.values.zinbi ~ yday_end, data = d.predict.gamlss.zinbi.yday,
     main = "ZINBI: Day of Year", xlab = "Day of Year",
     ylab = "Predicted Response (ZINBI)", pch = 1)

# title for Day of Year plots
mtext("Predicted Effects of Day of Year", outer = TRUE, cex = 1.5)

par(mfrow = c(1, 1)) 

```


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#With PC

### mgcv gam Ausgangs Model, negative binomial

fit model
```{r}
mod.mgcv.gam.pc <- gam(Aa.adults ~ s(weeks.since.treatment, pc = 0) +
                     s(yday_end) +
                     s(region, bs = "re") +
                     s(site, bs = "re") +
                     s(manhole, bs = "re"),
                   method = "REML",
                   family = "nb",
                   data = model_data)
```


```{r }
summary(mod.mgcv.gam.pc)
```

Variance of random effects:
```{r}
gam.vcomp(mod.mgcv.gam.pc)
```


Plot for weeks.since.treatment (fixing yday_end to 215)
```{r}
# Prediction dataset for weeks.since.treatment from 0 to 21, fixing yday_end to 215
d.predict.gam.pc.weeks <- expand.grid(
  weeks.since.treatment = seq(from = 0, to = 21, length = 100),
  yday_end = 215,              
  region = "A",                
  site = "A1",                 
  manhole = 1                  
)

# Calculate predictions for weeks.since.treatment with the original GAM model
d.predict.gam.pc.weeks$pred.values <- predict(
  mod.mgcv.gam.pc,
  newdata = d.predict.gam.pc.weeks,
  type = "response"
)

# Plot for smoothed effect of weeks.since.treatment
plot(pred.values ~ weeks.since.treatment, data = d.predict.gam.pc.weeks,
     main = "Predicted Effect of Weeks Since Treatment (mgcv gam with pc))",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial GAM)")


```


Plot for yday_end (fixing weeks.since.treatment to 3.5)
```{r}
# Prediction dataset for yday_end from 146 to 286, fixing weeks.since.treatment to 3.5
d.predict.gam.pc.yday <- expand.grid(
  weeks.since.treatment = 3.5, 
  yday_end = seq(from = 146, to = 286, length = 100),
  region = "A",                
  site = "A1",                
  manhole = 1                  
)

# calculate predictions for yday_end with the original GAM model
d.predict.gam.pc.yday$pred.values <- predict(
  mod.mgcv.gam.pc,
  newdata = d.predict.gam.pc.yday,
  type = "response"
)

# Plot for smoothed effect of yday_end
plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
     main = "Predicted Effect of Day of Year (mgcv gam with pc)",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial GAM)")


```

####################### CRITERIA'S

AIC & BIC

```{r}
# AIC and BIC for the mgcv GAM model
aic_gam_pc <- AIC(mod.mgcv.gam.pc)
bic_gam_pc <- BIC(mod.mgcv.gam.pc)

cat("AIC (GAM PC):", aic_gam_pc, "\n")
cat("BIC (GAM PC):", bic_gam_pc, "\n")

```

R Squared
```{r}
# Predicted and observed values
pred_gam_pc <- predict(mod.mgcv.gam.pc, type = "response")
obs_gam_pc <- model_data$Aa.adults

# Variance decomposition
var_pred_gam_pc <- var(pred_gam_pc)
var_residual_gam_pc <- var(obs_gam_pc - pred_gam_pc)

# Bayesian R²
r2_gam_pc <- var_pred_gam_pc / (var_pred_gam_pc + var_residual_gam_pc)
cat("Bayesian R² (GAM PC):", r2_gam_pc, "\n")

```

Random Effect Variance
```{r}
# Extract random effect variance components
random_variance <- gam.vcomp(mod.mgcv.gam.pc)
```


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

ALL SMOOTH TERMS VISUALIZATIONS


Bayesian packages Smooth terms:
```{r}
# List of bayesian packages
bayesian_packages <- c("brms", "rstanarm", "INLA", "R2BayesX", "spikeSlabGAM", "gammSlice")

```



ALL MODELS PLOTTEN FOR WEEKS:
```{r}

# Layout
num_models <- 25  # Total number of models
num_rows <- 3  # Adjust rows based on total number of plots
num_cols <- 3  # Adjust columns
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# --- Base R Plots (POISSON) ---
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  xlim = c(0, 20) 
)

plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "gamm4 poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)")

plot(d.predict.qgam.poisson.weeks.since.treatment$weeks.since.treatment, 
     d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)")

plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = range(weeks.smooth$lower, weeks.smooth$upper),
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "red", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "red", lty = 2)

plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "red", lty = 2)


# --- Base R Plots (NB) ---
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# INLA NB1 RW1 Modell for weeks.since.treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "red", lty = 2)

# INLA NB2 RW1 Modell for weeks.since.treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "red", lty = 2)

# INLA NB1 RW2 Modell for weeks.since.treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "red", lty = 2)

# INLA NB2 RW2 Modell for weeks.since.treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "blue",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "red", lty = 2)


plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# Plot for weeks.since.treatment-Vorhersagen
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial)")

# --- Base R Plots (Quasi-Poisson) ---
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     main = "Quasi-Poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Quasi-Poisson)")

# --- Zero-Inflated Models ---
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", main = "ZIP", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZIP)")

plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZINBI)")

# --- With PC ---
plot(pred.values ~ weeks.since.treatment, data = d.predict.gam.pc.weeks,
     type = "l", col = "purple", main = "with PC", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# --- Add Overall Title ---
mtext("All Models for Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", main = "r2bayesx")

par(mfrow = c(1, 1))


```

ALL BAEYSIAN MODELS FOR WEEKS
```{r}
# Layouts
num_bayesian_models <- 10  # Total Bayesian models
num_rows <- 2             # Rows for layout
num_cols <- 3             # Columns for layout
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# --- Bayesian Model Plots in black& white ---

# 1. brms plot for weeks since treatment
plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     col = "black")

# 2. rstanarm poisson
plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  xlim = c(0, 20),
  col = "black"
)

# 3. INLA RW1 plot for weeks since treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = range(weeks.smooth$lower, weeks.smooth$upper),
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "black", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "black", lty = 2)

# 4. INLA RW2 plot for weeks since treatment
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "black", lty = 2)

# 5. INLA NB1 RW1 plot for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)

# 6. INLA NB1 RW2 plot for weeks.since.treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)

# 7. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)

# 8. INLA NB2 RW2 plot for weeks since treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)

# 9. Rstanarm NB2 plot
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Effect",
     col = "black")

# 9. R2BayesX plot for weeks since treatment
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", main = "r2bayesx poisson")

# ---  Title ---
mtext("All Bayesian Models for Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))


```
ALE BAYESIAN WEEKS SCALED:
```{r}
# Layout
num_bayesian_models <- 10  # Total Bayesian models
num_rows <- 2              # Rows for layout
num_cols <- 3              # Columns for layout
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- Bayesian Model Plots in black&white---

# 1. brms plot for weeks since treatment
plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     col = "black", ylim = c(-2, 2))

# 2. rstanarm poisson
plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  xlim = c(0, 20),  # Skalierung der x-Achse auf 0 bis 20
  col = "black", ylim = c(-2, 2)
)

# 3. INLA RW1 plot for weeks since treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fixed y-axis range
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "black", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "black", lty = 2)

# 4. INLA RW2 plot for weeks since treatment
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = c(-2, 2),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "black", lty = 2)

# 5. INLA NB1 RW1 plot for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = c(-2, 2),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)

# 6. INLA NB1 RW2 plot for weeks.since.treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = c(-2, 2),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)

# 7. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = c(-2, 2),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)

# 8. INLA NB2 RW2 plot for weeks since treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = c(-2, 2),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)

# 9. Rstanarm NB2 plot
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Effect",
     col = "black", ylim = c(-2, 2))

# 10. R2BayesX plot for weeks since treatment
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", main = "r2bayesx poisson", ylim = c(-2, 2))

# --- Title ---
mtext("All Bayesian Models for Weeks Since Treatment scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL BAEYSIAN MODELS FOR WEEKS W/O CI FOR INLA
```{r}
# Layout
num_bayesian_models <- 10  # Total Bayesian models
num_rows <- 2              # Rows for layout
num_cols <- 3              # Columns for layout (angepasst für 10 Plots)
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  #

# --- Bayesian Model Plots in black & white ---

# 1. brms plot for weeks since treatment
plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     col = "black")

# 2. rstanarm poisson
plot(mod.rstan.poisson.weeks$weeks.since.treatment, 
     mod.rstan.poisson.weeks$predicted,
     type = "l", 
     main = "rstanarm poisson", 
     xlab = "Weeks Since Treatment", 
     ylab = "Predicted Values",
     xlim = c(0, 20),
     col = "black")

# 3. INLA RW1 plot (no CI)
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, 
     type = "l", col = "black",
     ylim = range(weeks.smooth$lower, weeks.smooth$upper),  # Behalte gleichen Y-Bereich
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")

# 4. INLA RW2 plot (no CI)
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, 
     type = "l", col = "black",
     ylim = range(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")

# 5. INLA NB1 RW1 plot (no CI)
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, 
     type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")

# 6. INLA NB1 RW2 plot (no CI)
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, 
     type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")

# 7. INLA NB2 RW1 plot (no CI)
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, 
     type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")

# 8. INLA NB2 RW2 plot (no CI)
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, 
     type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")

# 9. Rstanarm NB2 plot
plot(mod.rstan.nb.weeks$weeks.since.treatment, mod.rstan.nb.weeks$predicted,
     type = "l", main = "Rstanarm NB2", xlab = "Weeks Since Treatment", ylab = "Effect",
     col = "black")

# 10. R2BayesX plot
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", 
     main = "R2BayesX poisson")

# --- Title ---
mtext("All Bayesian Models for Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))


```


ALL BAYESIAN MODELS WITH POISSON DISTRIBUTION FOR WEEKS SINCE TREATMENT
```{r}
num_bayesian_models <- 5  # Total Bayesian models
num_rows <- 2             # Rows for layout
num_cols <- 3             # Columns for layout
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  #

# --- Bayesian Model Plots ---

# 1. brms plot for weeks since treatment
plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(-2, 2))  # Fix y-axis scaling

# 2. rstanarm poisson plot
plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  xlim = c(0, 20),  # Scale x-axis to 0–20
  ylim = c(-2, 2)   # Fix y-axis scaling
)

# 3. INLA RW1 plot for weeks since treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fix y-axis scaling
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "black", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "black", lty = 2)

# 4. INLA RW2 plot for weeks since treatment
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fix y-axis scaling
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "black", lty = 2)

# 5. R2BayesX plot for weeks since treatment
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", 
     main = "r2bayesx poisson", ylim = c(-2, 2))  # Fix y-axis scaling

# --- Title ---
mtext("Bayesian with Poisson Distribution: Weeks Since Treatment scaled", outer = TRUE, cex = 1.4, font = 1.5)

par(mfrow = c(1, 1))


```


Scaled bayesian and poisson:
```{r}
# Layout
num_bayesian_models <- 5  # Total Bayesian models
num_rows <- 2             # Rows for layout
num_cols <- 3             # Columns for layout

# Determine the y-axis range for consistent scaling
# Replace with actual data variables used for y-values
y_min <- min(c(
  min(d.predict.brms.poisson.weeks$pred.values.brms.poisson),
  min(mod.rstan.poisson.weeks$predicted),
  min(weeks.smooth$lower, weeks.smooth$upper),
  min(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper)
))
y_max <- max(c(
  max(d.predict.brms.poisson.weeks$pred.values.brms.poisson),
  max(mod.rstan.poisson.weeks$predicted),
  max(weeks.smooth$lower, weeks.smooth$upper),
  max(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper)
))

par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  # Layout and margins

# --- Bayesian Model Plots ---

# 1. brms plot for weeks since treatment
plot(d.predict.brms.poisson.weeks$weeks.since.treatment, 
     d.predict.brms.poisson.weeks$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 2. rstanarm poisson plot
plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  ylim = c(y_min, y_max)  # Unified y-axis scaling
)

# 3. INLA RW1 plot for weeks since treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = c(y_min, y_max),
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "black", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "black", lty = 2)

# 4. INLA RW2 plot for weeks since treatment
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = c(y_min, y_max),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "black", lty = 2)

# 5. R2BayesX plot for weeks since treatment
plot(mod.r2bayesx.poisson, term = "sx(weeks.since.treatment)", main = "r2bayesx poisson",
     ylim = c(y_min, y_max))

# ---Title ---
mtext("Bayesian with Poisson Distribution: Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 1.5)

par(mfrow = c(1, 1))

```

ALL BAYESIAN WITH NB DISTRIBUTION FOR WEEKS SINCE TREATMENT 

```{r}
# Layout
num_rows <- 2  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# --- INLA NB Models ---

# 1. INLA NB1 RW1 model for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)
grid()

# 2. INLA NB1 RW2 model for weeks since treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)
grid()

# 3. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)
grid()

# 4. INLA NB2 RW2 model for weeks since treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)
grid()

# Plot für weeks.since.treatment-Vorhersagen
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Effect")

# --- Title ---
mtext("Bayesian with NB Distribution: Weeks since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL BAYESIAN WITH NB DISTRIBUTION FOR WEEKS SINCE TREATMENT, SCALED:
```{r}
# Layout
num_rows <- 2  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- INLA NB Models ---

# 1. INLA NB1 RW1 model for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fix y-axis scaling
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)
grid()

# 2. INLA NB1 RW2 model for weeks since treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fix y-axis scaling
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)
grid()

# 3. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fix y-axis scaling
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)
grid()

# 4. INLA NB2 RW2 model for weeks since treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = c(-2, 2),  # Fix y-axis scaling
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)
grid()

# 5. Rstanarm NB2 plot for weeks since treatment
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Effect",
     ylim = c(-2, 2))  # Fix y-axis scaling

# --- Title ---
mtext("Bayesian with NB Distribution: Weeks since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


```{r}
# Calculate global Y-limits for all models
global_ylim <- range(
  weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper,
  weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper,
  weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper,
  weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper,
  mod.rstan.nb.weeks$predicted
)

# Layout
num_rows <- 2
num_cols <- 3
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# --- INLA NB Models ---

# 1. INLA NB1 RW1 model for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = global_ylim,  # global Y-axis
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)
grid()

# 2. INLA NB1 RW2 model for weeks since treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = global_ylim,  # global Y-axis
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)
grid()

# 3. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = global_ylim,  # global Y-axis
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)
grid()

# 4. INLA NB2 RW2 model for weeks since treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = global_ylim,  # global Y-axis
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)
grid()

# 5. Plot for Rstanarm NB2
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Effect",
     ylim = global_ylim)  # global Y-axis


# ---Title ---
mtext("Bayesian with NB Distribution: Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALLE NON BAYESIAN MODELS FOR WEEEKS SINCE TREATMENT:

```{r}
# Calculate global Y-limits for all plots
y_min <- min(
  d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
  d.predict.gamm.poisson.weeks$pred.values.gamm.poisson,
  d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
  mod.gamm4.poisson.weeks$predicted,
  d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
  mod.glmmTMB.weeks$predicted,
  d.predict.gam.nb.weeks$pred.values.gam.nb,
  d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
  d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
  mod.glmmTMB.nb1.weeks$predicted,
  mod.glmmTMB.nb2.weeks$predicted,
  d.predict.gam.quasi.weeks$pred.values.quasi,
  d.predict.gamlss.zip.weeks$pred.values.zip,
  d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
  d.predict.gam.pc.weeks$pred.values
)

y_max <- max(
  d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
  d.predict.gamm.poisson.weeks$pred.values.gamm.poisson,
  d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
  mod.gamm4.poisson.weeks$predicted,
  d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
  mod.glmmTMB.weeks$predicted,
  d.predict.gam.nb.weeks$pred.values.gam.nb,
  d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
  d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
  mod.glmmTMB.nb1.weeks$predicted,
  mod.glmmTMB.nb2.weeks$predicted,
  d.predict.gam.quasi.weeks$pred.values.quasi,
  d.predict.gamlss.zip.weeks$pred.values.zip,
  d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
  d.predict.gam.pc.weeks$pred.values
)
# Layout
num_models <- 15  
num_rows <- 3  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# --- Non-Bayesian Models ---

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 2. mgcv GAMM Poisson
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 4. gamm4 Poisson
plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "gamm4 poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)")

# 5. qgam Poisson
plot(d.predict.qgam.poisson.weeks.since.treatment$weeks.since.treatment, 
     d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 6. glmmTMB Poisson
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)")

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 8. GAMLSS Negative Binomial 1
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 9. GAMLSS Negative Binomial 2
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 10. glmmTMB Negative Binomial 1
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# 11. glmmTMB Negative Binomial 2
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# 12. mgcv GAM Quasi-Poisson
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     main = "Quasi-Poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Quasi-Poisson)")

# 13. GAMLSS ZIP (Zero-Inflated Poisson)
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", main = "ZIP", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZIP)")

# 14. GAMLSS ZINB (Zero-Inflated Negative Binomial)
plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZINBI)")

# mgcv GAM with PC for weeks since treatment
plot(pred.values ~ weeks.since.treatment, data = d.predict.gam.pc.weeks,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# --- Title ---
mtext("Non-Bayesian Models for Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))
```

ALL NON-NBAYESIAN MODELS FOR WEEEKS SONCE TREATMENT, SCALED:
```{r}
# fixate global Y-limits
y_min <- -0.15
y_max <- 0.2

# Layout
num_models <- 15  
num_rows <- 3  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# --- Non-Bayesian Models ---

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))  # Fixed Y-axis

# 2. mgcv GAMM Poisson
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 4. gamm4 Poisson
plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "gamm4 poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)",
     ylim = c(y_min, y_max))

# 5. qgam Poisson
plot(d.predict.qgam.poisson.weeks.since.treatment$weeks.since.treatment, 
     d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 6. glmmTMB Poisson
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)",
     ylim = c(y_min, y_max))

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 8. GAMLSS Negative Binomial 1
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 9. GAMLSS Negative Binomial 2
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# 10. glmmTMB Negative Binomial 1
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response",
     ylim = c(y_min, y_max))

# 11. glmmTMB Negative Binomial 2
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response",
     ylim = c(y_min, y_max))

# 12. mgcv GAM Quasi-Poisson
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     main = "Quasi-Poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Quasi-Poisson)",
     ylim = c(y_min, y_max))

# 13. GAMLSS ZIP (Zero-Inflated Poisson)
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", main = "ZIP", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZIP)",
     ylim = c(y_min, y_max))

# 14. GAMLSS ZINB (Zero-Inflated Negative Binomial)
plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZINBI)",
     ylim = c(y_min, y_max))

# 15. mgcv GAM with PC for weeks since treatment
plot(pred.values ~ weeks.since.treatment, data = d.predict.gam.pc.weeks,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(y_min, y_max))

# --- Title ---
mtext("Non-Bayesian Models for Weeks Since Treatment scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

NON BAYESIAN MODELLS WITH POSSON FOR WEEKS SINCE TREATMENT
```{r}

# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", ylab = "Effect")

# 2. mgcv GAMM Poisson
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", ylab = "Effect")

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Weeks Since Treatment", ylab = "Effect")

# 4. gamm4 Poisson
plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "gamm4 poisson", xlab = "Weeks Since Treatment", ylab = "Effect")

# 5. qgam Poisson
plot(d.predict.qgam.poisson.weeks.since.treatment$weeks.since.treatment, 
     d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Weeks Since Treatment", ylab = "Effect")

# 6. glmmTMB Poisson
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Effect")

# Title
mtext("Non-Bayesian with Poisson Distribution: Weeks Since Treatment", outer = TRUE, cex = 1.5, font = 1.2)

```

NON BAYESIAN MODELLS WITH POSSON FOR WEEKS SINCE TREATMENT, SCALED:

```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(-0.15, 0.15))  # Fixed y-axis scaling

# 2. mgcv GAMM Poisson
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(-0.15, 0.15))  # Fixed y-axis scaling

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(-0.15, 0.15))  # Fixed y-axis scaling

# 4. gamm4 Poisson
plot(predicted ~ weeks.since.treatment, data = mod.gamm4.poisson.weeks,
     main = "gamm4 poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(-0.15, 0.15))  # Fixed y-axis scaling

# 5. qgam Poisson
plot(d.predict.qgam.poisson.weeks.since.treatment$weeks.since.treatment, 
     d.predict.qgam.poisson.weeks.since.treatment$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(-0.15, 0.15))  # Fixed y-axis scaling

# 6. glmmTMB Poisson
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(-0.15, 0.15))  # Fixed y-axis scaling

# Title
mtext("Non-Bayesian with Poisson Distribution: Weeks Since Treatment scaled", outer = TRUE, cex = 1.3, font = 1.2)

```

NON-BAYESIAN MODELS WITH NB DISTRIBUTION FOR WEEKS SINCE TREATMENT:
```{r}

# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 2. GAMLSS Negative Binomial 1
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 3. GAMLSS Negative Binomial 2
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 4. glmmTMB Negative Binomial 1
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# 5. glmmTMB Negative Binomial 2
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# title
mtext("Non-Bayesian Negative Binomial Models weeks since treatment", outer = TRUE, cex = 1, font = 2)

par(mfrow = c(1, 1))

```

NON-BAYESIAB MODELS WITH NB DISTRIBUTION FOR WEEKS SINCE TREATMENT, SCALED:
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(0.02, 0.5))  # Fixed y-axis scaling

# 2. GAMLSS Negative Binomial 1
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(0.02, 0.5))  # Fixed y-axis scaling

# 3. GAMLSS Negative Binomial 2
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Values",
     ylim = c(0.02, 0.5))  # Fixed y-axis scaling

# 4. glmmTMB Negative Binomial 1
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response",
     ylim = c(0.02, 0.5))  # Fixed y-axis scaling

# 5. glmmTMB Negative Binomial 2
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response",
     ylim = c(0.02, 0.5))  # Fixed y-axis scaling

# Title
mtext("Non-Bayesian Negative Binomial Models weeks since treatment scaled", outer = TRUE, cex = 1.3, font = 1.5)

par(mfrow = c(1, 1))

```


Quasi poisson, Zero infalted models
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Quasi-Poisson
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     type = "l", col = "black", main = "Quasi-Poisson", 
     xlab = "Weeks Since Treatment", ylab = "Effect")

# 2. GAMLSS ZIP (Zero-Inflated Poisson)
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Weeks Since Treatment", ylab = "Effect")

# 3. GAMLSS ZINB (Zero-Inflated Negative Binomial)
plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Weeks Since Treatment", ylab = "Effect")

# Title
mtext("Non-Bayesian Zero-Inflated and Quasi-Poisson Models", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

Quasi poisson, Zero infalted models, scaled:
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Quasi-Poisson
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     type = "l", col = "black", main = "Quasi-Poisson", 
     xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(0, 5))  # Fixed y-axis scaling

# 2. GAMLSS ZIP (Zero-Inflated Poisson)
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(0, 5))  # Fixed y-axis scaling

# 3. GAMLSS ZINB (Zero-Inflated Negative Binomial)
plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Weeks Since Treatment", ylab = "Effect",
     ylim = c(0, 5))  # Fixed y-axis scaling

# Title
mtext("Non-Bayesian Zero-Inflated and Quasi-Poisson Models scaled", outer = TRUE, cex = 1.5, font = 1.5)

par(mfrow = c(1, 1))

```

---------------YDAYS--------------------

PLOT FOR ALL MODELS FOR Y_DAYS:

```{r}

num_models <- 25  
num_rows <- 3
num_cols <- 3
# Layout 
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 1), oma = c(0, 0, 6, 0))  

# --- POISSON ---
# mgcv gam plot for yday end
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Predicted Values")

# mgcv gamm plot for yday end
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss plot for yday end
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Predicted Values")

# brms plot for yday end
plot(d.predict.brms.poisson.yday_end$yday_end, 
     d.predict.brms.poisson.yday_end$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Day of Year", ylab = "Predicted Values")

# rstanarm plot for yday end
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Predicted Values")

# gamm4 plot for yday end
plot(mod.gamm4.poisson.ydays$yday_end, 
     mod.gamm4.poisson.ydays$predicted,
     type = "l", main = "gamm4 poisson", xlab = "Day of Year", ylab = "Predicted Values")

# qgam plot for yday end
plot(d.predict.qgam.poisson.yday_end$yday_end, 
     d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Day of Year", ylab = "Predicted Values")

# glmmTMB plot for yday end
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Predicted Values")

# INLA RW1 plot for yday end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "blue",
     ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = "INLA poisson RW1", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "red", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "red", lty = 2)

# INLA RW2 plot for yday end
plot(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_rw2$lower, yday.smooth_rw2$upper),
     main = "INLA poisson RW2", 
     xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "red", lty = 2)

# NB-Models
# mgcv gam.nb.no_pc Modell for yday_end
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss nb1 Modell for yday_end
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Predicted Values")

# gamlss nb2 Modell for yday_end
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Predicted Values")

# INLA NB1 RW1 Modell for yday_end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb1_rw1$lower, yday.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "red", lty = 2)

# INLA NB2 RW1 Modell for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb2_rw1$lower, yday.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "red", lty = 2)

# INLA NB1 RW2 Modell for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb1_rw2$lower, yday.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "red", lty = 2)

# INLA NB2 RW2 Modell for yday_end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "blue",
     ylim = range(yday.smooth_nb2_rw2$lower, yday.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "red", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "red", lty = 2)

# glmmTMB NB1 Modell for yday_end
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Predicted Response")

# glmmTMB NB2 Modell for yday_end
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Predicted Response")

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Predicted Response (Negative Binomial)")

# Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     main = "gam Quasi-Poisson", xlab = "Day of Year", ylab = "Predicted Response (Quasi-Poisson)")

# Zero-Inflated Models (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", main = "ZIP", xlab = "Day of Year", ylab = "Predicted Values")

# Zero-Inflated Negative Binomial (ZINBI)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", main = "ZINBI", xlab = "Day of Year", ylab = "Predicted Values")

# With PC
plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
     main = "with PC", xlab = "Day of Year", ylab = "Predicted Values")

# R2BayesX plot for yday end, has to be last again
plot(mod.r2bayesx.poisson, term = "sx(yday_end)", main = "r2bayesx poisson")

# ---Title ---
mtext("All Models for Day of Year", outer = TRUE, cex = 1.5, font = 2)

```

ALL BAYESIAN MODELS FOR Y_DAYS
```{r}
# Layout
num_bayesian_models <- 10  
num_rows <- 2             
num_cols <- 3             
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0)) 

# --- Bayesian Model Plots ---

# brms plot for yday end
plot(d.predict.brms.poisson.yday_end$yday_end, 
     d.predict.brms.poisson.yday_end$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Day of Year", ylab = "Effect")

# rstanarm plot for yday end
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Effect")


# INLA RW1 plot for yday end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "black",
     ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = "INLA poisson RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "black", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "black", lty = 2)

# INLA RW2 plot for yday end
plot(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, type = "l", col = "black",
     ylim = range(yday.smooth_rw2$lower, yday.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "black", lty = 2)

# INLA NB1 RW1 model for yday end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb1_rw1$lower, yday.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2 model for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb1_rw2$lower, yday.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "black", lty = 2)

# INLA NB2 RW1 model for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb2_rw1$lower, yday.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW2 model for yday end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb2_rw2$lower, yday.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "black", lty = 2)

# Plot für yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Effect")

# R2BayesX plot for yday end
plot(mod.r2bayesx.poisson, term = "sx(yday_end)", main = "r2bayesx poisson")

# --- Title ---
mtext("All Bayesian Models for Day of Year", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))


```

ALL BAYESIAN MODELS FOR Y_DAYS, SCALED:
```{r}
# Layout
num_bayesian_models <- 10  
num_rows <- 2            
num_cols <- 3             
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- Bayesian Model Plots ---

# brms plot for yday end
plot(d.predict.brms.poisson.yday_end$yday_end, 
     d.predict.brms.poisson.yday_end$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Day of Year", ylab = "Effect",
     ylim = c(-4, 2))  # Fixed y-axis scaling

# rstanarm plot for yday end
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Effect",
     ylim = c(-4, 2))  # Fixed y-axis scaling

# INLA RW1 plot for yday end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "black",
     ylim = c(-4, 2),  # Fixed y-axis scaling
     main = "INLA poisson RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "black", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "black", lty = 2)

# INLA RW2 plot for yday end
plot(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, type = "l", col = "black",
     ylim = c(-4, 2),  # Fixed y-axis scaling
     main = "INLA poisson RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "black", lty = 2)

# INLA NB1 RW1 model for yday end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = c(-4, 2),  # Fixed y-axis scaling
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2 model for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = c(-4, 2),  # Fixed y-axis scaling
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "black", lty = 2)

# INLA NB2 RW1 model for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = c(-4, 2),  # Fixed y-axis scaling
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW2 model for yday end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = c(-4, 2),  # Fixed y-axis scaling
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "black", lty = 2)

# Plot für yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Effect",
     ylim = c(-4, 2))  # Fixed y-axis scaling

# R2BayesX plot for yday end
plot(mod.r2bayesx.poisson, term = "sx(yday_end)", main = "r2bayesx poisson",
     ylim = c(-4, 2))  # Fixed y-axis scaling

# --- Title ---
mtext("All Bayesian Models for Day of Year scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL BAYESIAN MODELS WITH POISSON DISTRIBUTION FOR Y_DAYS
```{r}

num_bayesian_poisson_models <- 5 
num_rows <- 2  
num_cols <- 3  

# Layout
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- Bayesian Poisson-ModelS ---

# brms Poisson-Plot
plot(d.predict.brms.poisson.yday_end$yday_end, 
     d.predict.brms.poisson.yday_end$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Day of Year", ylab = "Effect")

# rstanarm Poisson-Plot
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Effect")

# INLA Poisson RW1-Plot
plot(yday.smooth$yday_end, 
     yday.smooth$mean, 
     type = "l", col = "black", ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = "INLA poisson RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "black", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "black", lty = 2)

# INLA Poisson RW2-Plot
plot(yday.smooth_rw2$yday_end, 
     yday.smooth_rw2$mean, 
     type = "l", col = "black", ylim = range(yday.smooth_rw2$lower, yday.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "black", lty = 2)

# r2bayesx Poisson-Plot
plot(mod.r2bayesx.poisson, term = "sx(yday_end)", 
     main = "r2bayesx poisson", xlab = "Day of Year", ylab = "Effect")


# --- TITLE ---
mtext("Bayesian with Poisson Distribution: Day of Year", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL BAYESIAN MODELS WITH POISSON DISTRIBUTION FOR Y_DAYS, SCALED
```{r}

num_bayesian_poisson_models <- 5  
num_rows <- 2  
num_cols <- 3  

# Layout
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- Bayesian Poisson-Models ---

# brms Poisson-Plot
plot(d.predict.brms.poisson.yday_end$yday_end, 
     d.predict.brms.poisson.yday_end$pred.values.brms.poisson,
     type = "l", main = "brms poisson", xlab = "Day of Year", ylab = "Effect",
     ylim = c(-4, 2.5))

# rstanarm Poisson-Plot
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Effect",
     ylim = c(-4, 2.5))

# INLA Poisson RW1-Plot
plot(yday.smooth$yday_end, 
     yday.smooth$mean, 
     type = "l", col = "black", ylim = c(-4, 2.5),
     main = "INLA poisson RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "black", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "black", lty = 2)

# INLA Poisson RW2-Plot
plot(yday.smooth_rw2$yday_end, 
     yday.smooth_rw2$mean, 
     type = "l", col = "black", ylim = c(-4, 2.5),
     main = "INLA poisson RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "black", lty = 2)

# r2bayesx Poisson-Plot
plot(mod.r2bayesx.poisson, term = "sx(yday_end)", 
     main = "r2bayesx poisson", xlab = "Day of Year", ylab = "Effect",
     ylim = c(-4, 2.5))

# --- Title---
mtext("Bayesian with Poisson Distribution: Day of Year scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL BAYESIAN MODELS WITH NB DISTRIBUTION FOR Y_DAYS
```{r}

num_bayesian_nb_models <- 5  
num_rows <- 2  
num_cols <- 3  

# Layout 
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0)) 

# --- Bayesian NB-Models ---

# INLA NB1 RW1-Plot
plot(yday.smooth_nb1_rw1$yday_end, 
     yday.smooth_nb1_rw1$mean, 
     type = "l", col = "black", ylim = range(yday.smooth_nb1_rw1$lower, yday.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW1-Plot
plot(yday.smooth_nb2_rw1$yday_end, 
     yday.smooth_nb2_rw1$mean, 
     type = "l", col = "black", ylim = range(yday.smooth_nb2_rw1$lower, yday.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2-Plot
plot(yday.smooth_nb1_rw2$yday_end, 
     yday.smooth_nb1_rw2$mean, 
     type = "l", col = "black", ylim = range(yday.smooth_nb1_rw2$lower, yday.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "black", lty = 2)

# INLA NB2 RW2-Plot
plot(yday.smooth_nb2_rw2$yday_end, 
     yday.smooth_nb2_rw2$mean, 
     type = "l", col = "black", ylim = range(yday.smooth_nb2_rw2$lower, yday.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "black", lty = 2)

# Plot für yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Effect")

# --- Title---
mtext("Bayesian with NB Distribution: Day of Year", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL BAYESIAN MODELS WITH NB DISTRIBUTION FOR Y_DAYS, SCALED
```{r}
num_bayesian_nb_models <- 5  
num_rows <- 2  
num_cols <- 3  

par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- Bayesian NB-ModelS ---

# INLA NB1 RW1-Plot
plot(yday.smooth_nb1_rw1$yday_end, 
     yday.smooth_nb1_rw1$mean, 
     type = "l", col = "black", ylim = c(-4, 2.5),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW1-Plot
plot(yday.smooth_nb2_rw1$yday_end, 
     yday.smooth_nb2_rw1$mean, 
     type = "l", col = "black", ylim = c(-4, 2.5),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2-Plot
plot(yday.smooth_nb1_rw2$yday_end, 
     yday.smooth_nb1_rw2$mean, 
     type = "l", col = "black", ylim = c(-4, 2.5),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "black", lty = 2)

# INLA NB2 RW2-Plot
plot(yday.smooth_nb2_rw2$yday_end, 
     yday.smooth_nb2_rw2$mean, 
     type = "l", col = "black", ylim = c(-4, 2.5),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "black", lty = 2)

# Plot für yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Effect",
     ylim = c(-4, 2.5))

# --- title ---
mtext("Bayesian with NB Distribution: Day of Year scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


ALL NON-BAYESIAN MODELS FOR YDAYS
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# --- Poisson-Models ---

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Effect")

# 2. mgcv GAMM Poisson
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Effect")

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Effect")

# 4. gamm4 Poisson
plot(mod.gamm4.poisson.ydays$yday_end, 
     mod.gamm4.poisson.ydays$predicted,
     type = "l", main = "gamm4 poisson", xlab = "Day of Year", ylab = "Effect")

# 5. qgam Poisson
plot(d.predict.qgam.poisson.yday_end$yday_end, 
     d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Day of Year", ylab = "Effect")

# 6. glmmTMB Poisson
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Effect")

# --- Negative Binomial-Models ---

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Effect")

# 8. GAMLSS NB1
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Effect")

# 9. GAMLSS NB2
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Effect")

# 10. glmmTMB NB1
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Effect")

# 11. glmmTMB NB2
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Effect")

# --- Quasi-Poisson and Zero-Inflated Models ---

# 12. Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     type = "l", col = "black", main = "gam Quasi-Poisson", 
     xlab = "Day of Year", ylab = "Effect")

# 13. Zero-Inflated Poisson (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Day of Year", ylab = "Effect")

# 14. Zero-Inflated Negative Binomial (ZINB)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Day of Year", ylab = "Effect")

# 15. mgcv GAM with PC
plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Day of Year", ylab = "Effect")

# title
mtext("Non-Bayesian Models for Day of Year", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

ALL NON-BAYESIAN MODELS FOR YDAYS, SCALED
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# --- Poisson-Models ---

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 2. mgcv GAMM Poisson
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 4. gamm4 Poisson
plot(mod.gamm4.poisson.ydays$yday_end, 
     mod.gamm4.poisson.ydays$predicted,
     type = "l", main = "gamm4 poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 5. qgam Poisson
plot(d.predict.qgam.poisson.yday_end$yday_end, 
     d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 6. glmmTMB Poisson
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# --- Negative Binomial-Models ---

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 8. GAMLSS NB1
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 9. GAMLSS NB2
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 10. glmmTMB NB1
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 11. glmmTMB NB2
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# --- Quasi-Poisson ans Zero-Inflated Models ---

# 12. Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     type = "l", col = "black", main = "gam Quasi-Poisson", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 13. Zero-Inflated Poisson (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 14. Zero-Inflated Negative Binomial (ZINB)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 15. mgcv GAM with PC
plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# Title
mtext("Non-Bayesian Models for Day of Year scaled", outer = TRUE, cex = 1.5, font = 2)

# Reset Layout
par(mfrow = c(1, 1))

```

NON-BAYESIAN MODELS WITH POISSON DISTRIBUTION FOR YDAYS
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Effect")

# 2. mgcv GAMM Poisson
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Effect")

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Effect")

# 4. gamm4 Poisson
plot(mod.gamm4.poisson.ydays$yday_end, 
     mod.gamm4.poisson.ydays$predicted,
     type = "l", main = "gamm4 poisson", xlab = "Day of Year", ylab = "Effect")

# 5. qgam Poisson
plot(d.predict.qgam.poisson.yday_end$yday_end, 
     d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Day of Year", ylab = "Effect")

# 6. glmmTMB Poisson
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Effect")

# Title
mtext("Non-Bayesian with Poisson Distribution: Day of year", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


NON-BAYESIAN MODELS WITH POISSON DISTRIBUTION FOR YDAYS, SCALED
```{r}
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 2. mgcv GAMM Poisson
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 4. gamm4 Poisson
plot(mod.gamm4.poisson.ydays$yday_end, 
     mod.gamm4.poisson.ydays$predicted,
     type = "l", main = "gamm4 poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 5. qgam Poisson
plot(d.predict.qgam.poisson.yday_end$yday_end, 
     d.predict.qgam.poisson.yday_end$pred.values.qgam.poisson,
     type = "l", main = "qgam poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# 6. glmmTMB Poisson
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Effect", ylim = c(-0.3, 0.3))

# Title
mtext("Non-Bayesian with Poisson Distribution: Day of year scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

NON-BAYESIAN MODELS WITH NB DISTRIBUTION FOR YDAYS
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Effect")

# 2. GAMLSS NB1
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Effect")

# 3. GAMLSS NB2
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Effect")

# 10. glmmTMB NB1
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Effect")

# 11. glmmTMB NB2
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Effect")

# title
mtext("Non-Bayesian with NB Distribution: Day of Year", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

NON-BAYESIAN MODELS WITH NB DISTRIBUTION FOR YDAYS, SCALED:
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.2))

# 2. GAMLSS NB1
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.2))

# 3. GAMLSS NB2
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.2))

# 4. glmmTMB NB1
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.2))

# 5. glmmTMB NB2
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.2))

# title
mtext("Non-Bayesian with NB Distribution: Day of Year scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


NON-BAYESIAN MODELS: ZEROINFLATED AND QUASIPOISSON FOR YDAYS
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     type = "l", col = "black", main = "gam Quasi-Poisson", 
     xlab = "Day of Year", ylab = "Effect")

# 2. Zero-Inflated Poisson (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Day of Year", ylab = "Effect")

# 3. Zero-Inflated Negative Binomial (ZINB)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Day of Year", ylab = "Effect")

# 4. mgcv GAM with PC
#plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
 #    type = "l", col = "purple", main = "mgcv gam with PC", 
  #   xlab = "Day of Year", ylab = "Predicted Values")

# Title
mtext("Non-Bayesian zero-Inflated and Quasi-Poisson Models", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


NON-BAYESIAN MODELS: ZEROINFLATED AND QUASIPOISSON FOR YDAYS, SCALED:
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     type = "l", col = "black", main = "gam Quasi-Poisson", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.4))

# 2. Zero-Inflated Poisson (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.4))

# 3. Zero-Inflated Negative Binomial (ZINB)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.4))

# 4. mgcv GAM with PC
# plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
#      type = "l", col = "purple", main = "mgcv gam with PC", 
#      xlab = "Day of Year", ylab = "Effect", ylim = c(0, 0.4))

# Title
mtext("Non-Bayesian zero-Inflated and Quasi-Poisson Models scaled", outer = TRUE, cex = 1.5, font = 1.5)

par(mfrow = c(1, 1))

```


SMOOTHERS NOW SEPARATED BY PACKAGES: same packages, different families FOR WEEKS SINCE TREATMENT

INLA (bayesian)
```{r}
# Layout
num_bayesian_models <- 6  
num_rows <- 2             
num_cols <- 3             
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# 5. INLA RW1 plot for weeks since treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = range(weeks.smooth$lower, weeks.smooth$upper),
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "black", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "black", lty = 2)

# 6. INLA RW2 plot for weeks since treatment
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_rw2$lower, weeks.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "black", lty = 2)

# 7. INLA NB1 RW1 model for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw1$lower, weeks.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2 model for weeks.since.treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb1_rw2$lower, weeks.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)

# 8. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw1$lower, weeks.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW2
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = range(weeks.smooth_nb2_rw2$lower, weeks.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)

# ---  Title ---
mtext("INLA Models for Weeks Since Treatment across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

INLA (bayesian) SCALED:
```{r}
# Layout
num_bayesian_models <- 6  
num_rows <- 2            
num_cols <- 3             
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# --- Bayesian INLA Models with Y-axis scaled from -1 to 2 ---

# 1. INLA RW1 plot for weeks since treatment
plot(weeks.smooth$weeks.since.treatment, weeks.smooth$mean, type = "l", col = "black",
     ylim = c(-1, 2),
     main = "INLA poisson RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$lower, col = "black", lty = 2)
lines(weeks.smooth$weeks.since.treatment, weeks.smooth$upper, col = "black", lty = 2)

# 2. INLA RW2 plot for weeks since treatment
plot(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$mean, type = "l", col = "black",
     ylim = c(-1, 2),
     main = "INLA poisson RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_rw2$weeks.since.treatment, weeks.smooth_rw2$upper, col = "black", lty = 2)

# 3. INLA NB1 RW1 model for weeks since treatment
plot(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = c(-1, 2),
     main = "INLA NB1 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw1$weeks.since.treatment, weeks.smooth_nb1_rw1$upper, col = "black", lty = 2)

# 4. INLA NB1 RW2 model for weeks since treatment
plot(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = c(-1, 2),
     main = "INLA NB1 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb1_rw2$weeks.since.treatment, weeks.smooth_nb1_rw2$upper, col = "black", lty = 2)

# 5. INLA NB2 RW1 model for weeks since treatment
plot(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = c(-1, 2),
     main = "INLA NB2 RW1", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw1$weeks.since.treatment, weeks.smooth_nb2_rw1$upper, col = "black", lty = 2)

# 6. INLA NB2 RW2 model for weeks since treatment
plot(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = c(-1, 2),
     main = "INLA NB2 RW2", xlab = "Weeks Since Treatment", ylab = "Effect")
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(weeks.smooth_nb2_rw2$weeks.since.treatment, weeks.smooth_nb2_rw2$upper, col = "black", lty = 2)

# --- Title ---
mtext("INLA Models for Weeks Since Treatment across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

mgcv

```{r}
# Layout
num_models <- 5  
num_rows <- 2 
num_cols <- 3 
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 2. mgcv GAMM Poisson
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 12. mgcv GAM Quasi-Poisson
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     main = "mgcv gam Quasi-Poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Quasi-Poisson)")

# mgcv GAM with PC for weeks since treatment
plot(pred.values ~ weeks.since.treatment, data = d.predict.gam.pc.weeks,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# ---Title ---
mtext("mgcv Models for Weeks Since Treatment across families", outer = TRUE, cex = 1, font = 2)

# Reset layout
par(mfrow = c(1, 1))
```

mgcv, SCALED:
```{r}
# Layout
num_models <- 5  
num_rows <- 2  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.weeks_since_treatment$weeks.since.treatment, 
     d.predict.gam.no_pc.poisson.weeks_since_treatment$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Weeks Since Treatment", 
     ylab = "Predicted Values", ylim = c(0, 0.2))

# 2. mgcv GAMM Poisson
plot(pred.values.gamm.poisson ~ weeks.since.treatment, data = d.predict.gamm.poisson.weeks,
     main = "mgcv gamm poisson", xlab = "Weeks Since Treatment", 
     ylab = "Predicted Values", ylim = c(0, 0.2))

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.weeks$weeks.since.treatment, 
     d.predict.gam.nb.weeks$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Weeks Since Treatment", 
     ylab = "Predicted Values", ylim = c(0, 0.2))

# 12. mgcv GAM Quasi-Poisson
plot(pred.values.quasi ~ weeks.since.treatment, data = d.predict.gam.quasi.weeks,
     main = "mgcv gam Quasi-Poisson", xlab = "Weeks Since Treatment", 
     ylab = "Predicted Response (Quasi-Poisson)", ylim = c(0, 0.2))

# mgcv GAM with PC for weeks since treatment
plot(pred.values ~ weeks.since.treatment, data = d.predict.gam.pc.weeks,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values", ylim = c(0, 0.2))

# --- Title ---
mtext("mgcv Models for Weeks Since Treatment across families scaled", outer = TRUE, cex = 1.2, font = 2)

par(mfrow = c(1, 1))

```



gamlss
```{r}
# Layout
num_models <- 5  
num_rows <- 2  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 8. GAMLSS Negative Binomial 1
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 9. GAMLSS Negative Binomial 2
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 13. GAMLSS ZIP (Zero-Inflated Poisson)
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", main = "ZIP", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZIP)")

# 14. GAMLSS ZINB (Zero-Inflated Negative Binomial)
plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZINBI)")

# ---Title ---
mtext("gamlss Models for Weeks Since Treatment across families", outer = TRUE, cex = 1, font = 2)

# Reset layout
par(mfrow = c(1, 1))
```

gamlss, SCALED
```{r}
# Layout
num_models <- 5  
num_rows <- 2  
num_cols <- 3 
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0)) 

# --- Non-Bayesian GAMLSS Modelle scaled from 0 to 0.14 ---

# 1. GAMLSS Poisson
plot(d.predict.gamlss.poisson.weeks$weeks.since.treatment, 
     d.predict.gamlss.poisson.weeks$pred.values.gamlss.poisson,
     type = "l", ylim = c(0, 0.14), main = "gamlss poisson", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 2. GAMLSS Negative Binomial 1
plot(d.predict.gamlss.nb1.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb1.weeks$pred.values.gamlss.nb1,
     type = "l", ylim = c(0, 0.14), main = "gamlss NB1", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 3. GAMLSS Negative Binomial 2
plot(d.predict.gamlss.nb2.weeks$weeks.since.treatment, 
     d.predict.gamlss.nb2.weeks$pred.values.gamlss.nb2,
     type = "l", ylim = c(0, 0.14), main = "gamlss NB2", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Values")

# 4. GAMLSS ZIP (Zero-Inflated Poisson)
plot(d.predict.gamlss.zip.weeks$weeks.since.treatment, 
     d.predict.gamlss.zip.weeks$pred.values.zip,
     type = "l", col = "black", ylim = c(0, 0.14), main = "ZIP", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZIP)")

# 5. GAMLSS ZINB (Zero-Inflated Negative Binomial)
plot(d.predict.gamlss.zinbi.weeks$weeks.since.treatment, 
     d.predict.gamlss.zinbi.weeks$pred.values.zinbi,
     type = "l", col = "black", ylim = c(0, 0.14), main = "ZINBI", 
     xlab = "Weeks Since Treatment", ylab = "Predicted Response (ZINBI)")

# --- Title ---
mtext("gamlss Models for Weeks Since Treatment across families scaled", outer = TRUE, cex = 1, font = 2)

par(mfrow = c(1, 1))

```

glmmTMB
```{r}
# Layout
num_models <- 3 
num_rows <- 2  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# 6. glmmTMB Poisson
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)")

# 10. glmmTMB Negative Binomial 1
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# 11. glmmTMB Negative Binomial 2
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response")

# ---Title ---
mtext("glmmTMBModels for Weeks Since Treatment across families", outer = TRUE, cex = 1, font = 2)

# Reset layout
par(mfrow = c(1, 1))
```


glmmTMB, SCALED:
```{r}
# Layout
num_models <- 3  
num_rows <- 2  
num_cols <- 3  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# --- Non-Bayesian glmmTMB Models scaled from 0 to 0.2 ---

# 1. glmmTMB Poisson
plot(predicted ~ weeks.since.treatment, data = mod.glmmTMB.weeks,
     main = "glmmTMB poisson", xlab = "Weeks Since Treatment", ylab = "Predicted Response (Poisson)",
     ylim = c(0, 0.2))

# 2. glmmTMB Negative Binomial 1
plot(mod.glmmTMB.nb1.weeks$weeks.since.treatment, mod.glmmTMB.nb1.weeks$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Weeks Since Treatment", ylab = "Predicted Response",
     ylim = c(0, 0.2))

# 3. glmmTMB Negative Binomial 2
plot(mod.glmmTMB.nb2.weeks$weeks.since.treatment, mod.glmmTMB.nb2.weeks$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Weeks Since Treatment", ylab = "Predicted Response",
     ylim = c(0, 0.2))

# --- Title ---
mtext("glmmTMB Models for Weeks Since Treatment across families scaled", outer = TRUE, cex = 1.2, font = 2)

par(mfrow = c(1, 1))

```

rstanarm
```{r}
# Layout
num_models <- 2  
num_rows <- 2  
num_cols <- 2  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  xlim = c(0, 20) 
)

# Plot für weeks.since.treatment predictions
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial)")

# --- Title ---
mtext("rstanarm Models for Weeks Since Treatment across families", outer = TRUE, cex = 1, font = 2)

par(mfrow = c(1, 1))

```

rstanarm, SCALED:
```{r}

num_models <- 2  
num_rows <- 2  
num_cols <- 2  
par(mfrow = c(num_rows, num_cols), mar = c(2, 2, 2, 2), oma = c(0, 0, 6, 0))  

# 1. rstanarm Poisson
plot(
  mod.rstan.poisson.weeks$weeks.since.treatment, 
  mod.rstan.poisson.weeks$predicted,
  type = "l", 
  main = "rstanarm poisson", 
  xlab = "Weeks Since Treatment", 
  ylab = "Predicted Values",
  xlim = c(0, 20),  # Skalierung der x-Achse auf 0 bis 20
  ylim = c(0, 0.5)  # Skalierung der y-Achse auf 0.05 bis 0.5
)

# 2. rstanarm NB2
plot(predicted ~ weeks.since.treatment, data = mod.rstan.nb.weeks,
     main = "Rstanarm NB2",
     xlab = "Weeks Since Treatment",
     ylab = "Predicted Response (Negative Binomial)",
     ylim = c(0, 0.5))  # Skalierung der y-Achse auf 0.05 bis 0.5

# --- Title ---
mtext("rstanarm Models for Weeks Since Treatment across families scaled", outer = TRUE, cex = 1.2, font = 2)

par(mfrow = c(1, 1))

```

SMOOTHERS NOW SEPARATED BY PACKAGES: same packages, different families FOR YDAY

INLA (Bayesian)
```{r}
# Layout
num_bayesian_models <- 6  
num_rows <- 2             
num_cols <- 3             
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# INLA RW1 plot for yday end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "black",
     ylim = range(yday.smooth$lower, yday.smooth$upper),
     main = "INLA poisson RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "black", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "black", lty = 2)

# INLA RW2 plot for yday end
plot(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, type = "l", col = "black",
     ylim = range(yday.smooth_rw2$lower, yday.smooth_rw2$upper),
     main = "INLA poisson RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "black", lty = 2)

# INLA NB1 RW1 model for yday end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb1_rw1$lower, yday.smooth_nb1_rw1$upper),
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2 model for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb1_rw2$lower, yday.smooth_nb1_rw2$upper),
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "black", lty = 2)

# INLA NB2 RW1 model for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb2_rw1$lower, yday.smooth_nb2_rw1$upper),
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW2 model for yday end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = range(yday.smooth_nb2_rw2$lower, yday.smooth_nb2_rw2$upper),
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "black", lty = 2)

# --- Title ---
mtext("INLA Models for Day of Year across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

Inla yday, scaled:
```{r}
# Layout
num_bayesian_models <- 6
num_rows <- 2             
num_cols <- 3             
par(mfrow = c(num_rows, num_cols), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))  

# INLA RW1 plot for yday end
plot(yday.smooth$yday_end, yday.smooth$mean, type = "l", col = "black",
     ylim = c(-4, 3),  # Scale y-axis
     main = "INLA poisson RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth$yday_end, yday.smooth$lower, col = "black", lty = 2)
lines(yday.smooth$yday_end, yday.smooth$upper, col = "black", lty = 2)

# INLA RW2 plot for yday end
plot(yday.smooth_rw2$yday_end, yday.smooth_rw2$mean, type = "l", col = "black",
     ylim = c(-4, 3),  # Scale y-axis
     main = "INLA poisson RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_rw2$yday_end, yday.smooth_rw2$upper, col = "black", lty = 2)

# INLA NB1 RW1 model for yday end
plot(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$mean, type = "l", col = "black",
     ylim = c(-4, 3),  # Scale y-axis
     main = "INLA NB1 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw1$yday_end, yday.smooth_nb1_rw1$upper, col = "black", lty = 2)

# INLA NB1 RW2 model for yday_end
plot(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$mean, type = "l", col = "black",
     ylim = c(-4, 3),  # Scale y-axis
     main = "INLA NB1 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb1_rw2$yday_end, yday.smooth_nb1_rw2$upper, col = "black", lty = 2)

# INLA NB2 RW1 model for yday_end
plot(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$mean, type = "l", col = "black",
     ylim = c(-4, 3),  # Scale y-axis
     main = "INLA NB2 RW1", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw1$yday_end, yday.smooth_nb2_rw1$upper, col = "black", lty = 2)

# INLA NB2 RW2 model for yday end
plot(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$mean, type = "l", col = "black",
     ylim = c(-4, 3),  # Scale y-axis
     main = "INLA NB2 RW2", xlab = "Day of Year", ylab = "Effect")
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$lower, col = "black", lty = 2)
lines(yday.smooth_nb2_rw2$yday_end, yday.smooth_nb2_rw2$upper, col = "black", lty = 2)

# --- Title ---
mtext("INLA Models for Day of Year across families scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```

mgcv
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Effect")

# 2. mgcv GAMM Poisson
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Effect")

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Effect")

# 12. Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     type = "l", col = "black", main = "gam Quasi-Poisson", 
     xlab = "Day of Year", ylab = "Effect")

# 15. mgcv GAM with PC
plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Day of Year", ylab = "Effect")

# Title
mtext("mgcv Models for Day of Year across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))
```

mgcv, scaled
```{r}

par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 1. mgcv GAM Poisson
plot(d.predict.gam.no_pc.poisson.yday_end$yday_end, 
     d.predict.gam.no_pc.poisson.yday_end$pred.values.gam.poisson,
     type = "l", main = "mgcv gam poisson", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# 2. mgcv GAMM Poisson
plot(d.predict.gamm.poisson.yday_end$yday_end, 
     d.predict.gamm.poisson.yday_end$pred.values.gamm.poisson,
     type = "l", main = "mgcv gamm poisson", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# 7. mgcv GAM Negative Binomial
plot(d.predict.gam.nb.yday_end$yday_end, 
     d.predict.gam.nb.yday_end$pred.values.gam.nb,
     type = "l", main = "mgcv gam NB", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# 12. Quasi-Poisson
plot(pred.values.quasi ~ yday_end, data = d.predict.gam.quasi.yday,
     type = "l", col = "black", main = "gam Quasi-Poisson", 
     xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# 15. mgcv GAM with PC
plot(pred.values ~ yday_end, data = d.predict.gam.pc.yday,
     type = "l", col = "black", main = "mgcv gam with PC", 
     xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# Title
mtext("mgcv Models for Day of Year across families scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


gamlss
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Effect")

# 8. GAMLSS NB1
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Effect")

# 9. GAMLSS NB2
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Effect")

# 13. Zero-Inflated Poisson (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Day of Year", ylab = "Effect")

# 14. Zero-Inflated Negative Binomial (ZINB)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Day of Year", ylab = "Effect")

# Title
mtext("gamlss Models for Day of Year across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))
```

gamlss, scaled
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 3. GAMLSS Poisson
plot(d.predict.gamlss.poisson.yday_end$yday_end, 
     d.predict.gamlss.poisson.yday_end$pred.values.gamlss.poisson,
     type = "l", main = "gamlss poisson", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.4))  # Scale y-axis

# 8. GAMLSS NB1
plot(d.predict.gamlss.nb1.yday_end$yday_end, 
     d.predict.gamlss.nb1.yday_end$pred.values.gamlss.nb1,
     type = "l", main = "gamlss NB1", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.4))  # Scale y-axis

# 9. GAMLSS NB2
plot(d.predict.gamlss.nb2.yday_end$yday_end, 
     d.predict.gamlss.nb2.yday_end$pred.values.gamlss.nb2,
     type = "l", main = "gamlss NB2", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.4))  # Scale y-axis

# 13. Zero-Inflated Poisson (ZIP)
plot(d.predict.gamlss.zip.yday$yday_end, d.predict.gamlss.zip.yday$pred.values.zip,
     type = "l", col = "black", main = "ZIP", 
     xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.4))  # Scale y-axis

# 14. Zero-Inflated Negative Binomial (ZINB)
plot(d.predict.gamlss.zinbi.yday$yday_end, d.predict.gamlss.zinbi.yday$pred.values.zinbi,
     type = "l", col = "black", main = "ZINBI", 
     xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.4))  # Scale y-axis

# title
mtext("gamlss Models for Day of Year across families scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


glmmTMB
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 6. glmmTMB Poisson
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Effect")

# 10. glmmTMB NB1
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Effect")

# 11. glmmTMB NB2
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Effect")

# Title
mtext("glmmTMB Models for Day of Year across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))
```

glmmTMB, scaled:
```{r}
# Layout
par(mfrow = c(2, 3), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# 6. glmmTMB Poisson
plot(mod.glmmTMB.ydays$yday_end, 
     mod.glmmTMB.ydays$predicted,
     type = "l", main = "glmmTMB poisson", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# 10. glmmTMB NB1
plot(mod.glmmTMB.nb1.ydays$yday_end, mod.glmmTMB.nb1.ydays$predicted, type = "l",
     main = "glmmTMB NB1", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# 11. glmmTMB NB2
plot(mod.glmmTMB.nb2.ydays$yday_end, mod.glmmTMB.nb2.ydays$predicted, type = "l",
     main = "glmmTMB NB2", xlab = "Day of Year", ylab = "Effect", 
     ylim = c(0, 0.2))  # Scale y-axis

# Title
mtext("glmmTMB Models for Day of Year across families scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


rstanarm
```{r}
# Layout
par(mfrow = c(2, 2), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# rstanarm plot for yday end
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Predicted Values")

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Predicted values")

# title
mtext("rstanarm Models for Day of Year across families", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))
```

rstanarm, scaled
```{r}
# Layout
par(mfrow = c(2, 2), mar = c(4, 4, 2, 2), oma = c(0, 0, 6, 0))

# rstanarm plot for yday end
plot(mod.rstan.poisson.ydays$yday_end, 
     mod.rstan.poisson.ydays$predicted,
     type = "l", main = "rstanarm poisson", xlab = "Day of Year", ylab = "Predicted Values", 
     ylim = c(0, 0.7))  # Scale y-axis

# Plot for yday_end predictions
plot(predicted ~ yday_end, data = mod.rstan.nb.ydays,
     main = "Rstanarm NB2",
     xlab = "Day of Year",
     ylab = "Predicted values", 
     ylim = c(0, 0.7))  # Scale y-axis

# Title
mtext("rstanarm Models for Day of Year across families scaled", outer = TRUE, cex = 1.5, font = 2)

par(mfrow = c(1, 1))

```


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CRITERIA'S


NEUES DICTIONNARY! 22.11
Dictionnary
```{r}
# FOR ALL 27 MODELS

#mgcv gam poisson
criteria_table <- data.frame(
  Model = "mgcv gam poisson",
  Package = "mgcv",
  Family = "poisson",
  Type = "Non-Bayesian",  
  AIC = 1340,
  BIC = 1730,
  R_squared = 0.496,
  DIC = NA  # DIC not possible
)

# gamm poisson
criteria_table_gamm <- data.frame(
  Model = "mgcv gamm poisson",
  Package = "mgcv",
  Family = "poisson",
  Type = "Non-Bayesian", 
  AIC = 5118,
  BIC = 5155,
  R2 = 0.053,
  DIC = NA  # DIC not possible
)

# gamlss Poisson 
criteria_table_gamlss <- data.frame(
  Model = "gamlss poisson",
  Package = "gamlss",
  Family = "poisson",
  Type = "Non-Bayesian",  
  AIC = 1228,
  BIC = 1489,
  R2 = 0.893,
  DIC = 1284
)


# brms poisson
model_results$poisson_brms <- list(
  Package = "brms",
  Family = "poisson",
  Model = "brms poisson",
  Type = "Bayesian",  
  AIC = NA,               # not implemented in brms
 WAIC = 1401.5,      
  BIC = NA,               # not implemented in brms
  DIC = NA,               # not implemented in brms
  R2 = 0.503225           # Bayesian R²
)


# INLA
# INLA Poisson RW1 
criteria_table_inla_rw1 <- data.frame(
  Model = "INLA poisson RW1",
  Package = "INLA",
  Family = "poisson",
  Type = "Bayesian",  
  AIC = NA,           # not implemented
  BIC = NA,           # not implemented
  DIC = 1144,          
  WAIC = 1276,         
  R2 = 0.642          #
)


# INLA Poisson RW2 
criteria_table_inla_rw2 <- data.frame(
  Model = "INLA poisson RW2",
  Package = "INLA",
  Family = "poisson",
  Type = "Bayesian",  
  AIC = NA,           # not implemented
  BIC = NA,           # not implemented
  DIC = 1154,         #
  WAIC = 1288,         
  R2 = 0.629           
)


# glmmTMB Poisson 
criteria_table_glmmTMB <- data.frame(
  Model = "glmmTMB poisson",
  Package = "glmmTMB",
  Family = "poisson",
  Type = "Non-Bayesian",  
  AIC = 1503.6,           # manually calculated
  BIC = 1550.129,         # manually calculated
  DIC = NA,               # not implemented
  WAIC = NA,              # not implemented
  R2 = NA                 # Bayesian R² coukd not be calculated
)


# Rstanarm Poisson-Model
model_results$poisson_rstanarm <- list(
  Package = "rstanarm",
  Family = "poisson",
  Type = "Bayesian",
  Model = "mod.rstan.poisson",
  AIC = NA,
  BIC = NA,
  DIC = NA,
  WAIC = 1.209684e+15,  
  R2 = 0.497           # Bayesian R²
)


# GAMM Poisson-Model
model_results$poisson_gamm <- list(
  Package = "gamm4",
  Family = "poisson",
  Type = "Non-Bayesian",
  Model = "mod.gamm.poisson",
  AIC = 1405,           
  BIC = 1442,           
  DIC = NA,               # not implemented
  WAIC = NA,              # not implemented
  R2 = 0.422              # Approx. R²
)


# R2BayesX Poisson-Model
model_results$poisson_r2bayesx <- list(
  Package = "R2BayesX",
  Family = "poisson",
  Type = "Bayesian",
  Model = "mod.r2bayesx.poisson",
  AIC = NA,      # not implemented
  BIC = NA,      # not implemented
  DIC = NA,      # not implemented
  WAIC = NA,     # not implemented
  R2 = 0.277     # Approx. R²
)

# qgam Poisson-Model
model_results$poisson_qgam <- list(
  Package = "qgam",
  Family = "poisson",
  Type = "Non-Bayesian",
  Model = "mod.qgam.poisson",
  AIC = 4271, 
  BIC = 4569,  
  DIC = NA,           # not implemented
  WAIC = NA,          # not implemented
  R2 = 0.0132         # Pseudo-R²
)


# spikeSlabGAM Poisson-Model
model_results$poisson_spikeSlabGAM <- list(
  Package = "spikeSlabGAM",
  Family = "poisson",
  Type = "Bayesian",
  Model = "mod.spikeslabgam.poisson",
  AIC = NA,                # not implemented
  BIC = NA,                # not implemented
  DIC = 1199,       
  WAIC = 53645,     
  R2 = 0.276               # Bayesian R² (single value)
)

# gammSlice Poisson-Model
model_results$poisson_gammSlice <- list(
  Package = "gammSlice",
  Family = "poisson",
  Type = "Bayesian",
  Model = "mod.gammslice.poisson",
  AIC = NA,  # not implemented
  BIC = NA,  # not implemented
  DIC = NA,  # not implemented
  WAIC = NA, # not implemented
  R2 = NA    # not implemented
)

#NB models

# Negative Binomial GAM Modell (mgcv)
model_results$nb_gam <- list(
  Package = "mgcv",
  Family = "nb",
  Type = "Non-Bayesian",
  Model = "mod.mgcv.gam.nb.no_pc",
  AIC = 1030,
  BIC = 1252,
  DIC = NA,   # not implemented
  WAIC = NA,  # not implemented
  R2 = 0.362
)

# GAMLSS NB1
model_results$gamlss_nb1 <- list(
  Package = "gamlss",
  Family = "nb1",
  Type = "Non-Bayesian",
  Model = "mod.gamlss.nb1",
  AIC = 1014,
  BIC = 1292,
  DIC = NA,   # not implemented
  WAIC = NA,  # not implemented
  R2 = 0.441
)

# GAMLSS NB2
model_results$gamlss_nb2 <- list(
  Package = "gamlss",
  Family = "nb2",
  Type = "Non-Bayesian",
  Model = "mod.gamlss.nb2",
  AIC = 989,
  BIC = 1167,
  DIC = NA,   # not implemented
  WAIC = NA,  # not implemented
  R2 = 0.387
)

# INLA NB1 RW1
model_results$inla_nb1_rw1 <- list(
  Package = "INLA",
  Family = "nb1",
  Type = "Bayesian",
  Model = "result.inla.nb1_rw1",
  AIC = NA,  # not implemented
  BIC = NA,  # not implemented
  DIC = 1013,
  WAIC = 1015,
  R2 = 0.455
)

# INLA NB1 RW2
model_results$inla_nb1_rw2 <- list(
  Package = "INLA",
  Family = "nb1",
  Type = "Bayesian",
  Model = "result.inla.nb1_rw2",
  AIC = NA,  # not implemented
  BIC = NA,  # not implemented
  DIC = 1011,  
  WAIC = 1013,  
  R2 = 0.458
)

# INLA NB2 RW1
model_results$inla_nb2_rw1 <- list(
  Package = "INLA",
  Family = "nb2",
  Type = "Bayesian",
  Model = "result.inla.nb2_rw1",
  AIC = NA,  # not implemented
  BIC = NA,  # not implemented
  DIC = 1016,  
  WAIC = 1017,  
  R2 = 0.448  
)

# INLA NB2 RW2
model_results$inla_nb2_rw2 <- list(
  Package = "INLA",
  Family = "nb2",
  Type = "Bayesian",
  Model = "result.inla.nb2_rw2",
  AIC = NA,  # not implemented
  BIC = NA,  # not implemented
  DIC = 1015,  
  WAIC = 1017,  
  R2 = 0.447  
)

# GLMMTMB NB1
model_results$glmmTMB_nb1 <- list(
  Package = "glmmTMB",
  Family = "nb1",
  Type = "Non-Bayesian",
  Model = "mod.glmmTMB.nb1",
  AIC = 1061,  
  BIC = 1112,  
  DIC = NA,    # not implemented
  WAIC = NA,   # not implemented
  R2 = 0.286   
)

# GLMMTMB NB2
model_results$glmmTMB_nb2 <- list(
  Package = "glmmTMB",
  Family = "nb2",
  Type = "Non-Bayesian",
  Model = "mod.glmmTMB.nb2",
  AIC = 1089,  
  BIC = 1140,  
  DIC = NA,    # not implemented
  WAIC = NA,   # not implemented
  R2 = 0.311   
)

# rstanarm NB2
model_results$rstanarm_nb2 <- list(
  Package = "rstanarm",
  Family = "nb2",
  Type = "Bayesian",
  Model = "mod.rstan.nb",
  AIC = NA,    # not implemented
  BIC = NA,    # not implemented
  DIC = NA,    # not implemented
  WAIC = 1563, 
  R2 = 0.405   
)

# Quasipoisson GAM
model_results$quasipoisson_gam <- list(
  Package = "mgcv",
  Family = "quasipoisson",
  Type = "Non-Bayesian",
  Model = "mod.mgcv.gam.no_pc.quasi",
  AIC = 1087,  
  BIC = 1478,  
  DIC = NA,    # not implemented
  WAIC = NA,   # not implemented
  R2 = 0.506   
)

# GAMLSS ZIP
model_results$gamlss_zip <- list(
  Package = "gamlss",
  Family = "zi",
  Type = "Non-Bayesian",
  Model = "mod.gamlss.zip",
  AIC = 1000,  
  BIC = 1358,  
  DIC = 1000,  
  WAIC = NA,   # not implemented
  R2 = 0.541   
)

# GAMLSS ZINBI
model_results$gamlss_zinbi <- list(
  Package = "gamlss",
  Family = "zi",
  Type = "Non-Bayesian",
  Model = "mod.gamlss.zinbi",
  AIC = 984,   
  BIC = 1168,  
  DIC = 984,   
  WAIC = NA,   # Nnot implemented
  R2 = 0.387   
)

# GAM mit PC
model_results$gam_with_pc <- list(
  Package = "mgcv",
  Family = "nb",
  Type = "Non-Bayesian",
  Model = "mod.mgcv.gam.pc",
  AIC = 1030,  
  BIC = 1252,  
  DIC = NA,    # not implemented
  WAIC = NA,   # not implemented
  R2 = 0.362   
)
```


```{r}
# Iterate through all models and check for missing or incorrect types
check_types <- lapply(model_results, function(model) {
  if (is.null(model$Type)) {
    return(paste("Model", model$Model, "no defined type"))
  } else {
    return(NULL)
  }
})

print(Filter(Negate(is.null), check_types))

```


```{r}
# Correct missing types in the model_results dictionary

# Poisson-GAM (mgcv)
model_results$poisson_gam$Type <- "Non-Bayesian"

# GAMLSS Poisson
model_results$poisson_gamlss$Type <- "Non-Bayesian"

# INLA Poisson RW1
model_results$poisson_inla_rw1$Type <- "Bayesian"

# INLA Poisson RW2
model_results$poisson_inla_rw2$Type <- "Bayesian"

# GLMMTMB Poisson
model_results$poisson_glmmTMB$Type <- "Non-Bayesian"

# GAMM4 Poisson
model_results$poisson_gamm4$Type <- "Non-Bayesian"

# R2BayesX Poisson
model_results$poisson_R2BayesX$Type <- "Bayesian"

# Negative Binomial GAM (mgcv)
model_results$gam_no_pc$Type <- "Non-Bayesian"

# Quasi-Poisson GAM
model_results$quasipoisson$Type <- "Non-Bayesian"

# ZIP (GAMLSS)
model_results$zip$Type <- "Non-Bayesian"

# ZINBI (GAMLSS)
model_results$zinbi$Type <- "Non-Bayesian"

# check types
check_types <- lapply(model_results, function(model) {
  if (is.null(model$Type)) {
    return(paste("Model", model$Model, "not defined"))
  } else {
    return(NULL)
  }
})

missing_types <- Filter(Negate(is.null), check_types)
if (length(missing_types) == 0) {
  print("Alle Modelle haben jetzt einen definierten Typ!")
} else {
  print(missing_types)
}

```


All models:
```{r}
library(gt)
library(dplyr)

# Function to create a table for all models and save as PNG.
save_model_table_as_png <- function(model_dict, file_name) {
  # Extract the models from the dictionary and create a DataFrame.
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%  # remove duplicates
    arrange(desc(R2)) # Sort by R² in descending order
  
  # create table with gt
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = "Model Results for All Models (Sorted by R²)"
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  # Round R² 
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  # Color the R² column based on the values.
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(45),         
      Family ~ px(50),          
      Type ~ px(40),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(50),            
      R2 ~ px(30)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F5F5F5"),   # Very light gray background for Bayesian models
        cell_text(color = "black")     
      ),
      locations = cells_body(
        rows = Type == "Bayesian",   # only for  Bayesian-Models
        columns = Type              
      )
    ) %>%
    tab_options(
      table.font.size = px(7),            
      data_row.padding = px(1),           
      table.width = pct(90),            
      table.margin.left = px(5),        
      table.margin.right = px(5)         
    )
  
  # save table as PNG
  gtsave(model_table, file_name)
}

# Call the function and save as PNG
save_model_table_as_png(model_results, "model_results_distinct.png")

```



All bayesian models
```{r}
library(gt)
library(dplyr)

# Function to create a table only for Bayesian models
display_bayesian_models <- function(model_dict) {
  # Extract the models from the dictionary, filter by "Type == Bayesian," and remove duplicates.
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%  # remove deuplicates
    filter(Type == "Bayesian") %>%         # only Bayesian-Modelle
    arrange(desc(R2))                      # Sort by R² in descending order
  
  # Erstelle die Tabelle mit gt
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = "Model Results for Bayesian Models (Sorted by R²)"
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  # round
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  # Round R² 
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(40),         
      Family ~ px(25),          
      Type ~ px(25),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(20), 
      WAIC ~ px(75),            
      R2 ~ px(25)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F5F5F5"),   
        cell_text(color = "black")    
      ),
      locations = cells_body(
        rows = Type == "Bayesian",   
        columns = Type              
      )
    ) %>%
    tab_options(
      table.font.size = px(11),            
      data_row.padding = px(1),           
      table.width = pct(90),              
      table.margin.left = px(5),          
      table.margin.right = px(5)          
    )
  
  # print table
  print(model_table)
}

# Call the function to display only Bayesian models.
display_bayesian_models(model_results)

```

All Bayesian models sorted by WAIC.
```{r}
library(gt)
library(dplyr)

# Function to create a table only for Bayesian models
display_bayesian_models <- function(model_dict) {
  # Extract the models from the dictionary, filter by "Type == Bayesian," and remove duplicates.
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%  
    filter(Type == "Bayesian") %>%         # Filter
    arrange(WAIC)                      
  
  # create table with gt
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = "Model Results for Bayesian Models (Sorted by WAIC)"
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(40),         
      Family ~ px(25),          
      Type ~ px(25),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(20), 
      WAIC ~ px(75),            # Wider column for WAIC.
      R2 ~ px(25)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F5F5F5"),   
        cell_text(color = "black")     
      ),
      locations = cells_body(
        rows = Type == "Bayesian",   
        columns = Type              
      )
    ) %>%
    tab_options(
      table.font.size = px(11),            
      data_row.padding = px(1),           
      table.width = pct(90),              
      table.margin.left = px(5),          
      table.margin.right = px(5)          
    )
  
  # print table
  print(model_table)
}

# Call the function to display only Bayesian models
display_bayesian_models(model_results)
```


ALL NON BAYESIAN MODELS
```{r}
library(gt)
library(dplyr)

# Function to create a table only for non-Bayesian models.
display_non_bayesian_models <- function(model_dict) {
  # Extract the models from the dictionary and filter by "Type == Non-Bayesian"
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    filter(Type == "Non-Bayesian") %>%  # Filter for Non-Bayesian-Models
    arrange(desc(R2)) 
  
  # create table with gt
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = "Model Results for Non-Bayesian Models (Sorted by R²)"
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(45),         
      Family ~ px(50),          
      Type ~ px(40),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(10),            # Wider column for WAIC.
      R2 ~ px(30)               
    ) %>%
    tab_options(
      table.font.size = px(9),            
      data_row.padding = px(1),           
      table.width = pct(90),              
      table.margin.left = px(5),          
      table.margin.right = px(5)          
    )
  
  # print table
  print(model_table)
}

# Call the function to display only non-Bayesian models
display_non_bayesian_models(model_results)

```


Non-Bayesian models sorted by AIC
```{r}
library(gt)
library(dplyr)

# define Function
display_models_by_type <- function(model_dict, model_type) {
  # Extract models from the dictionary, filter by type, and remove duplicates
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%   
    filter(Type == model_type) %>%         
    arrange(desc(R2))                      
  
  # create table with gt
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for", model_type, "Models (Sorted by R²)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(55),         
      Family ~ px(50),          
      Type ~ px(40),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(20),            
      R2 ~ px(25)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "white"),   
        cell_text(color = "black")     
      ),
      locations = cells_body(
        rows = Type == model_type,   
        columns = Type              
      )
    ) %>%
    tab_options(
      table.font.size = px(10),           
      data_row.padding = px(1),          
      table.width = pct(90),             
      table.margin.left = px(5),         
      table.margin.right = px(5)         
    )
  
  # print table
  print(model_table)
}

# Call the function to display non-Bayesian models
display_models_by_type(model_results, "Non-Bayesian")

```


Non-Bayesian models sorted by WAIC in descending order
```{r}
library(gt)
library(dplyr)

# define function
display_models_by_type <- function(model_dict, model_type) {
  # Extract the models from the dictionary, filter by type, and remove duplicates
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%   
    filter(Type == model_type) %>%         # Filter
    arrange(AIC)                    # sort by
  
  # create table wih gt
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for", model_type, "Models (Sorted by AIC)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(55),        
      Family ~ px(50),          
      Type ~ px(40),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(20),            
      R2 ~ px(25)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "white"),  
        cell_text(color = "black")  
      ),
      locations = cells_body(
        rows = Type == model_type,   
        columns = Type              
      )
    ) %>%
    tab_options(
      table.font.size = px(10),           
      data_row.padding = px(1),          
      table.width = pct(90),            
      table.margin.left = px(5),         
      table.margin.right = px(5)         
    )
  
  # print table
  print(model_table)
}

# call function
display_models_by_type(model_results, "Non-Bayesian")

```


sortd by packages:
```{r}
library(gt)
library(dplyr)

# Function to prepare the dictionary (check and correct).
prepare_model_dict <- function(model_dict) {
  # Iterate through all models and add missing information.
  model_dict <- lapply(model_dict, function(model) {
    if (is.null(model$Package)) model$Package <- NA
    if (is.null(model$Family)) model$Family <- NA
    if (is.null(model$Type)) model$Type <- NA
    return(model)
  })
  
  # mgcv makes problems, so here i add it again
  model_dict$poisson_gamm <- list(
    Package = "mgcv",
    Family = "poisson",
    Model = "mgcv gamm poisson",
    Type = "Non-Bayesian",
    AIC = 5118,
    BIC = 5155,
    DIC = NA,
    WAIC = NA,
    R2 = 0.053
  )
  
  return(model_dict)
}

# define function
display_models_by_package <- function(model_dict, package_name) {
  # prepare models
  model_dict <- prepare_model_dict(model_dict)
  
  # Extract the models from the dictionary, filter by package, and remove duplicates
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%  
    filter(Package == package_name) %>%    # Filter
    arrange(desc(R2))                      
  
  # create table
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for Package", package_name, "(Sorted by R²)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(30),         
      Family ~ px(30),          
      Type ~ px(40),            
      Model ~ px(70),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(20),            
      R2 ~ px(25)              
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "white"),   
        cell_text(color = "black")   
      ),
      locations = cells_body(
        rows = Package == package_name,   # filter by package
        columns = Package                
      )
    ) %>%
    tab_options(
      table.font.size = px(12),          
      data_row.padding = px(1),          
      table.width = pct(90),             
      table.margin.left = px(5),         
      table.margin.right = px(5)         
    )
  
  # print table
  print(model_table)
}

# filter by package (eg. mgcv)
display_models_by_package(model_results, "glmmTMB")

```


Sort by package and R² in descending order
```{r}
library(gt)
library(dplyr)

# Function to prepare the dictionary (check and correct)
prepare_model_dict <- function(model_dict) {
  # Iterate through all models and add missing information.
  model_dict <- lapply(model_dict, function(model) {
    if (is.null(model$Package)) model$Package <- NA
    if (is.null(model$Family)) model$Family <- NA
    if (is.null(model$Type)) model$Type <- NA
    return(model)
  })
  
  # sepcial case
  model_dict$poisson_gamm <- list(
    Package = "mgcv",
    Family = "poisson",
    Model = "mgcv gamm poisson",
    Type = "Non-Bayesian",
    AIC = 5118,
    BIC = 5155,
    DIC = NA,
    WAIC = NA,
    R2 = 0.053
  )
  
  return(model_dict)
}

# Function to create a table for specific types of models
display_models_by_package <- function(model_dict, package_name) {
  # prep models
  model_dict <- prepare_model_dict(model_dict)
  
  # Extract the models from the dictionary, filter by type, and remove duplicates
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%   
    filter(Package == package_name) %>%    
    arrange(desc(R2))                      
  
  # create table
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for Package", package_name, "(Sorted by R²)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(30),         
      Family ~ px(30),          
      Type ~ px(55),            
      Model ~ px(60),           
      c(AIC, BIC, DIC) ~ px(15), 
      WAIC ~ px(70),            # extra wide for WAIC
      R2 ~ px(25)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "white"),   
        cell_text(color = "black")   
      ),
      locations = cells_body(
        rows = Package == package_name,   
        columns = Package                
      )
    ) %>%
    tab_options(
      table.font.size = px(12),           
      data_row.padding = px(1),          
      table.width = pct(90),             
      table.margin.left = px(5),         
      table.margin.right = px(5)         
    )
  
  # print table
  print(model_table)
}

# put in package zb. "mgcv"
display_models_by_package(model_results, "rstanarm")
```

nach FAMILY:
Poisson
```{r}
library(gt)
library(dplyr)

#Function to prepare the dictionary 
prepare_model_dict <- function(model_dict) {
  # Iterate through all models and add missing information
  model_dict <- lapply(model_dict, function(model) {
    if (is.null(model$Package)) model$Package <- NA
    if (is.null(model$Family)) model$Family <- NA
    if (is.null(model$Type)) model$Type <- NA
    return(model)
  })
  
  # special case
  model_dict$poisson_gamm <- list(
    Package = "mgcv",
    Family = "poisson",
    Model = "mgcv gamm poisson",
    Type = "Non-Bayesian",
    AIC = 5118,
    BIC = 5155,
    DIC = NA,
    WAIC = NA,
    R2 = 0.053
  )
  
  return(model_dict)
}

# function for family
display_models_by_family <- function(model_dict, family_name) {
  # prep models
  model_dict <- prepare_model_dict(model_dict)
  
  # Extract the models from the dictionary, filter by type, and remove duplicates
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%   
    filter(Family == family_name) %>%      # Filter for family
    arrange(desc(R2))                      
  
  # create table
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for Family", family_name, "(Sorted by R²)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(50),         
      Family ~ px(30),          
      Type ~ px(40),            
      Model ~ px(90),           # extra wide for "Model"
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(85),            
      R2 ~ px(25)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F0F0F0"),   
        cell_text(color = "black")     
      ),
      locations = cells_body(
        rows = Type == "Bayesian",     
        columns = Type                # colour for bayesian
      )
    ) %>%
    tab_options(
      table.font.size = px(12),           
      data_row.padding = px(1),          
      table.width = pct(90),             
      table.margin.left = px(5),         
      table.margin.right = px(5)         
    )
  
  # print table
  print(model_table)
}

# insert family to display "poisson"
display_models_by_family(model_results, "poisson")

```


Zero inflated models
```{r}
library(gt)
library(dplyr)

# Function to prepare the dictionary
prepare_model_dict <- function(model_dict) {
  # Iterate through all models and add missing information
  model_dict <- lapply(model_dict, function(model) {
    if (is.null(model$Package)) model$Package <- NA
    if (is.null(model$Family)) model$Family <- NA
    if (is.null(model$Type)) model$Type <- NA
    
    # Grouping: Replace "nb1" and "nb2" with "nb" and "zip"/"zinbi" with "zi"
    # if (model$Family %in% c("nb1", "nb2")) model$Family <- "nb"
    if (model$Family %in% c("zip", "zinbi")) model$Family <- "zi"
    
    return(model)
  })
  
  # Special case
  model_dict$poisson_gamm <- list(
    Package = "mgcv",
    Family = "poisson",
    Model = "mgcv gamm poisson",
    Type = "Non-Bayesian",
    AIC = 5118,
    BIC = 5155,
    DIC = NA,
    WAIC = NA,
    R2 = 0.053
  )
  
  return(model_dict)
}

# function for table of specific families
display_models_by_family <- function(model_dict, family_name) {
  # prep model
  model_dict <- prepare_model_dict(model_dict)
  
  # Extract the models from the dictionary, filter by package, and remove duplicates
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA),
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%   
    filter(Family == family_name) %>%      # Filter for family
    arrange(desc(R2))                      
  
  # create table
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for Family", family_name, "(Sorted by R²)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(50),        
      Family ~ px(30),          
      Type ~ px(40),            
      Model ~ px(90),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(85),            
      R2 ~ px(25)              
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F0F0F0"),   
        cell_text(color = "black")     
      ),
      locations = cells_body(
        rows = Type == "Bayesian",     
        columns = Type                
      )
    ) %>%
    tab_options(
      table.font.size = px(12),           
      data_row.padding = px(1),          
      table.width = pct(90),             
      table.margin.left = px(5),         
      table.margin.right = px(5)         
    )
  
  # create table
  print(model_table)
}

# but in family, here zi for zero onflated models
display_models_by_family(model_results, "zi")

```


NB models
```{r}
library(gt)
library(dplyr)

# Function to prepare the dictionary (check and correct and group)
prepare_model_dict <- function(model_dict) {
  # Iterate through all models and add missing information
  model_dict <- lapply(model_dict, function(model) {
    if (is.null(model$Package)) model$Package <- NA
    if (is.null(model$Family)) model$Family <- NA
    if (is.null(model$Type)) model$Type <- NA
    
    # Grouping: Replace "nb1" and "nb2" with "nb" for grouping
    model$GroupFamily <- model$Family  # keep original family
    if (model$Family %in% c("nb1", "nb2")) model$Family <- "nb"
    if (model$Family %in% c("zip", "zinbi")) model$Family <- "zi"
    
    return(model)
  })
  
  # just in casem for unity
  model_dict$poisson_gamm <- list(
    Package = "mgcv",
    Family = "poisson",
    GroupFamily = "poisson", 
    Model = "mgcv gamm poisson",
    Type = "Non-Bayesian",
    AIC = 5118,
    BIC = 5155,
    DIC = NA,
    WAIC = NA,
    R2 = 0.053
  )
  
  return(model_dict)
}

# Function to create a table for a specific family.
display_models_by_family <- function(model_dict, family_name) {
  # prep model
  model_dict <- prepare_model_dict(model_dict)
  
  # Extract the models from the dictionary, filter by package, and remove duplicates.
  model_data <- lapply(model_dict, function(model) {
    data.frame(
      Model = ifelse(!is.null(model$Model), model$Model, NA),
      Package = ifelse(!is.null(model$Package), model$Package, NA),
      Family = ifelse(!is.null(model$Family), model$Family, NA), # grouped family
      GroupFamily = ifelse(!is.null(model$GroupFamily), model$GroupFamily, NA), # Original family
      Type = ifelse(!is.null(model$Type), model$Type, NA),
      AIC = ifelse(!is.null(model$AIC), model$AIC, NA),
      BIC = ifelse(!is.null(model$BIC), model$BIC, NA),
      DIC = ifelse(!is.null(model$DIC), model$DIC, NA),
      WAIC = ifelse(!is.null(model$WAIC), model$WAIC, NA),
      R2 = ifelse(!is.null(model$R2), model$R2, NA),
      stringsAsFactors = FALSE
    )
  }) %>% 
    bind_rows() %>% 
    distinct(Model, .keep_all = TRUE) %>%   
    filter(Family == family_name) %>%      
    arrange(desc(R2))                      
  
  # create table
  model_table <- model_data %>%
    gt() %>%
    tab_header(
      title = paste("Model Results for Family", family_name, "(Sorted by R²)")
    ) %>%
    fmt_number(
      columns = c(AIC, BIC, DIC, WAIC),  
      decimals = 0
    ) %>%
    fmt_number(
      columns = c(R2),  
      decimals = 3
    ) %>%
    data_color(
      columns = c(R2),  
      colors = scales::col_numeric(
        palette = c("white", "lightblue", "blue"),
        domain = NULL
      )
    ) %>%
    cols_width(
      Package ~ px(50),         
      Family ~ px(30),          
      GroupFamily ~ px(50),     
      Type ~ px(40),            
      Model ~ px(95),           
      c(AIC, BIC, DIC) ~ px(30), 
      WAIC ~ px(35),            
      R2 ~ px(35)               
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F0F0F0"),   
        cell_text(color = "black")     
      ),
      locations = cells_body(
        rows = Type == "Bayesian",    
        columns = Type                
      )
    ) %>%
    tab_options(
      table.font.size = px(12),           
      data_row.padding = px(1),          
      table.width = pct(90),             
      table.margin.left = px(5),        
      table.margin.right = px(5)         
    )
  
  # print table
  print(model_table)
}

# filter for al nb families
display_models_by_family(model_results, "nb")

```


------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


GRID PLOTS FOR VARIANCES OF RANDOM EFFECTS 

Poisson
```{r}
library(ggplot2)

# values
model_data <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",
            "mod.glmmTMB.poisson",
            "mod.r2bayesx.poisson",
            "mod.qgam.poisson"),
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147),  # Standard deviation for RW1
             sqrt(1 / 1.944296),  # Standard deviation for RW2
             sqrt(2.60322776861537),  # Standard deviation for rstanarm
             1.5169229,           # Standard deviation from glmmTMB
             1.2209,              # Standard deviation from R2BayesX
             0.225316287992039),  # Standard deviation from qgam
  LowerCI = c(1.078233, NA, 1.16, 
              sqrt(1 / 3.84756),  # Lower bound of the CI for RW1
              sqrt(1 / 4.079822), # Lower bound of the CI for RW2
              NA,                 # Lower bound for rstanarm (if not available)
              NA,                 # No CI available for glmmTMB
              1.2716,             # Lower bound of the CI for R2BayesX
              NA),                # No CI available for qgam
  UpperCI = c(2.169883, NA, 2.41, 
              sqrt(1 / 1.091315),  # Upper bound of the CI for RW1
              sqrt(1 / 1.077174),  # Upper bound of the CI for RW2
              NA,                 # Upper bound for rstanarm (if not available)
              NA,                 # No CI available for glmmTMB
              5.9462,             # Upper bound of the CI for R2BayesX
              NA),                # No CI available for qgam
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Bayesian", "Non-Bayesian"),
  Package = c("mgcv", "mgcv", "brms",     
              "INLA", "INLA", "rstan",
              "glmmTMB", "R2BayesX", "qgam")
)

# create Plot
ggplot(model_data, aes(x = Model, y = StdDev, color = Type)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  # CI
  theme_minimal() +
  labs(
    title = "Standard Deviation of Random Effects Poisson",
    x = "Modell",
    y = "Standard Deviation",
    color = "Type"  # colours for bayesian or non- bayesian
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14)
  )


```


poisson with geom line evtl. LÖSCHEN ?
```{r}

library(ggplot2)

# values
model_data <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",
            "mod.glmmTMB.poisson",
            "mod.r2bayesx.poisson",
            "mod.qgam.poisson"),
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147),  # Standard deviation for RW1
             sqrt(1 / 1.944296),  # Standard deviation for RW2
             sqrt(2.60322776861537),  # Standard deviation for rstanarm
             1.5169229,           # Standard deviation from glmmTMB
             1.2209,              # Standard deviation from R2BayesX
             0.225316287992039),  # Standard deviation from qgam
  LowerCI = c(1.078233, NA, 1.16, 
              sqrt(1 / 3.84756),  # Lower bound of the CI for RW1
              sqrt(1 / 4.079822), # Lower bound of the CI for RW2
              NA,                 # Lower bound for rstanarm (if not available)
              NA,                 # No CI available for glmmTMB
              1.2716,             # Lower bound of the CI for R2BayesX
              NA),                # No CI available for qgam
  UpperCI = c(2.169883, NA, 2.41, 
              sqrt(1 / 1.091315),  # Upper bound of the CI for RW1
              sqrt(1 / 1.077174),  # Upper bound of the CI for RW2
              NA,                 # Upper bound for rstanarm (if not available)
              NA,                 # No CI available for glmmTMB
              5.9462,             # Upper bound of the CI for R2BayesX
              NA),                # No CI available for qgam
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson", "Poisson"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Bayesian", "Non-Bayesian"),
  Package = c("mgcv", "mgcv", "brms",     
              "INLA", "INLA", "rstan",
              "glmmTMB", "R2BayesX", "qgam")
)

# Plot 
ggplot(model_data, aes(x = Model, y = StdDev, color = Type)) +
  geom_point(size = 4) + 
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  # CI
  theme_minimal() +
  labs(
    title = "Standard Deviation of Random Effects of Poisson Models",
    x = "Model",
    y = "Standard Deviation",
    color = "Type"  # bayesian/ non bayesian coloring
  ) +
theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  text = element_text(size = 14),
  plot.margin = margin(10, 10, 10, 50, "pt")  
) +
coord_cartesian(clip = "off")  # no cut off

```


NB
```{r}
library(ggplot2)

# values for NB-Models with NB_Type
model_data <- data.frame(
  Model = c("mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2"),
  StdDev = c(1.21863867,                    # Std for mod.mgcv.gam.nb.no_pc
             1.13774173045133,              # Std for result.inla.nb1_rw
             1.117165,                      # Std for result.inla.nb2_rw1
             1.135409,                      # Std for result.inla.nb1_rw2
             1.139867,                      # Std for result.inla.nb2_rw2
             0.692336,                      # Std for mod.glmmTMB.nb1
             1.146818),                     # Std for mod.glmmTMB.nb2
  LowerCI = c(0.7988129,                    # Lower CI for mod.mgcv.gam.nb.no_pc
              sqrt(0.641427525907611),      # Lower CI for result.inla.nb1_rw
              sqrt(0.625339),               # Lower CI for result.inla.nb2_rw1
              sqrt(0.637916),               # Lower CI for result.inla.nb1_rw2
              sqrt(0.641229),               # Lower CI for result.inla.nb2_rw2
              sqrt(0.160429),               # Lower CI for mod.glmmTMB.nb1
              sqrt(0.542104)),              # Lower CI for mod.glmmTMB.nb2
  UpperCI = c(1.859109,                     # Upper CI for mod.mgcv.gam.nb.no_pc
              sqrt(2.96639668997612),       # Upper CI for result.inla.nb1_rw
              sqrt(2.88633),                # Upper CI for result.inla.nb2_rw1
              sqrt(2.970777),               # Upper CI for result.inla.nb1_rw2
              sqrt(2.97442),                # Upper CI for result.inla.nb2_rw2
              sqrt(1.432136),               # Upper CI for mod.glmmTMB.nb1
              sqrt(3.190766)),                # Upper CI for mod.glmmTMB.nb2
  Family = c("Negative Binomial", "Negative Binomial", "Negative Binomial",
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial"),          
  Type = c("Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian"),                 
  NB_Type = c("nb", "nb1", "nb2",           # Negative Binomial Types
              "nb1", "nb2", "nb1", 
              "nb2"),
  Package = c("mgcv", "INLA", "INLA",       
              "INLA", "INLA", "glmmTMB", 
              "glmmTMB")
)

# Plot
ggplot(model_data, aes(x = Model, y = StdDev, color = NB_Type)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # line y=0
  theme_minimal() +
  labs(
    title = "Standard Deviation of Random Effects of NB Models",
    x = "Model",
    y = "Standard Deviation",
    color = "NB Type"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14)
  )

```
with rstanarm drin NB:
```{r}
# values
model_data <- data.frame(
  Model = c("mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "mod.rstan.nb"),                # added rstanarm NB-Modell
  StdDev = c(1.21863867,                    
             1.13774173045133,              
             1.117165,                      
             1.135409,                      
             1.139867,                      
             0.692336,                      
             1.146818,                      
             1.222),                     
  LowerCI = c(0.7988129,                    
              sqrt(0.641427525907611),      
              sqrt(0.625339),               
              sqrt(0.637916),               
              sqrt(0.641229),               
              sqrt(0.160429),               
              sqrt(0.542104),               
              NA),                         
  UpperCI = c(1.859109,                     
              sqrt(2.96639668997612),       
              sqrt(2.88633),                
              sqrt(2.970777),               
              sqrt(2.97442),                
              sqrt(1.432136),               
              sqrt(3.190766),               
              NA),                          
  Family = c("Negative Binomial", "Negative Binomial", "Negative Binomial",
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial"), 
  Type = c("Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian"),    
  NB_Type = c("nb", "nb1", "nb2",          
              "nb1", "nb2", "nb1", 
              "nb2", "nb2"),                
  Package = c("mgcv", "INLA", "INLA",      
              "INLA", "INLA", "glmmTMB", 
              "glmmTMB", "rstanarm")        
)

# Plot
ggplot(model_data, aes(x = Model, y = StdDev, color = NB_Type)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + 
  theme_minimal() +
  labs(
    title = "Standard Deviation of Random Effects of NB Models",
    x = "Model",
    y = "Standard Deviation",
    color = "NB Type"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14)
  )

```

Here, NB with forms AND Bayesian type distinguished.

with added rstanarm nb:
```{r}
# values
model_data <- data.frame(
  Model = c("mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "stan.nb"),                    
StdDev = c(1.21863867,                    # Std for mod.mgcv.gam.nb.no_pc
             1.13774173045133,              # Std for result.inla.nb1_rw
             1.117165,                      # Std for result.inla.nb2_rw1
             1.135409,                      # Std for result.inla.nb1_rw2
             1.139867,                      # Std for result.inla.nb2_rw2
             0.692336,                      # Std for mod.glmmTMB.nb1
             1.146818,                      # Std for mod.glmmTMB.nb2
             1.222),                        # Std for stan.nb
  LowerCI = c(0.7988129,                    # Lower CI for mod.mgcv.gam.nb.no_pc
              sqrt(0.641427525907611),      # Lower CI for result.inla.nb1_rw
              sqrt(0.625339),               # Lower CI for result.inla.nb2_rw1
              sqrt(0.637916),               # Lower CI for result.inla.nb1_rw2
              sqrt(0.641229),               # Lower CI for result.inla.nb2_rw2
              sqrt(0.160429),               # Lower CI for mod.glmmTMB.nb1
              sqrt(0.542104),               # Lower CI for mod.glmmTMB.nb2
              NA),                          # No CI for stan.nb
  UpperCI = c(1.859109,                     # Upper CI for mod.mgcv.gam.nb.no_pc
              sqrt(2.96639668997612),       # Upper CI for result.inla.nb1_rw
              sqrt(2.88633),                # Upper CI for result.inla.nb2_rw1
              sqrt(2.970777),               # Upper CI for result.inla.nb1_rw2
              sqrt(2.97442),                # Upper CI for result.inla.nb2_rw2
              sqrt(1.432136),               # Upper CI for mod.glmmTMB.nb1
              sqrt(3.190766),               # Upper CI for mod.glmmTMB.nb2
              NA),                           # No CI for stan.nb
  Family = c("Negative Binomial", "Negative Binomial", "Negative Binomial",
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial"),  
  Type = c("Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian"),                 
  NB_Type = c("nb", "nb1", "nb2",           # Negative Binomial Type
              "nb1", "nb2", "nb1", 
              "nb2", "nb2"),
  Package = c("mgcv", "INLA", "INLA",      
              "INLA", "INLA", "glmmTMB", 
              "glmmTMB", "rstanarm")       
)

# Create a plot with shapes for NB_Type and colors for Type
ggplot(model_data, aes(x = Model, y = StdDev, color = Type, shape = NB_Type)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  theme_minimal() +
  labs(
    title = "Standard Deviation of Random Effects of NB Models",
    x = "Model",
    y = "Standard Deviation",
    color = "Type",  # Legend for colours
    shape = "NB Type"  # Legend for forms
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14)
  )

```


Frame with all models
```{r}
# All models
all_model_data <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",
            "mod.glmmTMB.poisson",
            "mod.r2bayesx.poisson",
            "mod.qgam.poisson",
            "mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "mod.mgcv.gam.no_pc.quasi",
            "mod.mgcv.gam.pc"),
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147), sqrt(1 / 1.944296), 
             sqrt(2.60322776861537), 1.5169229, 1.2209, 
             0.225316287992039, 1.21863867, 1.13774173045133, 
             1.117165, 1.135409, 1.139867, 0.692336, 1.146818, 
             1.46707906, 1.21863868),
  LowerCI = c(1.078233, NA, 1.16, sqrt(1 / 3.84756), sqrt(1 / 4.079822), 
              NA, NA, 1.2716, NA, 0.7988129, sqrt(0.641427525907611), 
              sqrt(0.625339), sqrt(0.637916), sqrt(0.641229), sqrt(0.160429), 
              sqrt(0.542104), 1.027261, 0.7988129),
  UpperCI = c(2.169883, NA, 2.41, sqrt(1 / 1.091315), sqrt(1 / 1.077174), 
              NA, NA, 5.9462, NA, 1.859109, sqrt(2.96639668997612), 
              sqrt(2.88633), sqrt(2.970777), sqrt(2.97442), sqrt(1.432136), 
              sqrt(3.190766), 2.095204, 1.859109),
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", 
             "Poisson", "Poisson", "Poisson", "Poisson", 
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Quasi-Poisson", "Poisson"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Non-Bayesian", "Non-Bayesian"),
  Package = c("mgcv", "mgcv", "brms", "INLA", "INLA", "rstan", 
              "glmmTMB", "R2BayesX", "qgam", "mgcv", "INLA", "INLA", 
              "INLA", "INLA", "glmmTMB", "glmmTMB", "mgcv", "mgcv")
)
```



mit gamm4 und rstanarm noch: es mpüssen 20 sein (weil -5 gamlss)
```{r}
# Combine all models, including rstan.nb and gamm4.poisson
all_model_data <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",
            "mod.glmmTMB.poisson",
            "mod.r2bayesx.poisson",
            "mod.qgam.poisson",
            "mod.gamm4.poisson",           
            "mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "stan.nb",                     
            "mod.mgcv.gam.no_pc.quasi",
            "mod.mgcv.gam.pc"),
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147), sqrt(1 / 1.944296), 
             sqrt(2.60322776861537), 1.5169229, 1.2209, 
             0.225316287992039, 1.529,             
             1.21863867, 1.13774173045133, 
             1.117165, 1.135409, 1.139867, 0.692336, 1.146818, 
             1.222,                       
             1.46707906, 1.21863868),
  LowerCI = c(1.078233, NA, 1.16, sqrt(1 / 3.84756), sqrt(1 / 4.079822), 
              NA, NA, 1.2716, NA, NA,       
              0.7988129, sqrt(0.641427525907611), 
              sqrt(0.625339), sqrt(0.637916), sqrt(0.641229), sqrt(0.160429), 
              sqrt(0.542104), NA,          
              1.027261, 0.7988129),
  UpperCI = c(2.169883, NA, 2.41, sqrt(1 / 1.091315), sqrt(1 / 1.077174), 
              NA, NA, 5.9462, NA, NA,       
              1.859109, sqrt(2.96639668997612), 
              sqrt(2.88633), sqrt(2.970777), sqrt(2.97442), sqrt(1.432136), 
              sqrt(3.190766), NA,          
              2.095204, 1.859109),
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", 
             "Poisson", "Poisson", "Poisson", "Poisson", "Poisson",  
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", 
             "Quasi-Poisson", "Poisson"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Bayesian", "Non-Bayesian", "Non-Bayesian",  
           "Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian",   
           "Non-Bayesian", "Non-Bayesian"),
  Package = c("mgcv", "mgcv", "brms", "INLA", "INLA", "rstan", 
              "glmmTMB", "R2BayesX", "qgam", "gamm4",           
              "mgcv", "INLA", "INLA", 
              "INLA", "INLA", "glmmTMB", "glmmTMB", "rstanarm",  
              "mgcv", "mgcv")
)

```


Without QGAM: 19 models.
```{r}
# Combine all models, including rstan.nb and gamm4.poisson, 19 models
all_model_dataq <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",
            "mod.glmmTMB.poisson",
            "mod.r2bayesx.poisson",
            "mod.gamm4.poisson",           
            "mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "stan.nb",                     
            "mod.mgcv.gam.no_pc.quasi",
            "mod.mgcv.gam.pc"),
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147), sqrt(1 / 1.944296), 
             sqrt(2.60322776861537), 1.5169229, 1.2209, 
             1.529,            
             1.21863867, 1.13774173045133, 
             1.117165, 1.135409, 1.139867, 0.692336, 1.146818, 
             1.222,                       
             1.46707906, 1.21863868),
  LowerCI = c(1.078233, NA, 1.16, sqrt(1 / 3.84756), sqrt(1 / 4.079822), 
              NA, NA, 1.2716, NA,       
              0.7988129, sqrt(0.641427525907611), 
              sqrt(0.625339), sqrt(0.637916), sqrt(0.641229), sqrt(0.160429), 
              sqrt(0.542104), NA,          
              1.027261, 0.7988129),
  UpperCI = c(2.169883, NA, 2.41, sqrt(1 / 1.091315), sqrt(1 / 1.077174), 
              NA, NA, 5.9462, NA,      
              1.859109, sqrt(2.96639668997612), 
              sqrt(2.88633), sqrt(2.970777), sqrt(2.97442), sqrt(1.432136), 
              sqrt(3.190766), NA,         
              2.095204, 1.859109),
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", 
             "Poisson", "Poisson", "Poisson", "Poisson",  
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", 
             "Quasi-Poisson", "Poisson"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian",   
           "Non-Bayesian", "Non-Bayesian"),
  Package = c("mgcv", "mgcv", "brms", "INLA", "INLA", "rstan", 
              "glmmTMB", "R2BayesX", "gamm4",           
              "mgcv", "INLA", "INLA", 
              "INLA", "INLA", "glmmTMB", "glmmTMB", "rstanarm",  
              "mgcv", "mgcv")
)
```


Without R2bayesx for comparison of scale (18 models)
```{r}
# All 18 Models 
all_model_data2 <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",
            "mod.glmmTMB.poisson",
            "mod.gamm4.poisson",          
            "mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "stan.nb",                    
            "mod.mgcv.gam.no_pc.quasi",
            "mod.mgcv.gam.pc"),
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147), sqrt(1 / 1.944296), 
             sqrt(2.60322776861537), 1.5169229, 
             1.529,             
             1.21863867, 1.13774173045133, 
             1.117165, 1.135409, 1.139867, 0.692336, 1.146818, 
             1.222,                      
             1.46707906, 1.21863868),
  LowerCI = c(1.078233, NA, 1.16, sqrt(1 / 3.84756), sqrt(1 / 4.079822), 
              NA, NA, NA,       
              0.7988129, sqrt(0.641427525907611), 
              sqrt(0.625339), sqrt(0.637916), sqrt(0.641229), sqrt(0.160429), 
              sqrt(0.542104), NA,          
              1.027261, 0.7988129),
  UpperCI = c(2.169883, NA, 2.41, sqrt(1 / 1.091315), sqrt(1 / 1.077174), 
              NA, NA, NA,      
              1.859109, sqrt(2.96639668997612), 
              sqrt(2.88633), sqrt(2.970777), sqrt(2.97442), sqrt(1.432136), 
              sqrt(3.190766), NA,          
              2.095204, 1.859109),
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", 
             "Poisson", "Poisson", "Poisson",  
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", 
             "Quasi-Poisson", "Negative Binomial"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Non-Bayesian",  
           "Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian",   
           "Non-Bayesian", "Non-Bayesian"),
  Package = c("mgcv", "mgcv", "brms", "INLA", "INLA", "rstan", 
              "glmmTMB", "gamm4",           
              "mgcv", "INLA", "INLA", 
              "INLA", "INLA", "glmmTMB", "glmmTMB", "rstanarm",  
              "mgcv", "mgcv")
)
```


Function to query and plot the random effects: filter by package here
```{r}
library(ggplot2)

# define filter
filter_package <- "INLA"  # change package

# filter data
filtered_data <- subset(all_model_data, Package == filter_package)

# Plot
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Family)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects of mgcv models                 (", filter_package, " Modelle)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Family"  # colour for family
  ) +
 theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  text = element_text(size = 14),
  plot.margin = margin(10, 10, 10, 50, "pt")  
) +
coord_cartesian(clip = "off")  


```
For gamlss: no information about random effects is available, so no plot.


all glmmTMB models
```{r}
library(ggplot2)

# define filter
filter_package <- "glmmTMB"  # change

# filter data
filtered_data <- subset(all_model_data, Package == filter_package)

# Plot 
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Family)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) + 
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects of glmmTMB models                          (", filter_package, " Modelle)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Family"  
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14),
    legend.position = "right"  # legend right
  )


```

Plot by package:
```{r}
library(ggplot2)

# define filter
filter_package <- "mgcv"  # change

# filter data
filtered_data <- subset(all_model_data, Package == filter_package)

# Plot 
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Family)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects of mgcv models                   (", filter_package, " Modelle)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Family"  
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14),
    legend.position = "right"  
  )


```

rstanarm models:
```{r}

# dictionarry
all_model_data <- data.frame(
  Model = c("mod.mgcv.gam.no_pc.poisson", 
            "mod.mgcv.gamm.poisson", 
            "mod.brms.poisson", 
            "result.inla.poisson_rw1", 
            "result.inla.poisson_rw2", 
            "mod.rstan.poisson",  
            "mod.glmmTMB.poisson",
            "mod.r2bayesx.poisson",
            "mod.qgam.poisson",
            "mod.gamm4.poisson",           
            "mod.mgcv.gam.nb.no_pc", 
            "result.inla.nb1_rw", 
            "result.inla.nb2_rw1",
            "result.inla.nb1_rw2",
            "result.inla.nb2_rw2",
            "mod.glmmTMB.nb1",
            "mod.glmmTMB.nb2",
            "stan.nb"),  
  StdDev = c(1.52958791, 1.344405387, 1.67, 
             sqrt(1 / 1.915147), sqrt(1 / 1.944296), 
             sqrt(2.60322776861537), 1.5169229, 1.2209, 
             0.225316287992039, 1.529,             
             1.21863867, 1.13774173045133, 
             1.117165, 1.135409, 1.139867, 0.692336, 1.146818, 
             1.222),                       
  LowerCI = c(1.078233, NA, 1.16, sqrt(1 / 3.84756), sqrt(1 / 4.079822), 
              NA, NA, 1.2716, NA, NA,       
              0.7988129, sqrt(0.641427525907611), 
              sqrt(0.625339), sqrt(0.637916), sqrt(0.641229), sqrt(0.160429), 
              sqrt(0.542104), NA),
  UpperCI = c(2.169883, NA, 2.41, sqrt(1 / 1.091315), sqrt(1 / 1.077174), 
              NA, NA, 5.9462, NA, NA,       
              1.859109, sqrt(2.96639668997612), 
              sqrt(2.88633), sqrt(2.970777), sqrt(2.97442), sqrt(1.432136), 
              sqrt(3.190766), NA),
  Family = c("Poisson", "Poisson", "Poisson", "Poisson", "Poisson", 
             "Poisson", "Poisson", "Poisson", "Poisson", "Poisson",  
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial", "Negative Binomial", 
             "Negative Binomial", "Negative Binomial"),
  Type = c("Non-Bayesian", "Non-Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Bayesian", 
           "Non-Bayesian", "Bayesian", "Non-Bayesian", "Non-Bayesian",  
           "Non-Bayesian", "Bayesian", "Bayesian", 
           "Bayesian", "Bayesian", "Non-Bayesian", 
           "Non-Bayesian", "Bayesian"),
  Package = c("mgcv", "mgcv", "brms", "INLA", "INLA", "rstanarm",  
              "glmmTMB", "R2BayesX", "qgam", "gamm4",           
              "mgcv", "INLA", "INLA", 
              "INLA", "INLA", "glmmTMB", "glmmTMB", "rstanarm")  
)

```


```{r}
library(ggplot2)

# filter for rstanarm
filter_package <- "rstanarm"

# filter data
filtered_data <- subset(all_model_data, Package == filter_package)

# Plot 
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Family)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) + 
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects of Rstanarm Models", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Family"  
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14),
    legend.position = "right"  
  )

```


Plot by family
```{r}
# define filter
filter_family <- "Negative Binomial" # change family

# filter data
filtered_data <- subset(all_model_data, Family == filter_family)

# Plot
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Package)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects of Poisson Distribution               (", filter_family, " Modelle)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Package"  # colours for package
  ) +
theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  text = element_text(size = 14),
  plot.margin = margin(5, 5, 5, 30, "pt")  
) +
coord_cartesian(clip = "off")  

```

NB bayesian/ non-bayesian
```{r}
# Create a plot with colors based on Type.
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Type)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects of NB Distribution               (", filter_family, " Modelle)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Type"  # colours for bayesian/non bayesian
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(size = 14),
    plot.margin = margin(5, 5, 5, 30, "pt")  
  ) +
  coord_cartesian(clip = "off")  

```
poisson bayesian/ non-bayesian
```{r}
library(ggplot2)

# Filter for Poisson-Models
filter_family <- "Poisson"  
filtered_data <- subset(all_model_data2, Family == filter_family)  # Filteing for poisson

# Check if filtered data is available.
if (nrow(filtered_data) > 0) {
  # Create a plot with colors based on Type for Poisson models.
  ggplot(filtered_data, aes(x = Model, y = StdDev, color = Type)) +
    geom_point(size = 4) +  
    geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
    geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # for visible axis y=0
    theme_minimal() +
    labs(
      title = paste("Standard Deviation of Random Effects for", filter_family, "Models"),
      x = "Model",
      y = "Standard Deviation",
      color = "Type"  # colours for Bayesian/Non-Bayesian 
    ) +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),
      text = element_text(size = 14),
      plot.margin = margin(5, 5, 5, 30, "pt") 
    ) +
    coord_cartesian(clip = "off")  
} else {
  print(paste("No data available for family:", filter_family))
}


```

Bayesian vs non bayesian models
```{r}

# Create a plot for all models with Bayesian/Non-Bayesian as color.
ggplot(all_model_dataq, aes(x = Model, y = StdDev, color = Type)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) +  
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = "Standard Deviation of Random Effects",
    x = "Model",
    y = "Standard Deviation",
    color = "Type"
  ) +
theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  text = element_text(size = 14),
  plot.margin = margin(10, 10, 10, 40, "pt")  
) +
coord_cartesian(clip = "off")  

```


Only Bayesian/only Non-Bayesian, with family as the legend:

all Non-bayesian
```{r}
library(ggplot2)

# define filter
filter_type <- "Non-Bayesian"
#filter_type <- "Bayesian"  # only "Non-Bayesian" models

# filter data
filtered_data <- subset(all_model_data, Type == filter_type)

# Plot 
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Family)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) + 
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects (", filter_type, " Models)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Family"  # colours for family
  ) +
theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  text = element_text(size = 14),
  plot.margin = margin(5, 5, 5, 20, "pt")  
) +
coord_cartesian(clip = "off")  

```


for all bayesian
```{r}

# define filter
# filter_type <- "Non-Bayesian"
filter_type <- "Bayesian"  # only ayesian-Modell

# filter data
filtered_data <- subset(all_model_data, Type == filter_type)

# Plot 
ggplot(filtered_data, aes(x = Model, y = StdDev, color = Package)) +
  geom_point(size = 4) +  
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2) + 
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  theme_minimal() +
  labs(
    title = paste("Standard Deviation of Random Effects (", filter_type, " Models)", sep = ""),
    x = "Model",
    y = "Standard Deviation",
    color = "Family"  # colour per family
  ) +
theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  text = element_text(size = 14),
  plot.margin = margin(5, 5, 5, 20, "pt") 
) +
coord_cartesian(clip = "off")  

```

